{"ast":null,"code":"var _jsxFileName = \"/home/joshpoms/dndtest2/client/src/Grid.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n// GridInner.jsx\nimport React, { useContext, useMemo, useRef, useState, useEffect } from \"react\";\nimport { useDndContext, useDroppable, DndContext, PointerSensor, useSensor, useSensors, TouchSensor, pointerWithin, rectIntersection, DragOverlay } from \"@dnd-kit/core\";\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\n\n/* ------------------------------------------------------------\n   DROPPABLE GRID CELL\n   ✅ Highlight driven by *global* `over.id` (single source of truth)\n------------------------------------------------------------ */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CellDroppable({\n  r,\n  c,\n  dark,\n  highlight\n}) {\n  _s();\n  const {\n    setNodeRef\n  } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: {\n      role: \"grid:cell\",\n      row: r,\n      col: c\n    }\n  });\n  useEffect(() => {\n    // comment out later\n    console.log(\"[CELL MOUNT]\", `cell-${r}-${c}`);\n    return () => console.log(\"[CELL UNMOUNT]\", `cell-${r}-${c}`);\n  }, [r, c]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: setNodeRef,\n    style: {\n      background: highlight ? \"rgba(50,150,255,0.45)\" : dark ? \"#22272B\" : \"#2C333A\",\n      border: \"1px solid #3F444A\",\n      transition: \"background 80ms\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 38,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------------------------------------------------------------\n   Inner grid canvas so we can read `over` from dnd-kit\n   ✅ FIX MERGED: latch last valid grid cell id to prevent highlight flicker\n------------------------------------------------------------ */\n_s(CellDroppable, \"WOdpcUKNWeQO4i4SBsPjUlVdO/s=\", false, function () {\n  return [useDroppable];\n});\n_c = CellDroppable;\nfunction GridCanvas({\n  gridRef,\n  rows,\n  cols,\n  colTemplate,\n  rowTemplate,\n  visiblePanels,\n  activeId,\n  panelDragging,\n  components,\n  dispatch,\n  addContainer,\n  startColResize,\n  startRowResize,\n  getColPosition,\n  getRowPosition\n}) {\n  _s2();\n  var _active$data2, _active$data2$current, _over$data2, _over$data2$current;\n  const {\n    active,\n    over\n  } = useDndContext();\n  const lastOverRef = useRef(null);\n  const prevRef = useRef({\n    overId: null,\n    overRole: null\n  });\n  useEffect(() => {\n    var _active$data, _active$data$current, _over$id, _over$data$current$ro, _over$data, _over$data$current;\n    const activeRole = active === null || active === void 0 ? void 0 : (_active$data = active.data) === null || _active$data === void 0 ? void 0 : (_active$data$current = _active$data.current) === null || _active$data$current === void 0 ? void 0 : _active$data$current.role;\n    console.log(over);\n    console.log(\"ifewwhjifewh\");\n    if (activeRole !== \"panel\") return;\n    const next = {\n      overId: (_over$id = over === null || over === void 0 ? void 0 : over.id) !== null && _over$id !== void 0 ? _over$id : null,\n      overRole: (_over$data$current$ro = over === null || over === void 0 ? void 0 : (_over$data = over.data) === null || _over$data === void 0 ? void 0 : (_over$data$current = _over$data.current) === null || _over$data$current === void 0 ? void 0 : _over$data$current.role) !== null && _over$data$current$ro !== void 0 ? _over$data$current$ro : null\n    };\n    const prev = prevRef.current;\n    if (prev.overId !== next.overId || prev.overRole !== next.overRole) {\n      console.log(\"[PANEL OVER CHANGE]\", {\n        activeId: active === null || active === void 0 ? void 0 : active.id,\n        overId: next.overId,\n        overRole: next.overRole,\n        prev\n      });\n      prevRef.current = next;\n    }\n  }, [active, over]);\n  const isPanelDrag = (active === null || active === void 0 ? void 0 : (_active$data2 = active.data) === null || _active$data2 === void 0 ? void 0 : (_active$data2$current = _active$data2.current) === null || _active$data2$current === void 0 ? void 0 : _active$data2$current.role) === \"panel\";\n  const overRole = over === null || over === void 0 ? void 0 : (_over$data2 = over.data) === null || _over$data2 === void 0 ? void 0 : (_over$data2$current = _over$data2.current) === null || _over$data2$current === void 0 ? void 0 : _over$data2$current.role;\n\n  // ✅ latch last valid cell id (prevents \"flash\" when over becomes null for 1 frame)\n  const lastPanelOverCellIdRef = useRef(null);\n  const rawCellId = isPanelDrag && over && overRole === \"grid:cell\" ? over.id : null;\n\n  // only update latch when we have a valid cell\n  if (rawCellId) {\n    lastPanelOverCellIdRef.current = rawCellId;\n  }\n\n  // resolved highlight id\n  const panelOverCellId = isPanelDrag ? rawCellId || lastPanelOverCellIdRef.current : null;\n\n  // clear latch when drag stops\n  useEffect(() => {\n    if (!isPanelDrag) lastPanelOverCellIdRef.current = null;\n  }, [isPanelDrag]);\n  console.log(\"panelOverCellId\", panelOverCellId);\n  console.log(\"panelOverCellId\", panelOverCellId);\n  console.log(\"panelOverCellId\", panelOverCellId);\n  console.log(\"over\", over);\n  console.log(\"lastPanelOverCellIdRef\", lastPanelOverCellIdRef);\n  console.log(\"isPanelDrag\", isPanelDrag);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: gridRef,\n    style: {\n      position: \"absolute\",\n      inset: 0,\n      display: \"grid\",\n      gridTemplateColumns: colTemplate,\n      gridTemplateRows: rowTemplate,\n      width: \"100%\",\n      height: \"93vh\",\n      overflow: \"hidden\",\n      touchAction: \"none\",\n      overscrollBehaviorY: \"none\"\n    },\n    children: [[...Array(rows)].map((_, r) => [...Array(cols)].map((_, c) => {\n      const dark = (r + c) % 2 === 0;\n      const cellId = `cell-${r}-${c}`;\n      return /*#__PURE__*/_jsxDEV(CellDroppable, {\n        r: r,\n        c: c,\n        dark: dark,\n        highlight: cellId === panelOverCellId\n      }, `${r}-${c}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }, this);\n    })), [...Array(cols - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      onMouseDown: e => startColResize(e, i),\n      onTouchStart: e => startColResize(e, i),\n      style: {\n        position: \"absolute\",\n        top: 0,\n        bottom: 0,\n        left: `${getColPosition(i)}%`,\n        width: 6,\n        marginLeft: -3,\n        cursor: \"col-resize\",\n        zIndex: 50,\n        background: \"transparent\"\n      }\n    }, `col-resize-${i}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 9\n    }, this)), [...Array(rows - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      onMouseDown: e => startRowResize(e, i),\n      onTouchStart: e => startRowResize(e, i),\n      style: {\n        position: \"absolute\",\n        left: 0,\n        right: 0,\n        top: `${getRowPosition(i)}%`,\n        height: 6,\n        marginTop: -3,\n        cursor: \"row-resize\",\n        zIndex: 50,\n        background: \"transparent\"\n      }\n    }, `row-resize-${i}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }, this)), visiblePanels.map(p => /*#__PURE__*/_jsxDEV(Panel, {\n      panel: p,\n      dispatch: dispatch,\n      gridRef: gridRef,\n      cols: cols,\n      rows: rows,\n      activeId: activeId,\n      components: components,\n      gridActive: panelDragging,\n      addContainer: addContainer\n    }, p.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n}\n_s2(GridCanvas, \"ofrN4ijF1MU163DCcXb9NeFjA2M=\", false, function () {\n  return [useDndContext];\n});\n_c2 = GridCanvas;\nfunction GridInner({\n  components\n}) {\n  _s3();\n  var _grid$rows, _grid$cols;\n  const {\n    state\n  } = useContext(GridDataContext);\n  const {\n    handleDragStart: handleDragStartProp,\n    handleDragOver: handleDragOverProp,\n    handleDragEnd: handleDragEndProp,\n    handleDragCancel: handleDragCancelProp,\n    useRenderCount,\n    dispatch,\n    updatePanel,\n    updateGrid,\n    addContainer,\n    socket\n  } = useContext(GridActionsContext);\n  const sensors = useSensors(useSensor(TouchSensor, {\n    activationConstraint: {\n      delay: 500,\n      tolerance: 8\n    }\n  }), useSensor(PointerSensor));\n  useRenderCount(\"Grid\");\n  const grid = state.grid;\n  const gridId = grid === null || grid === void 0 ? void 0 : grid._id;\n  const rows = (_grid$rows = grid === null || grid === void 0 ? void 0 : grid.rows) !== null && _grid$rows !== void 0 ? _grid$rows : 1;\n  const cols = (_grid$cols = grid === null || grid === void 0 ? void 0 : grid.cols) !== null && _grid$cols !== void 0 ? _grid$cols : 1;\n  const visiblePanels = state.panels.filter(p => p.gridId === gridId);\n  const gridRef = useRef(null);\n  const [activeId, setActiveId] = useState(state.activeId);\n  const [activeData, setActiveData] = useState(null);\n  const [panelDragging, setPanelDragging] = useState(false);\n  const panelDragLiveRef = useRef({\n    id: null,\n    dx: 0,\n    dy: 0\n  });\n  const ensureSizes = (arr, count) => {\n    if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n    if (arr.length === count) return arr;\n    if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n    return arr.slice(0, count);\n  };\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid.rowSizes, rows));\n  useEffect(() => setColSizes(ensureSizes(grid.colSizes, cols)), [grid.colSizes, cols]);\n  useEffect(() => setRowSizes(ensureSizes(grid.rowSizes, rows)), [grid.rowSizes, rows]);\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({\n        colSizes,\n        rowSizes\n      });\n    }\n  }, [colSizes, rowSizes]);\n  const colTemplate = colSizes.map(s => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map(s => `${s}fr`).join(\" \");\n\n  // put near top of GridInner (outside collisionDetection), so it persists\n  const lastPanelCollisionRef = useRef({\n    t: 0,\n    overId: null,\n    emptyStreak: 0\n  });\n  const collisionDetection = useMemo(() => {\n    return args => {\n      var _args$active, _args$active$data, _args$active$data$cur;\n      const activeRole = (_args$active = args.active) === null || _args$active === void 0 ? void 0 : (_args$active$data = _args$active.data) === null || _args$active$data === void 0 ? void 0 : (_args$active$data$cur = _args$active$data.current) === null || _args$active$data$cur === void 0 ? void 0 : _args$active$data$cur.role;\n\n      // Only debug panels\n      if (activeRole === \"panel\") {\n        const p = args.pointerCoordinates;\n        const now = performance.now();\n        const pointerHits = pointerWithin(args);\n\n        // Filter to grid cells only (your existing logic)\n        const cellHits = pointerHits.filter(hit => {\n          var _cont$data, _cont$data$current;\n          const cont = args.droppableContainers.find(d => d.id === hit.id);\n          const role = cont === null || cont === void 0 ? void 0 : (_cont$data = cont.data) === null || _cont$data === void 0 ? void 0 : (_cont$data$current = _cont$data.current) === null || _cont$data$current === void 0 ? void 0 : _cont$data$current.role;\n          return role === \"grid:cell\";\n        });\n        const result = cellHits.length ? cellHits[0] : null;\n\n        // ✅ DEBUG: log “empty” frames (the ones that cause the flash)\n        if (!result) {\n          lastPanelCollisionRef.current.emptyStreak += 1;\n\n          // only log occasionally so you don't get spammed\n          if (lastPanelCollisionRef.current.emptyStreak <= 10) {\n            var _el$closest$getAttrib, _el$closest, _el$closest$call, _el$closest$call$getA;\n            const el = p ? document.elementFromPoint(p.x, p.y) : null;\n            const gridEl = gridRef.current;\n            console.log(\"[PANEL COLLISION EMPTY]\", {\n              pointer: p,\n              pointerWithinCount: pointerHits.length,\n              cellHitCount: cellHits.length,\n              topElement: el ? {\n                tag: el.tagName,\n                id: el.id,\n                className: el.className,\n                dataPanelId: (_el$closest$getAttrib = (_el$closest = el.closest) === null || _el$closest === void 0 ? void 0 : (_el$closest$call = _el$closest.call(el, \"[data-panel-id]\")) === null || _el$closest$call === void 0 ? void 0 : (_el$closest$call$getA = _el$closest$call.getAttribute) === null || _el$closest$call$getA === void 0 ? void 0 : _el$closest$call$getA.call(_el$closest$call, \"data-panel-id\")) !== null && _el$closest$getAttrib !== void 0 ? _el$closest$getAttrib : null\n              } : null,\n              pointerInsideGrid: !!(p && gridEl) && p.x >= gridEl.getBoundingClientRect().left && p.x <= gridEl.getBoundingClientRect().right && p.y >= gridEl.getBoundingClientRect().top && p.y <= gridEl.getBoundingClientRect().bottom\n            });\n          }\n        } else {\n          // reset streak when we have a hit again\n          if (lastPanelCollisionRef.current.emptyStreak > 0) {\n            console.log(\"[PANEL COLLISION RECOVER]\", {\n              recoveredTo: result.id,\n              emptyFrames: lastPanelCollisionRef.current.emptyStreak,\n              pointer: p\n            });\n          }\n          lastPanelCollisionRef.current.emptyStreak = 0;\n        }\n        return result ? [result] : [];\n      }\n      return rectIntersection(args);\n    };\n  }, [gridRef]);\n  const getPanel = id => visiblePanels.find(p => p.id === id);\n  const clamp = (n, min, max) => Math.max(min, Math.min(n, max));\n  const getCellFromPointer = (clientX, clientY) => {\n    if (!gridRef.current) return {\n      row: 0,\n      col: 0\n    };\n    const rect = gridRef.current.getBoundingClientRect();\n    const x = clamp(clientX - rect.left, 0, rect.width - 1);\n    const y = clamp(clientY - rect.top, 0, rect.height - 1);\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n    let col = colSizes.length - 1;\n    let acc = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      acc += colSizes[i] / totalCols * rect.width;\n      if (x < acc) {\n        col = i;\n        break;\n      }\n    }\n    let row = rowSizes.length - 1;\n    acc = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      acc += rowSizes[i] / totalRows * rect.height;\n      if (y < acc) {\n        row = i;\n        break;\n      }\n    }\n    return {\n      row,\n      col\n    };\n  };\n  const handleDragStart = event => {\n    setActiveId(event.active.id);\n    setActiveData(event.active.data.current);\n    const data = event.active.data.current;\n    if ((data === null || data === void 0 ? void 0 : data.role) === \"panel\") {\n      setPanelDragging(true);\n      return;\n    }\n    handleDragStartProp === null || handleDragStartProp === void 0 ? void 0 : handleDragStartProp(event);\n  };\n  const sanitizePanelPlacement = (panel, rows, cols) => ({\n    ...panel,\n    row: Math.max(0, Math.min(panel.row, rows - 1)),\n    col: Math.max(0, Math.min(panel.col, cols - 1)),\n    width: panel.width,\n    height: panel.height\n  });\n  const handleDragOver = event => {\n    var _event$active, _event$active$data, _event$active$data$cu;\n    const role = (_event$active = event.active) === null || _event$active === void 0 ? void 0 : (_event$active$data = _event$active.data) === null || _event$active$data === void 0 ? void 0 : (_event$active$data$cu = _event$active$data.current) === null || _event$active$data$cu === void 0 ? void 0 : _event$active$data$cu.role;\n    if (role === \"panel\") return; // ✅ stop coordinator churn during panel drag\n    handleDragOverProp === null || handleDragOverProp === void 0 ? void 0 : handleDragOverProp(event);\n  };\n  const handleDragEnd = event => {\n    var _active$data3, _event$activatorEvent, _event$activatorEvent2, _event$activatorEvent3, _event$activatorEvent4, _event$activatorEvent5, _event$activatorEvent6, _event$activatorEvent7, _event$activatorEvent8, _event$activatorEvent9, _event$activatorEvent0, _event$over, _event$over2, _event$over2$data, _event$over2$data$cur, _event$over3, _event$over3$data, _event$over3$data$cur;\n    const {\n      active\n    } = event;\n    const data = active === null || active === void 0 ? void 0 : (_active$data3 = active.data) === null || _active$data3 === void 0 ? void 0 : _active$data3.current;\n    setActiveId(null);\n    if (!data) return;\n    if (data.role !== \"panel\") {\n      handleDragEndProp === null || handleDragEndProp === void 0 ? void 0 : handleDragEndProp(event);\n      return;\n    }\n    const panel = getPanel(active.id);\n    if (!panel) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      return;\n    }\n    const startX = (_event$activatorEvent = (_event$activatorEvent2 = event.activatorEvent) === null || _event$activatorEvent2 === void 0 ? void 0 : _event$activatorEvent2.clientX) !== null && _event$activatorEvent !== void 0 ? _event$activatorEvent : (_event$activatorEvent3 = event.activatorEvent) === null || _event$activatorEvent3 === void 0 ? void 0 : (_event$activatorEvent4 = _event$activatorEvent3.touches) === null || _event$activatorEvent4 === void 0 ? void 0 : (_event$activatorEvent5 = _event$activatorEvent4[0]) === null || _event$activatorEvent5 === void 0 ? void 0 : _event$activatorEvent5.clientX;\n    const startY = (_event$activatorEvent6 = (_event$activatorEvent7 = event.activatorEvent) === null || _event$activatorEvent7 === void 0 ? void 0 : _event$activatorEvent7.clientY) !== null && _event$activatorEvent6 !== void 0 ? _event$activatorEvent6 : (_event$activatorEvent8 = event.activatorEvent) === null || _event$activatorEvent8 === void 0 ? void 0 : (_event$activatorEvent9 = _event$activatorEvent8.touches) === null || _event$activatorEvent9 === void 0 ? void 0 : (_event$activatorEvent0 = _event$activatorEvent9[0]) === null || _event$activatorEvent0 === void 0 ? void 0 : _event$activatorEvent0.clientY;\n    if (typeof startX !== \"number\" || typeof startY !== \"number\") {\n      requestAnimationFrame(() => setPanelDragging(false));\n      return;\n    }\n    const pointerX = startX + panelDragLiveRef.current.dx;\n    const pointerY = startY + panelDragLiveRef.current.dy;\n    const {\n      row,\n      col\n    } = getCellFromPointer(pointerX, pointerY);\n    console.log(\"[PANEL DROP]\", {\n      overId: (_event$over = event.over) === null || _event$over === void 0 ? void 0 : _event$over.id,\n      overRole: (_event$over2 = event.over) === null || _event$over2 === void 0 ? void 0 : (_event$over2$data = _event$over2.data) === null || _event$over2$data === void 0 ? void 0 : (_event$over2$data$cur = _event$over2$data.current) === null || _event$over2$data$cur === void 0 ? void 0 : _event$over2$data$cur.role,\n      overRC: ((_event$over3 = event.over) === null || _event$over3 === void 0 ? void 0 : (_event$over3$data = _event$over3.data) === null || _event$over3$data === void 0 ? void 0 : (_event$over3$data$cur = _event$over3$data.current) === null || _event$over3$data$cur === void 0 ? void 0 : _event$over3$data$cur.role) === \"grid:cell\" ? {\n        row: event.over.data.current.row,\n        col: event.over.data.current.col\n      } : null,\n      delta: event.delta\n    });\n    const updated = sanitizePanelPlacement({\n      ...panel,\n      row,\n      col\n    }, rows, cols);\n    dispatch(updatePanel(updated));\n    socket.emit(\"update_panel\", {\n      panel: updated,\n      gridId\n    });\n    panelDragLiveRef.current = {\n      id: null,\n      dx: 0,\n      dy: 0\n    };\n    requestAnimationFrame(() => setPanelDragging(false));\n  };\n  const handleDragMove = event => {\n    var _event$active2, _event$active2$data;\n    const data = (_event$active2 = event.active) === null || _event$active2 === void 0 ? void 0 : (_event$active2$data = _event$active2.data) === null || _event$active2$data === void 0 ? void 0 : _event$active2$data.current;\n    if (!data || data.role !== \"panel\") return;\n    panelDragLiveRef.current.id = data.panelId;\n    panelDragLiveRef.current.dx = event.delta.x;\n    panelDragLiveRef.current.dy = event.delta.y;\n  };\n  const handleDragCancel = event => {\n    var _event$active3, _event$active3$data, _event$active3$data$c;\n    setActiveId(null);\n    requestAnimationFrame(() => setPanelDragging(false));\n    const role = (_event$active3 = event.active) === null || _event$active3 === void 0 ? void 0 : (_event$active3$data = _event$active3.data) === null || _event$active3$data === void 0 ? void 0 : (_event$active3$data$c = _event$active3$data.current) === null || _event$active3$data$c === void 0 ? void 0 : _event$active3$data$c.role;\n    if (role !== \"panel\") {\n      handleDragCancelProp === null || handleDragCancelProp === void 0 ? void 0 : handleDragCancelProp(event);\n    }\n  };\n  // ---- Grid resizing (unchanged) ----\n  const resizePendingRef = useRef({\n    rowSizes: null,\n    colSizes: null\n  });\n  const finalizeResize = () => {\n    var _state$grid, _pending$rowSizes, _pending$colSizes, _pending$rowSizes2, _pending$colSizes2;\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!((_state$grid = state.grid) !== null && _state$grid !== void 0 && _state$grid._id)) return;\n    dispatch(updateGrid({\n      _id: state.grid._id,\n      rows: state.grid.rows,\n      cols: state.grid.cols,\n      rowSizes: (_pending$rowSizes = pending.rowSizes) !== null && _pending$rowSizes !== void 0 ? _pending$rowSizes : rowSizes,\n      colSizes: (_pending$colSizes = pending.colSizes) !== null && _pending$colSizes !== void 0 ? _pending$colSizes : colSizes\n    }));\n    socket.emit(\"update_grid\", {\n      gridId: state.grid._id,\n      grid: {\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: (_pending$rowSizes2 = pending.rowSizes) !== null && _pending$rowSizes2 !== void 0 ? _pending$rowSizes2 : rowSizes,\n        colSizes: (_pending$colSizes2 = pending.colSizes) !== null && _pending$colSizes2 !== void 0 ? _pending$colSizes2 : colSizes\n      }\n    });\n    resizePendingRef.current = {\n      rowSizes: null,\n      colSizes: null\n    };\n  };\n  const getGridWidth = () => {\n    var _gridRef$current;\n    return ((_gridRef$current = gridRef.current) === null || _gridRef$current === void 0 ? void 0 : _gridRef$current.clientWidth) || 1;\n  };\n  const getGridHeight = () => {\n    var _gridRef$current2;\n    return ((_gridRef$current2 = gridRef.current) === null || _gridRef$current2 === void 0 ? void 0 : _gridRef$current2.clientHeight) || 1;\n  };\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridWidth * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridHeight * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n  const getClientX = e => e.touches ? e.touches[0].clientX : e.clientX;\n  const getClientY = e => e.touches ? e.touches[0].clientY : e.clientY;\n  const getColPosition = i => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n  const getRowPosition = i => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  if (!(grid !== null && grid !== void 0 && grid._id)) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Loading grid\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 628,\n    columnNumber: 26\n  }, this);\n  return /*#__PURE__*/_jsxDEV(DndContext, {\n    sensors: sensors,\n    collisionDetection: collisionDetection,\n    onDragStart: handleDragStart,\n    onDragMove: handleDragMove,\n    onDragEnd: handleDragEnd,\n    onDragOver: handleDragOver,\n    onDragCancel: handleDragCancel,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        inset: 0,\n        background: \"#1D2125\",\n        overflow: \"hidden\"\n      },\n      children: /*#__PURE__*/_jsxDEV(GridCanvas, {\n        gridRef: gridRef,\n        rows: rows,\n        cols: cols,\n        colTemplate: colTemplate,\n        rowTemplate: rowTemplate,\n        visiblePanels: visiblePanels,\n        activeId: activeId,\n        panelDragging: panelDragging,\n        components: components,\n        dispatch: dispatch,\n        addContainer: addContainer,\n        startColResize: startColResize,\n        startRowResize: startRowResize,\n        getColPosition: getColPosition,\n        getRowPosition: getRowPosition\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 648,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 640,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DragOverlay, {\n      dropAnimation: null,\n      zIndex: 100000,\n      children: activeId && getPanel(activeId) ? /*#__PURE__*/_jsxDEV(PanelClone, {\n        panel: getPanel(activeId)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 670,\n        columnNumber: 11\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 668,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 631,\n    columnNumber: 5\n  }, this);\n}\n_s3(GridInner, \"Z6VFR40UBMb13khvxOem02q33Jk=\", false, function () {\n  return [useSensors, useSensor, useSensor, useRenderCount];\n});\n_c3 = GridInner;\nexport default _c4 = /*#__PURE__*/React.memo(GridInner);\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"CellDroppable\");\n$RefreshReg$(_c2, \"GridCanvas\");\n$RefreshReg$(_c3, \"GridInner\");\n$RefreshReg$(_c4, \"%default%\");","map":{"version":3,"names":["React","useContext","useMemo","useRef","useState","useEffect","useDndContext","useDroppable","DndContext","PointerSensor","useSensor","useSensors","TouchSensor","pointerWithin","rectIntersection","DragOverlay","Panel","PanelClone","GridDataContext","GridActionsContext","jsxDEV","_jsxDEV","CellDroppable","r","c","dark","highlight","_s","setNodeRef","id","data","role","row","col","console","log","ref","style","background","border","transition","fileName","_jsxFileName","lineNumber","columnNumber","_c","GridCanvas","gridRef","rows","cols","colTemplate","rowTemplate","visiblePanels","activeId","panelDragging","components","dispatch","addContainer","startColResize","startRowResize","getColPosition","getRowPosition","_s2","_active$data2","_active$data2$current","_over$data2","_over$data2$current","active","over","lastOverRef","prevRef","overId","overRole","_active$data","_active$data$current","_over$id","_over$data$current$ro","_over$data","_over$data$current","activeRole","current","next","prev","isPanelDrag","lastPanelOverCellIdRef","rawCellId","panelOverCellId","position","inset","display","gridTemplateColumns","gridTemplateRows","width","height","overflow","touchAction","overscrollBehaviorY","children","Array","map","_","cellId","i","onMouseDown","e","onTouchStart","top","bottom","left","marginLeft","cursor","zIndex","right","marginTop","p","panel","gridActive","_c2","GridInner","_s3","_grid$rows","_grid$cols","state","handleDragStart","handleDragStartProp","handleDragOver","handleDragOverProp","handleDragEnd","handleDragEndProp","handleDragCancel","handleDragCancelProp","useRenderCount","updatePanel","updateGrid","socket","sensors","activationConstraint","delay","tolerance","grid","gridId","_id","panels","filter","setActiveId","activeData","setActiveData","setPanelDragging","panelDragLiveRef","dx","dy","ensureSizes","arr","count","isArray","length","fill","slice","colSizes","setColSizes","rowSizes","setRowSizes","dataset","sizes","JSON","stringify","s","join","lastPanelCollisionRef","t","emptyStreak","collisionDetection","args","_args$active","_args$active$data","_args$active$data$cur","pointerCoordinates","now","performance","pointerHits","cellHits","hit","_cont$data","_cont$data$current","cont","droppableContainers","find","d","result","_el$closest$getAttrib","_el$closest","_el$closest$call","_el$closest$call$getA","el","document","elementFromPoint","x","y","gridEl","pointer","pointerWithinCount","cellHitCount","topElement","tag","tagName","className","dataPanelId","closest","call","getAttribute","pointerInsideGrid","getBoundingClientRect","recoveredTo","emptyFrames","getPanel","clamp","n","min","max","Math","getCellFromPointer","clientX","clientY","rect","totalCols","reduce","a","b","totalRows","acc","event","sanitizePanelPlacement","_event$active","_event$active$data","_event$active$data$cu","_active$data3","_event$activatorEvent","_event$activatorEvent2","_event$activatorEvent3","_event$activatorEvent4","_event$activatorEvent5","_event$activatorEvent6","_event$activatorEvent7","_event$activatorEvent8","_event$activatorEvent9","_event$activatorEvent0","_event$over","_event$over2","_event$over2$data","_event$over2$data$cur","_event$over3","_event$over3$data","_event$over3$data$cur","requestAnimationFrame","startX","activatorEvent","touches","startY","pointerX","pointerY","overRC","delta","updated","emit","handleDragMove","_event$active2","_event$active2$data","panelId","_event$active3","_event$active3$data","_event$active3$data$c","resizePendingRef","finalizeResize","_state$grid","_pending$rowSizes","_pending$colSizes","_pending$rowSizes2","_pending$colSizes2","pending","getGridWidth","_gridRef$current","clientWidth","getGridHeight","_gridRef$current2","clientHeight","resizeColumn","pixelDelta","gridWidth","total","frDelta","copy","resizeRow","gridHeight","getClientX","getClientY","before","preventDefault","move","ev","currentX","stop","window","removeEventListener","addEventListener","currentY","onDragStart","onDragMove","onDragEnd","onDragOver","onDragCancel","dropAnimation","_c3","_c4","memo","$RefreshReg$"],"sources":["/home/joshpoms/dndtest2/client/src/Grid.jsx"],"sourcesContent":["// GridInner.jsx\nimport React, { useContext, useMemo, useRef, useState, useEffect } from \"react\";\nimport {\n  useDndContext,\n  useDroppable,\n  DndContext,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  TouchSensor,\n  pointerWithin,\n  rectIntersection,\n  DragOverlay,\n} from \"@dnd-kit/core\";\n\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\n\n/* ------------------------------------------------------------\n   DROPPABLE GRID CELL\n   ✅ Highlight driven by *global* `over.id` (single source of truth)\n------------------------------------------------------------ */\nfunction CellDroppable({ r, c, dark, highlight }) {\n  const { setNodeRef } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: { role: \"grid:cell\", row: r, col: c },\n  });\n\n  useEffect(() => {\n    // comment out later\n    console.log(\"[CELL MOUNT]\", `cell-${r}-${c}`);\n    return () => console.log(\"[CELL UNMOUNT]\", `cell-${r}-${c}`);\n  }, [r, c]);\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={{\n        background: highlight\n          ? \"rgba(50,150,255,0.45)\"\n          : dark\n            ? \"#22272B\"\n            : \"#2C333A\",\n        border: \"1px solid #3F444A\",\n        transition: \"background 80ms\",\n      }}\n    />\n  );\n}\n\n/* ------------------------------------------------------------\n   Inner grid canvas so we can read `over` from dnd-kit\n   ✅ FIX MERGED: latch last valid grid cell id to prevent highlight flicker\n------------------------------------------------------------ */\nfunction GridCanvas({\n  gridRef,\n  rows,\n  cols,\n  colTemplate,\n  rowTemplate,\n  visiblePanels,\n  activeId,\n  panelDragging,\n  components,\n  dispatch,\n  addContainer,\n  startColResize,\n  startRowResize,\n  getColPosition,\n  getRowPosition,\n}) {\n  const { active, over } = useDndContext();\n  const lastOverRef = useRef(null);\n\nconst prevRef = useRef({ overId: null, overRole: null });\n\nuseEffect(() => {\n  const activeRole = active?.data?.current?.role;\n  console.log(over);\n  console.log(\"ifewwhjifewh\");\n  if (activeRole !== \"panel\") return;\n\n  const next = { overId: over?.id ?? null, overRole: over?.data?.current?.role ?? null };\n  const prev = prevRef.current;\n\n  if (prev.overId !== next.overId || prev.overRole !== next.overRole) {\n    console.log(\"[PANEL OVER CHANGE]\", {\n      activeId: active?.id,\n      overId: next.overId,\n      overRole: next.overRole,\n      prev,\n    });\n    prevRef.current = next;\n  }\n}, [active, over]);\n\n\n\n  const isPanelDrag = active?.data?.current?.role === \"panel\";\n  const overRole = over?.data?.current?.role;\n\n  // ✅ latch last valid cell id (prevents \"flash\" when over becomes null for 1 frame)\n  const lastPanelOverCellIdRef = useRef(null);\n\n  const rawCellId =\n    isPanelDrag && over && overRole === \"grid:cell\" ? over.id : null;\n\n  // only update latch when we have a valid cell\n  if (rawCellId) {\n    lastPanelOverCellIdRef.current = rawCellId;\n  }\n\n  // resolved highlight id\n  const panelOverCellId = isPanelDrag\n    ? rawCellId || lastPanelOverCellIdRef.current\n    : null;\n\n  // clear latch when drag stops\n  useEffect(() => {\n    if (!isPanelDrag) lastPanelOverCellIdRef.current = null;\n  }, [isPanelDrag]);\n  console.log(\"panelOverCellId\", panelOverCellId);\n  console.log(\"panelOverCellId\", panelOverCellId);\n   console.log(\"panelOverCellId\", panelOverCellId); \n    console.log(\"over\", over);\n      console.log(\"lastPanelOverCellIdRef\", lastPanelOverCellIdRef);\n        console.log(\"isPanelDrag\", isPanelDrag);\n  return (\n    <div\n      ref={gridRef}\n      style={{\n        position: \"absolute\",\n        inset: 0,\n        display: \"grid\",\n        gridTemplateColumns: colTemplate,\n        gridTemplateRows: rowTemplate,\n        width: \"100%\",\n        height: \"93vh\",\n        overflow: \"hidden\",\n        touchAction: \"none\",\n        overscrollBehaviorY: \"none\",\n      }}\n    >\n      \n      {[...Array(rows)].map((_, r) =>\n        [...Array(cols)].map((_, c) => {\n          const dark = (r + c) % 2 === 0;\n          const cellId = `cell-${r}-${c}`;\n          return (\n            <CellDroppable\n              key={`${r}-${c}`}\n              r={r}\n              c={c}\n              dark={dark}\n              highlight={cellId === panelOverCellId}\n            />\n          );\n        })\n      )}\n\n      {/* Vertical resizers */}\n      {[...Array(cols - 1)].map((_, i) => (\n        <div\n          key={`col-resize-${i}`}\n          onMouseDown={(e) => startColResize(e, i)}\n          onTouchStart={(e) => startColResize(e, i)}\n          style={{\n            position: \"absolute\",\n            top: 0,\n            bottom: 0,\n            left: `${getColPosition(i)}%`,\n            width: 6,\n            marginLeft: -3,\n            cursor: \"col-resize\",\n            zIndex: 50,\n            background: \"transparent\",\n          }}\n        />\n      ))}\n\n      {/* Row resizers */}\n      {[...Array(rows - 1)].map((_, i) => (\n        <div\n          key={`row-resize-${i}`}\n          onMouseDown={(e) => startRowResize(e, i)}\n          onTouchStart={(e) => startRowResize(e, i)}\n          style={{\n            position: \"absolute\",\n            left: 0,\n            right: 0,\n            top: `${getRowPosition(i)}%`,\n            height: 6,\n            marginTop: -3,\n            cursor: \"row-resize\",\n            zIndex: 50,\n            background: \"transparent\",\n          }}\n        />\n      ))}\n\n      {/* Panels */}\n      {visiblePanels.map((p) => (\n        <Panel\n          key={p.id}\n          panel={p}\n          dispatch={dispatch}\n          gridRef={gridRef}\n          cols={cols}\n          rows={rows}\n          activeId={activeId}\n          components={components}\n          gridActive={panelDragging}\n          addContainer={addContainer}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction GridInner({ components }) {\n  const { state } = useContext(GridDataContext);\n\n  const {\n    handleDragStart: handleDragStartProp,\n    handleDragOver: handleDragOverProp,\n    handleDragEnd: handleDragEndProp,\n    handleDragCancel: handleDragCancelProp,\n    useRenderCount,\n    dispatch,\n    updatePanel,\n    updateGrid,\n    addContainer,\n    socket,\n  } = useContext(GridActionsContext);\n\n  const sensors = useSensors(\n    useSensor(TouchSensor, {\n      activationConstraint: { delay: 500, tolerance: 8 },\n    }),\n    useSensor(PointerSensor)\n  );\n\n  useRenderCount(\"Grid\");\n\n  const grid = state.grid;\n  const gridId = grid?._id;\n  const rows = grid?.rows ?? 1;\n  const cols = grid?.cols ?? 1;\n\n  const visiblePanels = state.panels.filter((p) => p.gridId === gridId);\n\n  const gridRef = useRef(null);\n  const [activeId, setActiveId] = useState(state.activeId);\n  const [activeData, setActiveData] = useState(null);\n\n  const [panelDragging, setPanelDragging] = useState(false);\n  const panelDragLiveRef = useRef({ id: null, dx: 0, dy: 0 });\n\n  const ensureSizes = (arr, count) => {\n    if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n    if (arr.length === count) return arr;\n    if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n    return arr.slice(0, count);\n  };\n\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid.rowSizes, rows));\n\n  useEffect(() => setColSizes(ensureSizes(grid.colSizes, cols)), [grid.colSizes, cols]);\n  useEffect(() => setRowSizes(ensureSizes(grid.rowSizes, rows)), [grid.rowSizes, rows]);\n\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({ colSizes, rowSizes });\n    }\n  }, [colSizes, rowSizes]);\n\n  const colTemplate = colSizes.map((s) => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map((s) => `${s}fr`).join(\" \");\n\n// put near top of GridInner (outside collisionDetection), so it persists\nconst lastPanelCollisionRef = useRef({\n  t: 0,\n  overId: null,\n  emptyStreak: 0,\n});\n\nconst collisionDetection = useMemo(() => {\n  return (args) => {\n    const activeRole = args.active?.data?.current?.role;\n\n    // Only debug panels\n    if (activeRole === \"panel\") {\n      const p = args.pointerCoordinates;\n      const now = performance.now();\n\n      const pointerHits = pointerWithin(args);\n\n      // Filter to grid cells only (your existing logic)\n      const cellHits = pointerHits.filter((hit) => {\n        const cont = args.droppableContainers.find((d) => d.id === hit.id);\n        const role = cont?.data?.current?.role;\n        return role === \"grid:cell\";\n      });\n\n      const result = cellHits.length ? cellHits[0] : null;\n\n      // ✅ DEBUG: log “empty” frames (the ones that cause the flash)\n      if (!result) {\n        lastPanelCollisionRef.current.emptyStreak += 1;\n\n        // only log occasionally so you don't get spammed\n        if (lastPanelCollisionRef.current.emptyStreak <= 10) {\n          const el = p ? document.elementFromPoint(p.x, p.y) : null;\n          const gridEl = gridRef.current;\n\n          console.log(\"[PANEL COLLISION EMPTY]\", {\n            pointer: p,\n            pointerWithinCount: pointerHits.length,\n            cellHitCount: cellHits.length,\n            topElement: el\n              ? {\n                  tag: el.tagName,\n                  id: el.id,\n                  className: el.className,\n                  dataPanelId: el.closest?.(\"[data-panel-id]\")?.getAttribute?.(\"data-panel-id\") ?? null,\n                }\n              : null,\n            pointerInsideGrid:\n              !!(p && gridEl) &&\n              p.x >= gridEl.getBoundingClientRect().left &&\n              p.x <= gridEl.getBoundingClientRect().right &&\n              p.y >= gridEl.getBoundingClientRect().top &&\n              p.y <= gridEl.getBoundingClientRect().bottom,\n          });\n        }\n      } else {\n        // reset streak when we have a hit again\n        if (lastPanelCollisionRef.current.emptyStreak > 0) {\n          console.log(\"[PANEL COLLISION RECOVER]\", {\n            recoveredTo: result.id,\n            emptyFrames: lastPanelCollisionRef.current.emptyStreak,\n            pointer: p,\n          });\n        }\n        lastPanelCollisionRef.current.emptyStreak = 0;\n      }\n\n      return result ? [result] : [];\n    }\n\n    return rectIntersection(args);\n  };\n}, [gridRef]);\n\n\n  const getPanel = (id) => visiblePanels.find((p) => p.id === id);\n\n  const clamp = (n, min, max) => Math.max(min, Math.min(n, max));\n\n  const getCellFromPointer = (clientX, clientY) => {\n    if (!gridRef.current) return { row: 0, col: 0 };\n\n    const rect = gridRef.current.getBoundingClientRect();\n\n    const x = clamp(clientX - rect.left, 0, rect.width - 1);\n    const y = clamp(clientY - rect.top, 0, rect.height - 1);\n\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n\n    let col = colSizes.length - 1;\n    let acc = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      acc += (colSizes[i] / totalCols) * rect.width;\n      if (x < acc) { col = i; break; }\n    }\n\n    let row = rowSizes.length - 1;\n    acc = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      acc += (rowSizes[i] / totalRows) * rect.height;\n      if (y < acc) { row = i; break; }\n    }\n\n    return { row, col };\n  };\n\n  const handleDragStart = (event) => {\n    setActiveId(event.active.id);\n    setActiveData(event.active.data.current);\n\n    const data = event.active.data.current;\n\n    if (data?.role === \"panel\") {\n      setPanelDragging(true);\n      return;\n    }\n\n    handleDragStartProp?.(event);\n  };\n\n  const sanitizePanelPlacement = (panel, rows, cols) => ({\n    ...panel,\n    row: Math.max(0, Math.min(panel.row, rows - 1)),\n    col: Math.max(0, Math.min(panel.col, cols - 1)),\n    width: panel.width,\n    height: panel.height,\n  });\n\nconst handleDragOver = (event) => {\n  const role = event.active?.data?.current?.role;\n  if (role === \"panel\") return;      // ✅ stop coordinator churn during panel drag\n  handleDragOverProp?.(event);\n};\n  const handleDragEnd = (event) => {\n    const { active } = event;\n    const data = active?.data?.current;\n\n    setActiveId(null);\n\n    if (!data) return;\n\n    if (data.role !== \"panel\") {\n      handleDragEndProp?.(event);\n      return;\n    }\n\n    const panel = getPanel(active.id);\n    if (!panel) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      return;\n    }\n\n    const startX =\n      event.activatorEvent?.clientX ??\n      event.activatorEvent?.touches?.[0]?.clientX;\n    const startY =\n      event.activatorEvent?.clientY ??\n      event.activatorEvent?.touches?.[0]?.clientY;\n\n    if (typeof startX !== \"number\" || typeof startY !== \"number\") {\n      requestAnimationFrame(() => setPanelDragging(false));\n      return;\n    }\n\n    const pointerX = startX + panelDragLiveRef.current.dx;\n    const pointerY = startY + panelDragLiveRef.current.dy;\n\n    const { row, col } = getCellFromPointer(pointerX, pointerY);\nconsole.log(\"[PANEL DROP]\", {\n  overId: event.over?.id,\n  overRole: event.over?.data?.current?.role,\n  overRC: event.over?.data?.current?.role === \"grid:cell\"\n    ? { row: event.over.data.current.row, col: event.over.data.current.col }\n    : null,\n  delta: event.delta,\n});\n\n    const updated = sanitizePanelPlacement({ ...panel, row, col }, rows, cols);\n\n    dispatch(updatePanel(updated));\n    socket.emit(\"update_panel\", { panel: updated, gridId });\n\n    panelDragLiveRef.current = { id: null, dx: 0, dy: 0 };\n\n    requestAnimationFrame(() => setPanelDragging(false));\n  };\n\n  const handleDragMove = (event) => {\n    const data = event.active?.data?.current;\n    if (!data || data.role !== \"panel\") return;\n\n    panelDragLiveRef.current.id = data.panelId;\n    panelDragLiveRef.current.dx = event.delta.x;\n    panelDragLiveRef.current.dy = event.delta.y;\n  };\n\nconst handleDragCancel = (event) => {\n  setActiveId(null);\n  requestAnimationFrame(() => setPanelDragging(false));\n\n  const role = event.active?.data?.current?.role;\n  if (role !== \"panel\") {\n    handleDragCancelProp?.(event);\n  }\n};\n  // ---- Grid resizing (unchanged) ----\n  const resizePendingRef = useRef({ rowSizes: null, colSizes: null });\n\n  const finalizeResize = () => {\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!state.grid?._id) return;\n\n    dispatch(\n      updateGrid({\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: pending.rowSizes ?? rowSizes,\n        colSizes: pending.colSizes ?? colSizes,\n      })\n    );\n\n    socket.emit(\"update_grid\", {\n      gridId: state.grid._id,\n      grid: {\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: pending.rowSizes ?? rowSizes,\n        colSizes: pending.colSizes ?? colSizes,\n      },\n    });\n\n    resizePendingRef.current = { rowSizes: null, colSizes: null };\n  };\n\n  const getGridWidth = () => gridRef.current?.clientWidth || 1;\n  const getGridHeight = () => gridRef.current?.clientHeight || 1;\n\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridWidth) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridHeight) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n\n  const getClientX = (e) => (e.touches ? e.touches[0].clientX : e.clientX);\n  const getClientY = (e) => (e.touches ? e.touches[0].clientY : e.clientY);\n\n  const getColPosition = (i) => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n\n  const getRowPosition = (i) => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  if (!grid?._id) return <div>Loading grid…</div>;\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={collisionDetection}\n      onDragStart={handleDragStart}\n      onDragMove={handleDragMove}\n      onDragEnd={handleDragEnd}\n      onDragOver={handleDragOver}\n      onDragCancel={handleDragCancel}\n    >\n      <div\n        style={{\n          position: \"absolute\",\n          inset: 0,\n          background: \"#1D2125\",\n          overflow: \"hidden\",\n        }}\n      >\n        <GridCanvas\n          gridRef={gridRef}\n          rows={rows}\n          cols={cols}\n          colTemplate={colTemplate}\n          rowTemplate={rowTemplate}\n          visiblePanels={visiblePanels}\n          activeId={activeId}\n          panelDragging={panelDragging}\n          components={components}\n          dispatch={dispatch}\n          addContainer={addContainer}\n          startColResize={startColResize}\n          startRowResize={startRowResize}\n          getColPosition={getColPosition}\n          getRowPosition={getRowPosition}\n        />\n      </div>\n\n      {/* ✅ Option A: Panel DragOverlay clone (no drop animation) */}\n      <DragOverlay dropAnimation={null} zIndex={100000}>\n        {activeId && getPanel(activeId) ? (\n          <PanelClone panel={getPanel(activeId)} />\n        ) : null}\n      </DragOverlay>\n    </DndContext>\n  );\n}\n\nexport default React.memo(GridInner);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}