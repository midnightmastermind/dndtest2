{"ast":null,"code":"var _jsxFileName = \"/home/joshpoms/dndtest2/src/App.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useMemo, useRef, useState, useCallback } from \"react\";\nimport Grid from \"./Grid\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction uid() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 10);\n}\nfunction useRenderCount(label) {\n  _s();\n  const ref = React.useRef(0);\n  ref.current += 1;\n  console.log(`${label} render #${ref.current}`);\n}\n\n// ✅ Safe event snapshot for debug UI (no circular refs)\n_s(useRenderCount, \"QMBuJFIdzLIeqBcFwhMf246mjOM=\");\nfunction pickEvent(event, type) {\n  var _a$data, _o$data, _activeData$role, _activeData$container, _overData$role, _overData$containerId;\n  const a = event === null || event === void 0 ? void 0 : event.active;\n  const o = event === null || event === void 0 ? void 0 : event.over;\n  const activeData = (a === null || a === void 0 ? void 0 : (_a$data = a.data) === null || _a$data === void 0 ? void 0 : _a$data.current) || null;\n  const overData = (o === null || o === void 0 ? void 0 : (_o$data = o.data) === null || _o$data === void 0 ? void 0 : _o$data.current) || null;\n  return {\n    type,\n    ts: Date.now(),\n    active: a ? {\n      id: a.id,\n      role: (_activeData$role = activeData === null || activeData === void 0 ? void 0 : activeData.role) !== null && _activeData$role !== void 0 ? _activeData$role : null,\n      containerId: (_activeData$container = activeData === null || activeData === void 0 ? void 0 : activeData.containerId) !== null && _activeData$container !== void 0 ? _activeData$container : null,\n      data: activeData\n    } : null,\n    over: o ? {\n      id: o.id,\n      role: (_overData$role = overData === null || overData === void 0 ? void 0 : overData.role) !== null && _overData$role !== void 0 ? _overData$role : null,\n      containerId: (_overData$containerId = overData === null || overData === void 0 ? void 0 : overData.containerId) !== null && _overData$containerId !== void 0 ? _overData$containerId : null,\n      data: overData\n    } : null\n  };\n}\nfunction DebugBar({\n  containers,\n  containersDraft,\n  activeId,\n  debugEvent\n}) {\n  var _debugEvent$type;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"relative\",\n      top: 0,\n      zIndex: 999,\n      background: \"#0e1116\",\n      borderBottom: \"1px solid #222\",\n      padding: \"8px 12px\",\n      fontSize: 12,\n      fontFamily: \"monospace\",\n      color: \"#9aa4b2\",\n      display: \"flex\",\n      gap: 16,\n      flexWrap: \"wrap\"\n    },\n    className: \"debugbar\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"activeId:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: \"#fff\"\n        },\n        children: activeId !== null && activeId !== void 0 ? activeId : \"null\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"debugEvent:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: \"#fff\"\n        },\n        children: (_debugEvent$type = debugEvent === null || debugEvent === void 0 ? void 0 : debugEvent.type) !== null && _debugEvent$type !== void 0 ? _debugEvent$type : \"null\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"containers (state):\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), \" \", containers.length]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"draftRef:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: containersDraft ? \"#4caf50\" : \"#f44336\"\n        },\n        children: containersDraft ? \"ACTIVE\" : \"null\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"details\", {\n      style: {\n        cursor: \"pointer\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"summary\", {\n        children: \"event\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: \"pre-wrap\",\n          maxWidth: 700\n        },\n        children: JSON.stringify(debugEvent, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"details\", {\n      style: {\n        cursor: \"pointer\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"summary\", {\n        children: \"state\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: \"pre-wrap\",\n          maxWidth: 700\n        },\n        children: JSON.stringify(containers, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"details\", {\n      style: {\n        cursor: \"pointer\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"summary\", {\n        children: \"draft\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: \"pre-wrap\",\n          maxWidth: 700\n        },\n        children: JSON.stringify(containersDraft, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 48,\n    columnNumber: 5\n  }, this);\n}\n_c = DebugBar;\nfunction arrayMove(arr, from, to) {\n  const copy = [...arr];\n  const [item] = copy.splice(from, 1);\n  copy.splice(to, 0, item);\n  return copy;\n}\nfunction deepCloneContainers(containers) {\n  return containers.map(c => ({\n    ...c,\n    items: [...c.items]\n  }));\n}\nexport default function App() {\n  _s2();\n  // drag state\n  const [activeId, setActiveId] = useState(null);\n  const [activeSize, setActiveSize] = useState(null);\n\n  // ✅ debug event snapshot state\n  const [debugEvent, setDebugEvent] = useState(null);\n\n  // data state\n  const [containers, setContainers] = useState([]); // {id,label,items:[]}\n  const [instances, setInstances] = useState([]); // {id,label}\n\n  // soft-sort draft\n  const containersDraftRef = useRef(null);\n  const [softTick, setSoftTick] = useState(0);\n\n  // throttle debugEvent (only update when meaningful change)\n  const lastOverRef = useRef({\n    activeId: null,\n    overId: null,\n    overRole: null,\n    overContainerId: null\n  });\n\n  // creators\n  const addContainer = useCallback(() => {\n    const id = uid();\n    setContainers(prev => [...prev, {\n      id,\n      label: `List ${prev.length + 1}`,\n      items: []\n    }]);\n  }, []);\n  const addInstanceToContainer = useCallback(containerId => {\n    const instanceId = uid();\n    setInstances(prev => [...prev, {\n      id: instanceId,\n      label: `Item ${prev.length + 1}`\n    }]);\n    setContainers(prev => prev.map(c => c.id === containerId ? {\n      ...c,\n      items: [...c.items, instanceId]\n    } : c));\n  }, []);\n\n  // helpers\n  const findContainerIndexById = useCallback((id, list) => {\n    return list.findIndex(c => c.id === id);\n  }, []);\n  const findContainerByInstanceId = useCallback((instanceId, list) => {\n    return list.find(c => c.items.includes(instanceId));\n  }, []);\n  const getWorkingContainers = () => {\n    var _containersDraftRef$c;\n    return (_containersDraftRef$c = containersDraftRef.current) !== null && _containersDraftRef$c !== void 0 ? _containersDraftRef$c : containers;\n  };\n\n  // -------------------------\n  // Drag Handlers (App-owned)\n  // -------------------------\n  const handleDragStart = useCallback(event => {\n    var _event$active$rect, _event$active$rect$cu;\n    setDebugEvent(pickEvent(event, \"start\"));\n    setActiveId(event.active.id);\n    const rect = (_event$active$rect = event.active.rect) === null || _event$active$rect === void 0 ? void 0 : (_event$active$rect$cu = _event$active$rect.current) === null || _event$active$rect$cu === void 0 ? void 0 : _event$active$rect$cu.initial;\n    if (rect) setActiveSize({\n      width: rect.width,\n      height: rect.height\n    });\n    containersDraftRef.current = deepCloneContainers(containers);\n    setSoftTick(t => t + 1);\n  }, [containers]);\n  const handleDragCancel = useCallback(() => {\n    setDebugEvent({\n      type: \"cancel\",\n      ts: Date.now()\n    });\n    setActiveId(null);\n    setActiveSize(null);\n    containersDraftRef.current = null;\n    setSoftTick(t => t + 1);\n  }, []);\n  const handleDragOver = useCallback(event => {\n    var _over$data$current$ro, _over$data$current, _over$data$current$co, _over$data$current2, _active$data$current;\n    const {\n      active,\n      over\n    } = event;\n    if (!over) return;\n    console.log(\"dragover\");\n    console.log(\"active\", active);\n    console.log(\"over\", over);\n    const nextOverRole = (_over$data$current$ro = (_over$data$current = over.data.current) === null || _over$data$current === void 0 ? void 0 : _over$data$current.role) !== null && _over$data$current$ro !== void 0 ? _over$data$current$ro : null;\n    const nextOverContainerId = (_over$data$current$co = (_over$data$current2 = over.data.current) === null || _over$data$current2 === void 0 ? void 0 : _over$data$current2.containerId) !== null && _over$data$current$co !== void 0 ? _over$data$current$co : typeof over.id === \"string\" ? over.id : null;\n    const last = lastOverRef.current;\n    const sameOver = last.activeId === active.id && last.overId === over.id && last.overRole === nextOverRole && last.overContainerId === nextOverContainerId;\n    if (!sameOver) {\n      lastOverRef.current = {\n        activeId: active.id,\n        overId: over.id,\n        overRole: nextOverRole,\n        overContainerId: nextOverContainerId\n      };\n      setDebugEvent(pickEvent(event, \"over\"));\n    }\n    const draft = containersDraftRef.current;\n    if (!draft) return;\n    const activeRole = (_active$data$current = active.data.current) === null || _active$data$current === void 0 ? void 0 : _active$data$current.role;\n    const overRole = nextOverRole;\n\n    // A) Dragging a CONTAINER (kept disabled as in your snippet)\n    if (activeRole === \"container\") {\n      return;\n    }\n\n    // B) Dragging an INSTANCE (sortable + cross-container)\n    if (activeRole === \"instance\") {\n      var _over$data$current3;\n      const instanceId = active.id;\n      const fromContainer = findContainerByInstanceId(instanceId, draft);\n      if (!fromContainer) return;\n      console.log(\"from container\", fromContainer);\n      const toContainerId = (_over$data$current3 = over.data.current) === null || _over$data$current3 === void 0 ? void 0 : _over$data$current3.containerId;\n      if (!toContainerId) return;\n      const toContainer = draft.find(c => c.id === toContainerId);\n      if (!toContainer) return;\n      console.log(\"to container\", toContainer);\n      const fromId = fromContainer.id;\n      const toId = toContainer.id;\n      console.log(\"fromId\", fromId);\n      console.log(\"toId\", toId);\n      const fromIndex = fromContainer.items.indexOf(instanceId);\n      if (fromIndex === -1) return;\n      console.log(\"fromIndex\", fromIndex);\n      const isOverInstance = overRole === \"instance\";\n      const overInstanceId = isOverInstance ? over.id : null;\n      console.log(\"isOverInstance\", isOverInstance);\n      console.log(\"overInstanceId\", overInstanceId);\n\n      // compute \"toIndex\"\n      let toIndex;\n      if (!overInstanceId) {\n        // hovering list zone (append intent)\n        toIndex = toContainer.items.length;\n      } else {\n        const idx = toContainer.items.indexOf(overInstanceId);\n        toIndex = idx >= 0 ? idx : toContainer.items.length;\n      }\n      console.log(\"toIndex\", toIndex);\n\n      // ---- GUARDS: avoid no-op mutations (prevents jitter/loops) ----\n\n      // Same container + list zone: do nothing (prevents “snap to end” jitter)\n      if (fromId === toId && !overInstanceId) return;\n\n      // Hovering itself: ignore\n      if (overInstanceId === instanceId) return;\n\n      // Same container reorder\n      if (fromId === toId) {\n        const adjustedToIndex = toIndex > fromIndex ? toIndex - 1 : toIndex;\n        console.log(\"adjustedToIndex\", adjustedToIndex);\n        if (adjustedToIndex === fromIndex) return;\n        fromContainer.items = arrayMove(fromContainer.items, fromIndex, adjustedToIndex);\n        console.log(\"fromContainer\", fromContainer);\n        setSoftTick(t => t + 1);\n        return;\n      }\n\n      // Cross-container move:\n      fromContainer.items = fromContainer.items.filter(id => id !== instanceId);\n      console.log(\"fromContainer\", fromContainer);\n      const clamped = Math.max(0, Math.min(toContainer.items.length, toIndex));\n      toContainer.items.splice(clamped, 0, instanceId);\n      console.log(\"toContainer\", toContainer);\n      setSoftTick(t => t + 1);\n      return;\n    }\n  }, [findContainerByInstanceId]);\n  const handleDragEnd = useCallback(event => {\n    setDebugEvent(pickEvent(event, \"end\"));\n    const {\n      active,\n      over\n    } = event;\n    console.log(\"dragend\");\n    console.log(active);\n    console.log(over);\n    setActiveId(null);\n    setActiveSize(null);\n    if (!over) {\n      containersDraftRef.current = null;\n      setSoftTick(t => t + 1);\n      return;\n    }\n    if (containersDraftRef.current) {\n      setContainers(containersDraftRef.current);\n      containersDraftRef.current = null;\n      setSoftTick(t => t + 1);\n    }\n  }, []);\n  const containersRender = getWorkingContainers();\n\n  // ✅ useMemo improvements: split contexts, keep values stable\n  const dataValue = useMemo(() => ({\n    activeId,\n    activeSize,\n    debugEvent,\n    containers,\n    containersRender,\n    instances,\n    softTick // consumers can depend on this if needed\n  }), [activeId, activeSize, debugEvent, containers, containersRender, instances, softTick]);\n  const actionsValue = useMemo(() => ({\n    addContainer,\n    addInstanceToContainer,\n    handleDragStart,\n    handleDragOver,\n    handleDragEnd,\n    handleDragCancel,\n    useRenderCount\n  }), [addContainer, addInstanceToContainer, handleDragStart, handleDragOver, handleDragEnd, handleDragCancel]);\n  useRenderCount(\"App\");\n  return /*#__PURE__*/_jsxDEV(GridActionsContext.Provider, {\n    value: actionsValue,\n    children: /*#__PURE__*/_jsxDEV(GridDataContext.Provider, {\n      value: dataValue,\n      children: [/*#__PURE__*/_jsxDEV(DebugBar, {\n        containers: containers,\n        containersDraft: containersDraftRef.current,\n        activeId: activeId,\n        debugEvent: debugEvent\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"app-root\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dnd-page\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              gap: 12,\n              alignItems: \"center\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              style: {\n                margin: 0\n              },\n              children: \"Sortable Containers + Instances\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: addContainer,\n              children: \"+ Container\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 13\n          }, this), containers.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: 12,\n              opacity: 0.7,\n              fontSize: 13\n            },\n            children: \"Create a container to start.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 390,\n    columnNumber: 5\n  }, this);\n}\n_s2(App, \"E440dl4NlIR+iWTwQB7KZvRrqD4=\", false, function () {\n  return [useRenderCount];\n});\n_c2 = App;\nvar _c, _c2;\n$RefreshReg$(_c, \"DebugBar\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"names":["React","useMemo","useRef","useState","useCallback","Grid","GridDataContext","GridActionsContext","jsxDEV","_jsxDEV","uid","Date","now","toString","Math","random","slice","useRenderCount","label","_s","ref","current","console","log","pickEvent","event","type","_a$data","_o$data","_activeData$role","_activeData$container","_overData$role","_overData$containerId","a","active","o","over","activeData","data","overData","ts","id","role","containerId","DebugBar","containers","containersDraft","activeId","debugEvent","_debugEvent$type","style","position","top","zIndex","background","borderBottom","padding","fontSize","fontFamily","color","display","gap","flexWrap","className","children","fileName","_jsxFileName","lineNumber","columnNumber","length","cursor","whiteSpace","maxWidth","JSON","stringify","_c","arrayMove","arr","from","to","copy","item","splice","deepCloneContainers","map","c","items","App","_s2","setActiveId","activeSize","setActiveSize","setDebugEvent","setContainers","instances","setInstances","containersDraftRef","softTick","setSoftTick","lastOverRef","overId","overRole","overContainerId","addContainer","prev","addInstanceToContainer","instanceId","findContainerIndexById","list","findIndex","findContainerByInstanceId","find","includes","getWorkingContainers","_containersDraftRef$c","handleDragStart","_event$active$rect","_event$active$rect$cu","rect","initial","width","height","t","handleDragCancel","handleDragOver","_over$data$current$ro","_over$data$current","_over$data$current$co","_over$data$current2","_active$data$current","nextOverRole","nextOverContainerId","last","sameOver","draft","activeRole","_over$data$current3","fromContainer","toContainerId","toContainer","fromId","toId","fromIndex","indexOf","isOverInstance","overInstanceId","toIndex","idx","adjustedToIndex","filter","clamped","max","min","handleDragEnd","containersRender","dataValue","actionsValue","Provider","value","alignItems","margin","onClick","marginTop","opacity","_c2","$RefreshReg$"],"sources":["/home/joshpoms/dndtest2/src/App.js"],"sourcesContent":["import React, { useMemo, useRef, useState, useCallback } from \"react\";\nimport Grid from \"./Grid\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\n\nfunction uid() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 10);\n}\n\nfunction useRenderCount(label) {\n  const ref = React.useRef(0);\n  ref.current += 1;\n  console.log(`${label} render #${ref.current}`);\n}\n\n// ✅ Safe event snapshot for debug UI (no circular refs)\nfunction pickEvent(event, type) {\n  const a = event?.active;\n  const o = event?.over;\n\n  const activeData = a?.data?.current || null;\n  const overData = o?.data?.current || null;\n\n  return {\n    type,\n    ts: Date.now(),\n    active: a\n      ? {\n        id: a.id,\n        role: activeData?.role ?? null,\n        containerId: activeData?.containerId ?? null,\n        data: activeData,\n      }\n      : null,\n    over: o\n      ? {\n        id: o.id,\n        role: overData?.role ?? null,\n        containerId: overData?.containerId ?? null,\n        data: overData,\n      }\n      : null,\n  };\n}\n\nfunction DebugBar({ containers, containersDraft, activeId, debugEvent }) {\n  return (\n    <div\n      style={{\n        position: \"relative\",\n        top: 0,\n        zIndex: 999,\n        background: \"#0e1116\",\n        borderBottom: \"1px solid #222\",\n        padding: \"8px 12px\",\n        fontSize: 12,\n        fontFamily: \"monospace\",\n        color: \"#9aa4b2\",\n        display: \"flex\",\n        gap: 16,\n        flexWrap: \"wrap\",\n      }}\n      className=\"debugbar\"\n    >\n      <div>\n        <strong>activeId:</strong>{\" \"}\n        <span style={{ color: \"#fff\" }}>{activeId ?? \"null\"}</span>\n      </div>\n\n      <div>\n        <strong>debugEvent:</strong>{\" \"}\n        <span style={{ color: \"#fff\" }}>{debugEvent?.type ?? \"null\"}</span>\n      </div>\n\n      <div>\n        <strong>containers (state):</strong> {containers.length}\n      </div>\n\n      <div>\n        <strong>draftRef:</strong>{\" \"}\n        <span style={{ color: containersDraft ? \"#4caf50\" : \"#f44336\" }}>\n          {containersDraft ? \"ACTIVE\" : \"null\"}\n        </span>\n      </div>\n\n      <details style={{ cursor: \"pointer\" }}>\n        <summary>event</summary>\n        <pre style={{ whiteSpace: \"pre-wrap\", maxWidth: 700 }}>\n          {JSON.stringify(debugEvent, null, 2)}\n        </pre>\n      </details>\n\n      <details style={{ cursor: \"pointer\" }}>\n        <summary>state</summary>\n        <pre style={{ whiteSpace: \"pre-wrap\", maxWidth: 700 }}>\n          {JSON.stringify(containers, null, 2)}\n        </pre>\n      </details>\n\n      <details style={{ cursor: \"pointer\" }}>\n        <summary>draft</summary>\n        <pre style={{ whiteSpace: \"pre-wrap\", maxWidth: 700 }}>\n          {JSON.stringify(containersDraft, null, 2)}\n        </pre>\n      </details>\n    </div>\n  );\n}\n\nfunction arrayMove(arr, from, to) {\n  const copy = [...arr];\n  const [item] = copy.splice(from, 1);\n  copy.splice(to, 0, item);\n  return copy;\n}\n\nfunction deepCloneContainers(containers) {\n  return containers.map((c) => ({ ...c, items: [...c.items] }));\n}\n\nexport default function App() {\n  // drag state\n  const [activeId, setActiveId] = useState(null);\n  const [activeSize, setActiveSize] = useState(null);\n\n  // ✅ debug event snapshot state\n  const [debugEvent, setDebugEvent] = useState(null);\n\n  // data state\n  const [containers, setContainers] = useState([]); // {id,label,items:[]}\n  const [instances, setInstances] = useState([]); // {id,label}\n\n  // soft-sort draft\n  const containersDraftRef = useRef(null);\n  const [softTick, setSoftTick] = useState(0);\n\n  // throttle debugEvent (only update when meaningful change)\n  const lastOverRef = useRef({\n    activeId: null,\n    overId: null,\n    overRole: null,\n    overContainerId: null,\n  });\n\n  // creators\n  const addContainer = useCallback(() => {\n    const id = uid();\n    setContainers((prev) => [\n      ...prev,\n      { id, label: `List ${prev.length + 1}`, items: [] },\n    ]);\n  }, []);\n\n  const addInstanceToContainer = useCallback((containerId) => {\n    const instanceId = uid();\n\n    setInstances((prev) => [\n      ...prev,\n      { id: instanceId, label: `Item ${prev.length + 1}` },\n    ]);\n\n    setContainers((prev) =>\n      prev.map((c) =>\n        c.id === containerId ? { ...c, items: [...c.items, instanceId] } : c\n      )\n    );\n  }, []);\n\n  // helpers\n  const findContainerIndexById = useCallback((id, list) => {\n    return list.findIndex((c) => c.id === id);\n  }, []);\n\n  const findContainerByInstanceId = useCallback((instanceId, list) => {\n    return list.find((c) => c.items.includes(instanceId));\n  }, []);\n\n  const getWorkingContainers = () => containersDraftRef.current ?? containers;\n\n  // -------------------------\n  // Drag Handlers (App-owned)\n  // -------------------------\n  const handleDragStart = useCallback(\n    (event) => {\n      setDebugEvent(pickEvent(event, \"start\"));\n      setActiveId(event.active.id);\n\n      const rect = event.active.rect?.current?.initial;\n      if (rect) setActiveSize({ width: rect.width, height: rect.height });\n\n      containersDraftRef.current = deepCloneContainers(containers);\n      setSoftTick((t) => t + 1);\n    },\n    [containers]\n  );\n\n  const handleDragCancel = useCallback(() => {\n    setDebugEvent({ type: \"cancel\", ts: Date.now() });\n\n    setActiveId(null);\n    setActiveSize(null);\n    containersDraftRef.current = null;\n    setSoftTick((t) => t + 1);\n  }, []);\n\n  const handleDragOver = useCallback(\n    (event) => {\n      const { active, over } = event;\n      if (!over) return;\n      console.log(\"dragover\")\n      console.log(\"active\", active);\n      console.log(\"over\", over);\n      const nextOverRole = over.data.current?.role ?? null;\n      const nextOverContainerId =\n        over.data.current?.containerId ??\n        (typeof over.id === \"string\" ? over.id : null);\n\n      const last = lastOverRef.current;\n      const sameOver =\n        last.activeId === active.id &&\n        last.overId === over.id &&\n        last.overRole === nextOverRole &&\n        last.overContainerId === nextOverContainerId;\n\n      if (!sameOver) {\n        lastOverRef.current = {\n          activeId: active.id,\n          overId: over.id,\n          overRole: nextOverRole,\n          overContainerId: nextOverContainerId,\n        };\n        setDebugEvent(pickEvent(event, \"over\"));\n      }\n\n      const draft = containersDraftRef.current;\n      if (!draft) return;\n\n      const activeRole = active.data.current?.role;\n      const overRole = nextOverRole;\n\n      // A) Dragging a CONTAINER (kept disabled as in your snippet)\n      if (activeRole === \"container\") {\n        return;\n      }\n\n      // B) Dragging an INSTANCE (sortable + cross-container)\n      if (activeRole === \"instance\") {\n        const instanceId = active.id;\n\n        const fromContainer = findContainerByInstanceId(instanceId, draft);\n        if (!fromContainer) return;\n        console.log(\"from container\", fromContainer);\n        const toContainerId = over.data.current?.containerId;\n        if (!toContainerId) return;\n\n        const toContainer = draft.find((c) => c.id === toContainerId);\n        if (!toContainer) return;\n        console.log(\"to container\", toContainer);\n        const fromId = fromContainer.id;\n        const toId = toContainer.id;\n        console.log(\"fromId\", fromId);\n        console.log(\"toId\", toId);\n\n        const fromIndex = fromContainer.items.indexOf(instanceId);\n        if (fromIndex === -1) return;\n        console.log(\"fromIndex\", fromIndex);\n\n        const isOverInstance = overRole === \"instance\";\n        const overInstanceId = isOverInstance ? over.id : null;\n\n        console.log(\"isOverInstance\", isOverInstance);\n        console.log(\"overInstanceId\", overInstanceId);\n\n        // compute \"toIndex\"\n        let toIndex;\n        if (!overInstanceId) {\n          // hovering list zone (append intent)\n          toIndex = toContainer.items.length;\n        } else {\n          const idx = toContainer.items.indexOf(overInstanceId);\n          toIndex = idx >= 0 ? idx : toContainer.items.length;\n        }\n        console.log(\"toIndex\", toIndex);\n\n        // ---- GUARDS: avoid no-op mutations (prevents jitter/loops) ----\n\n        // Same container + list zone: do nothing (prevents “snap to end” jitter)\n        if (fromId === toId && !overInstanceId) return;\n\n        // Hovering itself: ignore\n        if (overInstanceId === instanceId) return;\n\n        // Same container reorder\n        if (fromId === toId) {\n          const adjustedToIndex = toIndex > fromIndex ? toIndex - 1 : toIndex;\n                  console.log(\"adjustedToIndex\", adjustedToIndex);\n\n          if (adjustedToIndex === fromIndex) return;\n\n          fromContainer.items = arrayMove(\n            fromContainer.items,\n            fromIndex,\n            adjustedToIndex\n          );\n                  console.log(\"fromContainer\", fromContainer);\n\n          setSoftTick((t) => t + 1);\n          return;\n        }\n\n        // Cross-container move:\n        fromContainer.items = fromContainer.items.filter((id) => id !== instanceId);\n        console.log(\"fromContainer\", fromContainer);\n\n        const clamped = Math.max(0, Math.min(toContainer.items.length, toIndex));\n        toContainer.items.splice(clamped, 0, instanceId);\n        console.log(\"toContainer\", toContainer);\n\n        setSoftTick((t) => t + 1);\n        return;\n      }\n    },\n    [findContainerByInstanceId]\n  );\n\n  const handleDragEnd = useCallback(\n    (event) => {\n      setDebugEvent(pickEvent(event, \"end\"));\n      const { active, over } = event;\n      console.log(\"dragend\");\n      console.log(active);\n      console.log(over);\n      setActiveId(null);\n      setActiveSize(null);\n\n      if (!over) {\n        containersDraftRef.current = null;\n        setSoftTick((t) => t + 1);\n        return;\n      }\n\n      if (containersDraftRef.current) {\n        setContainers(containersDraftRef.current);\n        containersDraftRef.current = null;\n        setSoftTick((t) => t + 1);\n      }\n    },\n    []\n  );\n\n  const containersRender = getWorkingContainers();\n\n  // ✅ useMemo improvements: split contexts, keep values stable\n  const dataValue = useMemo(\n    () => ({\n      activeId,\n      activeSize,\n      debugEvent,\n      containers,\n      containersRender,\n      instances,\n      softTick, // consumers can depend on this if needed\n    }),\n    [activeId, activeSize, debugEvent, containers, containersRender, instances, softTick]\n  );\n\n  const actionsValue = useMemo(\n    () => ({\n      addContainer,\n      addInstanceToContainer,\n      handleDragStart,\n      handleDragOver,\n      handleDragEnd,\n      handleDragCancel,\n      useRenderCount,\n    }),\n    [\n      addContainer,\n      addInstanceToContainer,\n      handleDragStart,\n      handleDragOver,\n      handleDragEnd,\n      handleDragCancel,\n    ]\n  );\n\n  useRenderCount(\"App\");\n\n  return (\n    <GridActionsContext.Provider value={actionsValue}>\n      <GridDataContext.Provider value={dataValue}>\n        <DebugBar\n          containers={containers}\n          containersDraft={containersDraftRef.current}\n          activeId={activeId}\n          debugEvent={debugEvent}\n        />\n\n        <div className=\"app-root\">\n          <div className=\"dnd-page\">\n            <div style={{ display: \"flex\", gap: 12, alignItems: \"center\" }}>\n              <h2 style={{ margin: 0 }}>Sortable Containers + Instances</h2>\n              <button onClick={addContainer}>+ Container</button>\n            </div>\n\n            <Grid />\n\n            {containers.length === 0 && (\n              <div style={{ marginTop: 12, opacity: 0.7, fontSize: 13 }}>\n                Create a container to start.\n              </div>\n            )}\n          </div>\n        </div>\n      </GridDataContext.Provider>\n    </GridActionsContext.Provider>\n  );\n}\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,OAAO,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AACrE,OAAOC,IAAI,MAAM,QAAQ;AACzB,SAASC,eAAe,QAAQ,mBAAmB;AACnD,SAASC,kBAAkB,QAAQ,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1D,SAASC,GAAGA,CAAA,EAAG;EACb,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,GAAGC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACF,QAAQ,CAAC,EAAE,CAAC,CAACG,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;AAC1E;AAEA,SAASC,cAAcA,CAACC,KAAK,EAAE;EAAAC,EAAA;EAC7B,MAAMC,GAAG,GAAGpB,KAAK,CAACE,MAAM,CAAC,CAAC,CAAC;EAC3BkB,GAAG,CAACC,OAAO,IAAI,CAAC;EAChBC,OAAO,CAACC,GAAG,CAAC,GAAGL,KAAK,YAAYE,GAAG,CAACC,OAAO,EAAE,CAAC;AAChD;;AAEA;AAAAF,EAAA,CANSF,cAAc;AAOvB,SAASO,SAASA,CAACC,KAAK,EAAEC,IAAI,EAAE;EAAA,IAAAC,OAAA,EAAAC,OAAA,EAAAC,gBAAA,EAAAC,qBAAA,EAAAC,cAAA,EAAAC,qBAAA;EAC9B,MAAMC,CAAC,GAAGR,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAES,MAAM;EACvB,MAAMC,CAAC,GAAGV,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEW,IAAI;EAErB,MAAMC,UAAU,GAAG,CAAAJ,CAAC,aAADA,CAAC,wBAAAN,OAAA,GAADM,CAAC,CAAEK,IAAI,cAAAX,OAAA,uBAAPA,OAAA,CAASN,OAAO,KAAI,IAAI;EAC3C,MAAMkB,QAAQ,GAAG,CAAAJ,CAAC,aAADA,CAAC,wBAAAP,OAAA,GAADO,CAAC,CAAEG,IAAI,cAAAV,OAAA,uBAAPA,OAAA,CAASP,OAAO,KAAI,IAAI;EAEzC,OAAO;IACLK,IAAI;IACJc,EAAE,EAAE7B,IAAI,CAACC,GAAG,CAAC,CAAC;IACdsB,MAAM,EAAED,CAAC,GACL;MACAQ,EAAE,EAAER,CAAC,CAACQ,EAAE;MACRC,IAAI,GAAAb,gBAAA,GAAEQ,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEK,IAAI,cAAAb,gBAAA,cAAAA,gBAAA,GAAI,IAAI;MAC9Bc,WAAW,GAAAb,qBAAA,GAAEO,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEM,WAAW,cAAAb,qBAAA,cAAAA,qBAAA,GAAI,IAAI;MAC5CQ,IAAI,EAAED;IACR,CAAC,GACC,IAAI;IACRD,IAAI,EAAED,CAAC,GACH;MACAM,EAAE,EAAEN,CAAC,CAACM,EAAE;MACRC,IAAI,GAAAX,cAAA,GAAEQ,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEG,IAAI,cAAAX,cAAA,cAAAA,cAAA,GAAI,IAAI;MAC5BY,WAAW,GAAAX,qBAAA,GAAEO,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEI,WAAW,cAAAX,qBAAA,cAAAA,qBAAA,GAAI,IAAI;MAC1CM,IAAI,EAAEC;IACR,CAAC,GACC;EACN,CAAC;AACH;AAEA,SAASK,QAAQA,CAAC;EAAEC,UAAU;EAAEC,eAAe;EAAEC,QAAQ;EAAEC;AAAW,CAAC,EAAE;EAAA,IAAAC,gBAAA;EACvE,oBACExC,OAAA;IACEyC,KAAK,EAAE;MACLC,QAAQ,EAAE,UAAU;MACpBC,GAAG,EAAE,CAAC;MACNC,MAAM,EAAE,GAAG;MACXC,UAAU,EAAE,SAAS;MACrBC,YAAY,EAAE,gBAAgB;MAC9BC,OAAO,EAAE,UAAU;MACnBC,QAAQ,EAAE,EAAE;MACZC,UAAU,EAAE,WAAW;MACvBC,KAAK,EAAE,SAAS;MAChBC,OAAO,EAAE,MAAM;MACfC,GAAG,EAAE,EAAE;MACPC,QAAQ,EAAE;IACZ,CAAE;IACFC,SAAS,EAAC,UAAU;IAAAC,QAAA,gBAEpBvD,OAAA;MAAAuD,QAAA,gBACEvD,OAAA;QAAAuD,QAAA,EAAQ;MAAS;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EAAC,GAAG,eAC9B3D,OAAA;QAAMyC,KAAK,EAAE;UAAES,KAAK,EAAE;QAAO,CAAE;QAAAK,QAAA,EAAEjB,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAI;MAAM;QAAAkB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACxD,CAAC,eAEN3D,OAAA;MAAAuD,QAAA,gBACEvD,OAAA;QAAAuD,QAAA,EAAQ;MAAW;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EAAC,GAAG,eAChC3D,OAAA;QAAMyC,KAAK,EAAE;UAAES,KAAK,EAAE;QAAO,CAAE;QAAAK,QAAA,GAAAf,gBAAA,GAAED,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEtB,IAAI,cAAAuB,gBAAA,cAAAA,gBAAA,GAAI;MAAM;QAAAgB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAChE,CAAC,eAEN3D,OAAA;MAAAuD,QAAA,gBACEvD,OAAA;QAAAuD,QAAA,EAAQ;MAAmB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,KAAC,EAACvB,UAAU,CAACwB,MAAM;IAAA;MAAAJ,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpD,CAAC,eAEN3D,OAAA;MAAAuD,QAAA,gBACEvD,OAAA;QAAAuD,QAAA,EAAQ;MAAS;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EAAC,GAAG,eAC9B3D,OAAA;QAAMyC,KAAK,EAAE;UAAES,KAAK,EAAEb,eAAe,GAAG,SAAS,GAAG;QAAU,CAAE;QAAAkB,QAAA,EAC7DlB,eAAe,GAAG,QAAQ,GAAG;MAAM;QAAAmB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAChC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACJ,CAAC,eAEN3D,OAAA;MAASyC,KAAK,EAAE;QAAEoB,MAAM,EAAE;MAAU,CAAE;MAAAN,QAAA,gBACpCvD,OAAA;QAAAuD,QAAA,EAAS;MAAK;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAS,CAAC,eACxB3D,OAAA;QAAKyC,KAAK,EAAE;UAAEqB,UAAU,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAAAR,QAAA,EACnDS,IAAI,CAACC,SAAS,CAAC1B,UAAU,EAAE,IAAI,EAAE,CAAC;MAAC;QAAAiB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAEV3D,OAAA;MAASyC,KAAK,EAAE;QAAEoB,MAAM,EAAE;MAAU,CAAE;MAAAN,QAAA,gBACpCvD,OAAA;QAAAuD,QAAA,EAAS;MAAK;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAS,CAAC,eACxB3D,OAAA;QAAKyC,KAAK,EAAE;UAAEqB,UAAU,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAAAR,QAAA,EACnDS,IAAI,CAACC,SAAS,CAAC7B,UAAU,EAAE,IAAI,EAAE,CAAC;MAAC;QAAAoB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAEV3D,OAAA;MAASyC,KAAK,EAAE;QAAEoB,MAAM,EAAE;MAAU,CAAE;MAAAN,QAAA,gBACpCvD,OAAA;QAAAuD,QAAA,EAAS;MAAK;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAS,CAAC,eACxB3D,OAAA;QAAKyC,KAAK,EAAE;UAAEqB,UAAU,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAI,CAAE;QAAAR,QAAA,EACnDS,IAAI,CAACC,SAAS,CAAC5B,eAAe,EAAE,IAAI,EAAE,CAAC;MAAC;QAAAmB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACP,CAAC;AAEV;AAACO,EAAA,GA9DQ/B,QAAQ;AAgEjB,SAASgC,SAASA,CAACC,GAAG,EAAEC,IAAI,EAAEC,EAAE,EAAE;EAChC,MAAMC,IAAI,GAAG,CAAC,GAAGH,GAAG,CAAC;EACrB,MAAM,CAACI,IAAI,CAAC,GAAGD,IAAI,CAACE,MAAM,CAACJ,IAAI,EAAE,CAAC,CAAC;EACnCE,IAAI,CAACE,MAAM,CAACH,EAAE,EAAE,CAAC,EAAEE,IAAI,CAAC;EACxB,OAAOD,IAAI;AACb;AAEA,SAASG,mBAAmBA,CAACtC,UAAU,EAAE;EACvC,OAAOA,UAAU,CAACuC,GAAG,CAAEC,CAAC,KAAM;IAAE,GAAGA,CAAC;IAAEC,KAAK,EAAE,CAAC,GAAGD,CAAC,CAACC,KAAK;EAAE,CAAC,CAAC,CAAC;AAC/D;AAEA,eAAe,SAASC,GAAGA,CAAA,EAAG;EAAAC,GAAA;EAC5B;EACA,MAAM,CAACzC,QAAQ,EAAE0C,WAAW,CAAC,GAAGtF,QAAQ,CAAC,IAAI,CAAC;EAC9C,MAAM,CAACuF,UAAU,EAAEC,aAAa,CAAC,GAAGxF,QAAQ,CAAC,IAAI,CAAC;;EAElD;EACA,MAAM,CAAC6C,UAAU,EAAE4C,aAAa,CAAC,GAAGzF,QAAQ,CAAC,IAAI,CAAC;;EAElD;EACA,MAAM,CAAC0C,UAAU,EAAEgD,aAAa,CAAC,GAAG1F,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;EAClD,MAAM,CAAC2F,SAAS,EAAEC,YAAY,CAAC,GAAG5F,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;;EAEhD;EACA,MAAM6F,kBAAkB,GAAG9F,MAAM,CAAC,IAAI,CAAC;EACvC,MAAM,CAAC+F,QAAQ,EAAEC,WAAW,CAAC,GAAG/F,QAAQ,CAAC,CAAC,CAAC;;EAE3C;EACA,MAAMgG,WAAW,GAAGjG,MAAM,CAAC;IACzB6C,QAAQ,EAAE,IAAI;IACdqD,MAAM,EAAE,IAAI;IACZC,QAAQ,EAAE,IAAI;IACdC,eAAe,EAAE;EACnB,CAAC,CAAC;;EAEF;EACA,MAAMC,YAAY,GAAGnG,WAAW,CAAC,MAAM;IACrC,MAAMqC,EAAE,GAAG/B,GAAG,CAAC,CAAC;IAChBmF,aAAa,CAAEW,IAAI,IAAK,CACtB,GAAGA,IAAI,EACP;MAAE/D,EAAE;MAAEvB,KAAK,EAAE,QAAQsF,IAAI,CAACnC,MAAM,GAAG,CAAC,EAAE;MAAEiB,KAAK,EAAE;IAAG,CAAC,CACpD,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMmB,sBAAsB,GAAGrG,WAAW,CAAEuC,WAAW,IAAK;IAC1D,MAAM+D,UAAU,GAAGhG,GAAG,CAAC,CAAC;IAExBqF,YAAY,CAAES,IAAI,IAAK,CACrB,GAAGA,IAAI,EACP;MAAE/D,EAAE,EAAEiE,UAAU;MAAExF,KAAK,EAAE,QAAQsF,IAAI,CAACnC,MAAM,GAAG,CAAC;IAAG,CAAC,CACrD,CAAC;IAEFwB,aAAa,CAAEW,IAAI,IACjBA,IAAI,CAACpB,GAAG,CAAEC,CAAC,IACTA,CAAC,CAAC5C,EAAE,KAAKE,WAAW,GAAG;MAAE,GAAG0C,CAAC;MAAEC,KAAK,EAAE,CAAC,GAAGD,CAAC,CAACC,KAAK,EAAEoB,UAAU;IAAE,CAAC,GAAGrB,CACrE,CACF,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMsB,sBAAsB,GAAGvG,WAAW,CAAC,CAACqC,EAAE,EAAEmE,IAAI,KAAK;IACvD,OAAOA,IAAI,CAACC,SAAS,CAAExB,CAAC,IAAKA,CAAC,CAAC5C,EAAE,KAAKA,EAAE,CAAC;EAC3C,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMqE,yBAAyB,GAAG1G,WAAW,CAAC,CAACsG,UAAU,EAAEE,IAAI,KAAK;IAClE,OAAOA,IAAI,CAACG,IAAI,CAAE1B,CAAC,IAAKA,CAAC,CAACC,KAAK,CAAC0B,QAAQ,CAACN,UAAU,CAAC,CAAC;EACvD,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMO,oBAAoB,GAAGA,CAAA;IAAA,IAAAC,qBAAA;IAAA,QAAAA,qBAAA,GAAMlB,kBAAkB,CAAC3E,OAAO,cAAA6F,qBAAA,cAAAA,qBAAA,GAAIrE,UAAU;EAAA;;EAE3E;EACA;EACA;EACA,MAAMsE,eAAe,GAAG/G,WAAW,CAChCqB,KAAK,IAAK;IAAA,IAAA2F,kBAAA,EAAAC,qBAAA;IACTzB,aAAa,CAACpE,SAAS,CAACC,KAAK,EAAE,OAAO,CAAC,CAAC;IACxCgE,WAAW,CAAChE,KAAK,CAACS,MAAM,CAACO,EAAE,CAAC;IAE5B,MAAM6E,IAAI,IAAAF,kBAAA,GAAG3F,KAAK,CAACS,MAAM,CAACoF,IAAI,cAAAF,kBAAA,wBAAAC,qBAAA,GAAjBD,kBAAA,CAAmB/F,OAAO,cAAAgG,qBAAA,uBAA1BA,qBAAA,CAA4BE,OAAO;IAChD,IAAID,IAAI,EAAE3B,aAAa,CAAC;MAAE6B,KAAK,EAAEF,IAAI,CAACE,KAAK;MAAEC,MAAM,EAAEH,IAAI,CAACG;IAAO,CAAC,CAAC;IAEnEzB,kBAAkB,CAAC3E,OAAO,GAAG8D,mBAAmB,CAACtC,UAAU,CAAC;IAC5DqD,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;EAC3B,CAAC,EACD,CAAC7E,UAAU,CACb,CAAC;EAED,MAAM8E,gBAAgB,GAAGvH,WAAW,CAAC,MAAM;IACzCwF,aAAa,CAAC;MAAElE,IAAI,EAAE,QAAQ;MAAEc,EAAE,EAAE7B,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;IAEjD6E,WAAW,CAAC,IAAI,CAAC;IACjBE,aAAa,CAAC,IAAI,CAAC;IACnBK,kBAAkB,CAAC3E,OAAO,GAAG,IAAI;IACjC6E,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;EAC3B,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,cAAc,GAAGxH,WAAW,CAC/BqB,KAAK,IAAK;IAAA,IAAAoG,qBAAA,EAAAC,kBAAA,EAAAC,qBAAA,EAAAC,mBAAA,EAAAC,oBAAA;IACT,MAAM;MAAE/F,MAAM;MAAEE;IAAK,CAAC,GAAGX,KAAK;IAC9B,IAAI,CAACW,IAAI,EAAE;IACXd,OAAO,CAACC,GAAG,CAAC,UAAU,CAAC;IACvBD,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEW,MAAM,CAAC;IAC7BZ,OAAO,CAACC,GAAG,CAAC,MAAM,EAAEa,IAAI,CAAC;IACzB,MAAM8F,YAAY,IAAAL,qBAAA,IAAAC,kBAAA,GAAG1F,IAAI,CAACE,IAAI,CAACjB,OAAO,cAAAyG,kBAAA,uBAAjBA,kBAAA,CAAmBpF,IAAI,cAAAmF,qBAAA,cAAAA,qBAAA,GAAI,IAAI;IACpD,MAAMM,mBAAmB,IAAAJ,qBAAA,IAAAC,mBAAA,GACvB5F,IAAI,CAACE,IAAI,CAACjB,OAAO,cAAA2G,mBAAA,uBAAjBA,mBAAA,CAAmBrF,WAAW,cAAAoF,qBAAA,cAAAA,qBAAA,GAC7B,OAAO3F,IAAI,CAACK,EAAE,KAAK,QAAQ,GAAGL,IAAI,CAACK,EAAE,GAAG,IAAK;IAEhD,MAAM2F,IAAI,GAAGjC,WAAW,CAAC9E,OAAO;IAChC,MAAMgH,QAAQ,GACZD,IAAI,CAACrF,QAAQ,KAAKb,MAAM,CAACO,EAAE,IAC3B2F,IAAI,CAAChC,MAAM,KAAKhE,IAAI,CAACK,EAAE,IACvB2F,IAAI,CAAC/B,QAAQ,KAAK6B,YAAY,IAC9BE,IAAI,CAAC9B,eAAe,KAAK6B,mBAAmB;IAE9C,IAAI,CAACE,QAAQ,EAAE;MACblC,WAAW,CAAC9E,OAAO,GAAG;QACpB0B,QAAQ,EAAEb,MAAM,CAACO,EAAE;QACnB2D,MAAM,EAAEhE,IAAI,CAACK,EAAE;QACf4D,QAAQ,EAAE6B,YAAY;QACtB5B,eAAe,EAAE6B;MACnB,CAAC;MACDvC,aAAa,CAACpE,SAAS,CAACC,KAAK,EAAE,MAAM,CAAC,CAAC;IACzC;IAEA,MAAM6G,KAAK,GAAGtC,kBAAkB,CAAC3E,OAAO;IACxC,IAAI,CAACiH,KAAK,EAAE;IAEZ,MAAMC,UAAU,IAAAN,oBAAA,GAAG/F,MAAM,CAACI,IAAI,CAACjB,OAAO,cAAA4G,oBAAA,uBAAnBA,oBAAA,CAAqBvF,IAAI;IAC5C,MAAM2D,QAAQ,GAAG6B,YAAY;;IAE7B;IACA,IAAIK,UAAU,KAAK,WAAW,EAAE;MAC9B;IACF;;IAEA;IACA,IAAIA,UAAU,KAAK,UAAU,EAAE;MAAA,IAAAC,mBAAA;MAC7B,MAAM9B,UAAU,GAAGxE,MAAM,CAACO,EAAE;MAE5B,MAAMgG,aAAa,GAAG3B,yBAAyB,CAACJ,UAAU,EAAE4B,KAAK,CAAC;MAClE,IAAI,CAACG,aAAa,EAAE;MACpBnH,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEkH,aAAa,CAAC;MAC5C,MAAMC,aAAa,IAAAF,mBAAA,GAAGpG,IAAI,CAACE,IAAI,CAACjB,OAAO,cAAAmH,mBAAA,uBAAjBA,mBAAA,CAAmB7F,WAAW;MACpD,IAAI,CAAC+F,aAAa,EAAE;MAEpB,MAAMC,WAAW,GAAGL,KAAK,CAACvB,IAAI,CAAE1B,CAAC,IAAKA,CAAC,CAAC5C,EAAE,KAAKiG,aAAa,CAAC;MAC7D,IAAI,CAACC,WAAW,EAAE;MAClBrH,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEoH,WAAW,CAAC;MACxC,MAAMC,MAAM,GAAGH,aAAa,CAAChG,EAAE;MAC/B,MAAMoG,IAAI,GAAGF,WAAW,CAAClG,EAAE;MAC3BnB,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEqH,MAAM,CAAC;MAC7BtH,OAAO,CAACC,GAAG,CAAC,MAAM,EAAEsH,IAAI,CAAC;MAEzB,MAAMC,SAAS,GAAGL,aAAa,CAACnD,KAAK,CAACyD,OAAO,CAACrC,UAAU,CAAC;MACzD,IAAIoC,SAAS,KAAK,CAAC,CAAC,EAAE;MACtBxH,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEuH,SAAS,CAAC;MAEnC,MAAME,cAAc,GAAG3C,QAAQ,KAAK,UAAU;MAC9C,MAAM4C,cAAc,GAAGD,cAAc,GAAG5G,IAAI,CAACK,EAAE,GAAG,IAAI;MAEtDnB,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEyH,cAAc,CAAC;MAC7C1H,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAE0H,cAAc,CAAC;;MAE7C;MACA,IAAIC,OAAO;MACX,IAAI,CAACD,cAAc,EAAE;QACnB;QACAC,OAAO,GAAGP,WAAW,CAACrD,KAAK,CAACjB,MAAM;MACpC,CAAC,MAAM;QACL,MAAM8E,GAAG,GAAGR,WAAW,CAACrD,KAAK,CAACyD,OAAO,CAACE,cAAc,CAAC;QACrDC,OAAO,GAAGC,GAAG,IAAI,CAAC,GAAGA,GAAG,GAAGR,WAAW,CAACrD,KAAK,CAACjB,MAAM;MACrD;MACA/C,OAAO,CAACC,GAAG,CAAC,SAAS,EAAE2H,OAAO,CAAC;;MAE/B;;MAEA;MACA,IAAIN,MAAM,KAAKC,IAAI,IAAI,CAACI,cAAc,EAAE;;MAExC;MACA,IAAIA,cAAc,KAAKvC,UAAU,EAAE;;MAEnC;MACA,IAAIkC,MAAM,KAAKC,IAAI,EAAE;QACnB,MAAMO,eAAe,GAAGF,OAAO,GAAGJ,SAAS,GAAGI,OAAO,GAAG,CAAC,GAAGA,OAAO;QAC3D5H,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAE6H,eAAe,CAAC;QAEvD,IAAIA,eAAe,KAAKN,SAAS,EAAE;QAEnCL,aAAa,CAACnD,KAAK,GAAGV,SAAS,CAC7B6D,aAAa,CAACnD,KAAK,EACnBwD,SAAS,EACTM,eACF,CAAC;QACO9H,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEkH,aAAa,CAAC;QAEnDvC,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;QACzB;MACF;;MAEA;MACAe,aAAa,CAACnD,KAAK,GAAGmD,aAAa,CAACnD,KAAK,CAAC+D,MAAM,CAAE5G,EAAE,IAAKA,EAAE,KAAKiE,UAAU,CAAC;MAC3EpF,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEkH,aAAa,CAAC;MAE3C,MAAMa,OAAO,GAAGxI,IAAI,CAACyI,GAAG,CAAC,CAAC,EAAEzI,IAAI,CAAC0I,GAAG,CAACb,WAAW,CAACrD,KAAK,CAACjB,MAAM,EAAE6E,OAAO,CAAC,CAAC;MACxEP,WAAW,CAACrD,KAAK,CAACJ,MAAM,CAACoE,OAAO,EAAE,CAAC,EAAE5C,UAAU,CAAC;MAChDpF,OAAO,CAACC,GAAG,CAAC,aAAa,EAAEoH,WAAW,CAAC;MAEvCzC,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;MACzB;IACF;EACF,CAAC,EACD,CAACZ,yBAAyB,CAC5B,CAAC;EAED,MAAM2C,aAAa,GAAGrJ,WAAW,CAC9BqB,KAAK,IAAK;IACTmE,aAAa,CAACpE,SAAS,CAACC,KAAK,EAAE,KAAK,CAAC,CAAC;IACtC,MAAM;MAAES,MAAM;MAAEE;IAAK,CAAC,GAAGX,KAAK;IAC9BH,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC;IACtBD,OAAO,CAACC,GAAG,CAACW,MAAM,CAAC;IACnBZ,OAAO,CAACC,GAAG,CAACa,IAAI,CAAC;IACjBqD,WAAW,CAAC,IAAI,CAAC;IACjBE,aAAa,CAAC,IAAI,CAAC;IAEnB,IAAI,CAACvD,IAAI,EAAE;MACT4D,kBAAkB,CAAC3E,OAAO,GAAG,IAAI;MACjC6E,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;MACzB;IACF;IAEA,IAAI1B,kBAAkB,CAAC3E,OAAO,EAAE;MAC9BwE,aAAa,CAACG,kBAAkB,CAAC3E,OAAO,CAAC;MACzC2E,kBAAkB,CAAC3E,OAAO,GAAG,IAAI;MACjC6E,WAAW,CAAEwB,CAAC,IAAKA,CAAC,GAAG,CAAC,CAAC;IAC3B;EACF,CAAC,EACD,EACF,CAAC;EAED,MAAMgC,gBAAgB,GAAGzC,oBAAoB,CAAC,CAAC;;EAE/C;EACA,MAAM0C,SAAS,GAAG1J,OAAO,CACvB,OAAO;IACL8C,QAAQ;IACR2C,UAAU;IACV1C,UAAU;IACVH,UAAU;IACV6G,gBAAgB;IAChB5D,SAAS;IACTG,QAAQ,CAAE;EACZ,CAAC,CAAC,EACF,CAAClD,QAAQ,EAAE2C,UAAU,EAAE1C,UAAU,EAAEH,UAAU,EAAE6G,gBAAgB,EAAE5D,SAAS,EAAEG,QAAQ,CACtF,CAAC;EAED,MAAM2D,YAAY,GAAG3J,OAAO,CAC1B,OAAO;IACLsG,YAAY;IACZE,sBAAsB;IACtBU,eAAe;IACfS,cAAc;IACd6B,aAAa;IACb9B,gBAAgB;IAChB1G;EACF,CAAC,CAAC,EACF,CACEsF,YAAY,EACZE,sBAAsB,EACtBU,eAAe,EACfS,cAAc,EACd6B,aAAa,EACb9B,gBAAgB,CAEpB,CAAC;EAED1G,cAAc,CAAC,KAAK,CAAC;EAErB,oBACER,OAAA,CAACF,kBAAkB,CAACsJ,QAAQ;IAACC,KAAK,EAAEF,YAAa;IAAA5F,QAAA,eAC/CvD,OAAA,CAACH,eAAe,CAACuJ,QAAQ;MAACC,KAAK,EAAEH,SAAU;MAAA3F,QAAA,gBACzCvD,OAAA,CAACmC,QAAQ;QACPC,UAAU,EAAEA,UAAW;QACvBC,eAAe,EAAEkD,kBAAkB,CAAC3E,OAAQ;QAC5C0B,QAAQ,EAAEA,QAAS;QACnBC,UAAU,EAAEA;MAAW;QAAAiB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxB,CAAC,eAEF3D,OAAA;QAAKsD,SAAS,EAAC,UAAU;QAAAC,QAAA,eACvBvD,OAAA;UAAKsD,SAAS,EAAC,UAAU;UAAAC,QAAA,gBACvBvD,OAAA;YAAKyC,KAAK,EAAE;cAAEU,OAAO,EAAE,MAAM;cAAEC,GAAG,EAAE,EAAE;cAAEkG,UAAU,EAAE;YAAS,CAAE;YAAA/F,QAAA,gBAC7DvD,OAAA;cAAIyC,KAAK,EAAE;gBAAE8G,MAAM,EAAE;cAAE,CAAE;cAAAhG,QAAA,EAAC;YAA+B;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,eAC9D3D,OAAA;cAAQwJ,OAAO,EAAE1D,YAAa;cAAAvC,QAAA,EAAC;YAAW;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChD,CAAC,eAEN3D,OAAA,CAACJ,IAAI;YAAA4D,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,EAEPvB,UAAU,CAACwB,MAAM,KAAK,CAAC,iBACtB5D,OAAA;YAAKyC,KAAK,EAAE;cAAEgH,SAAS,EAAE,EAAE;cAAEC,OAAO,EAAE,GAAG;cAAE1G,QAAQ,EAAE;YAAG,CAAE;YAAAO,QAAA,EAAC;UAE3D;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CACN;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACkB;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACA,CAAC;AAElC;AAACoB,GAAA,CAzSuBD,GAAG;EAAA,QA0QzBtE,cAAc;AAAA;AAAAmJ,GAAA,GA1QQ7E,GAAG;AAAA,IAAAZ,EAAA,EAAAyF,GAAA;AAAAC,YAAA,CAAA1F,EAAA;AAAA0F,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}