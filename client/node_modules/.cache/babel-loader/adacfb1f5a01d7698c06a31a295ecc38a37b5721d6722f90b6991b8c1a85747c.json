{"ast":null,"code":"var _jsxFileName = \"/home/joshpoms/dndtest2/client/src/Grid.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useContext, useEffect, useRef, useState, useMemo } from \"react\";\nimport { DndContext, PointerSensor, TouchSensor, useSensor, useSensors, DragOverlay, useDndContext, useDroppable, pointerWithin } from \"@dnd-kit/core\";\nimport { snapCenterToCursor } from \"@dnd-kit/modifiers\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\nimport { ActionTypes } from \"./state/actions\";\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\n\n// -----------------------------\n// Cell droppable (panels only)\n// -----------------------------\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CellDroppable({\n  r,\n  c,\n  dark\n}) {\n  _s();\n  var _active$data, _active$data$current;\n  const {\n    active\n  } = useDndContext();\n  const isPanelDrag = (active === null || active === void 0 ? void 0 : (_active$data = active.data) === null || _active$data === void 0 ? void 0 : (_active$data$current = _active$data.current) === null || _active$data$current === void 0 ? void 0 : _active$data$current.role) === \"panel\";\n  const {\n    setNodeRef,\n    isOver\n  } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: {\n      role: \"grid:cell\",\n      row: r,\n      col: c\n    }\n  });\n  const highlight = isPanelDrag && isOver;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: setNodeRef,\n    style: {\n      background: highlight ? \"rgba(50,150,255,0.45)\" : dark ? \"#22272B\" : \"#2C333A\",\n      border: \"1px solid #3F444A\",\n      transition: \"background 80ms\",\n      pointerEvents: \"auto\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 37,\n    columnNumber: 5\n  }, this);\n}\n\n// -----------------------------\n// Collision: panels can only hit cells\n// -----------------------------\n_s(CellDroppable, \"xfLalxbUPsJqilrMIvibg7pdQe4=\", false, function () {\n  return [useDndContext, useDroppable];\n});\n_c = CellDroppable;\nfunction panelOnlyCollision(args) {\n  var _active$data2, _active$data2$current;\n  const {\n    active\n  } = args;\n  if ((active === null || active === void 0 ? void 0 : (_active$data2 = active.data) === null || _active$data2 === void 0 ? void 0 : (_active$data2$current = _active$data2.current) === null || _active$data2$current === void 0 ? void 0 : _active$data2$current.role) !== \"panel\") return [];\n  const hits = pointerWithin(args);\n  return hits.filter(h => {\n    var _h$data, _h$data$droppableCont, _h$data$droppableCont2, _h$data$droppableCont3;\n    return (h === null || h === void 0 ? void 0 : (_h$data = h.data) === null || _h$data === void 0 ? void 0 : (_h$data$droppableCont = _h$data.droppableContainer) === null || _h$data$droppableCont === void 0 ? void 0 : (_h$data$droppableCont2 = _h$data$droppableCont.data) === null || _h$data$droppableCont2 === void 0 ? void 0 : (_h$data$droppableCont3 = _h$data$droppableCont2.current) === null || _h$data$droppableCont3 === void 0 ? void 0 : _h$data$droppableCont3.role) === \"grid:cell\";\n  });\n}\nconst ensureSizes = (arr, count) => {\n  if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n  if (arr.length === count) return arr;\n  if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n  return arr.slice(0, count);\n};\nexport default function Grid() {\n  _s2();\n  var _useContext, _grid$rows, _grid$cols;\n  const {\n    gridId,\n    grid,\n    panels\n  } = useContext(GridDataContext);\n  const {\n    toggleToolbar,\n    addContainer\n  } = useContext(GridActionsContext);\n  const dispatch = (_useContext = useContext(GridActionsContext)) === null || _useContext === void 0 ? void 0 : _useContext.dispatch; // if you ever pass it; safe\n\n  // NOTE: you already have dispatch in reducer hooks, so we just import ActionTypes and use\n  // dispatch via React context? If you donâ€™t provide dispatch in GridActionsContext, weâ€™ll use window.dispatch fallback:\n  // Better: just use your reducer dispatch directly by adding it to GridActionsContext (recommended).\n  // For now, weâ€™ll grab it from a global fallback if missing:\n\n  const rows = (_grid$rows = grid === null || grid === void 0 ? void 0 : grid.rows) !== null && _grid$rows !== void 0 ? _grid$rows : 1;\n  const cols = (_grid$cols = grid === null || grid === void 0 ? void 0 : grid.cols) !== null && _grid$cols !== void 0 ? _grid$cols : 1;\n  const visiblePanels = (panels || []).filter(p => p.gridId === gridId);\n  const gridRef = useRef(null);\n  const [activeId, setActiveId] = useState(null);\n  const [panelDragging, setPanelDragging] = useState(false);\n  const panelDragLiveRef = useRef({\n    id: null,\n    dx: 0,\n    dy: 0\n  });\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid === null || grid === void 0 ? void 0 : grid.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid === null || grid === void 0 ? void 0 : grid.rowSizes, rows));\n  useEffect(() => setColSizes(ensureSizes(grid === null || grid === void 0 ? void 0 : grid.colSizes, cols)), [grid === null || grid === void 0 ? void 0 : grid.colSizes, cols]);\n  useEffect(() => setRowSizes(ensureSizes(grid === null || grid === void 0 ? void 0 : grid.rowSizes, rows)), [grid === null || grid === void 0 ? void 0 : grid.rowSizes, rows]);\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({\n        colSizes,\n        rowSizes\n      });\n    }\n  }, [colSizes, rowSizes]);\n  const colTemplate = colSizes.map(s => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map(s => `${s}fr`).join(\" \");\n  const sensors = useSensors(useSensor(TouchSensor, {\n    activationConstraint: {\n      delay: 500,\n      tolerance: 8\n    }\n  }), useSensor(PointerSensor));\n  const getPanel = id => visiblePanels.find(p => p.id === id);\n\n  // pointer â†’ cell (uses rowSizes/colSizes)\n  const getCellFromPointer = (clientX, clientY) => {\n    const rect = gridRef.current.getBoundingClientRect();\n    const relX = (clientX - rect.left) / rect.width;\n    const relY = (clientY - rect.top) / rect.height;\n    let col = 0;\n    let row = 0;\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    let acc = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      acc += colSizes[i];\n      if (relX < acc / totalCols) {\n        col = i;\n        break;\n      }\n    }\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n    acc = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      acc += rowSizes[i];\n      if (relY < acc / totalRows) {\n        row = i;\n        break;\n      }\n    }\n    return {\n      row,\n      col\n    };\n  };\n\n  // percent positions for resizer bars\n  const getColPosition = i => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n  const getRowPosition = i => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n\n  // ---- drag start/move/end (panels only)\n  const handleDragStart = event => {\n    setActiveId(event.active.id);\n    const data = event.active.data.current;\n    if ((data === null || data === void 0 ? void 0 : data.role) === \"panel\") {\n      panelDragLiveRef.current = {\n        id: data.panelId,\n        dx: 0,\n        dy: 0\n      };\n      setPanelDragging(true);\n    }\n  };\n  const handleDragMove = event => {\n    const data = event.active.data.current;\n    if (!data || data.role !== \"panel\") return;\n    const p = document.querySelector(`[data-panel-id='${data.panelId}']`);\n    if (p) {\n      p.style.transition = \"none\";\n      p.style.transform = `translate(${event.delta.x}px, ${event.delta.y}px)`;\n    }\n    panelDragLiveRef.current.dx = event.delta.x;\n    panelDragLiveRef.current.dy = event.delta.y;\n  };\n  const sanitizePanelPlacement = panel => ({\n    ...panel,\n    row: Math.max(0, Math.min(panel.row, rows - 1)),\n    col: Math.max(0, Math.min(panel.col, cols - 1)),\n    width: panel.width,\n    height: panel.height\n  });\n  const handleDragEnd = event => {\n    var _active$data3, _window$__moduliSocke, _window$__moduliSocke2;\n    const {\n      active\n    } = event;\n    setActiveId(null);\n    setPanelDragging(false);\n    const data = active === null || active === void 0 ? void 0 : (_active$data3 = active.data) === null || _active$data3 === void 0 ? void 0 : _active$data3.current;\n    if (!data || data.role !== \"panel\") return;\n    const panel = getPanel(active.id);\n    if (!panel) return;\n    const pointerX = event.activatorEvent.clientX + panelDragLiveRef.current.dx;\n    const pointerY = event.activatorEvent.clientY + panelDragLiveRef.current.dy;\n    const {\n      col,\n      row\n    } = getCellFromPointer(pointerX, pointerY);\n    const updated = sanitizePanelPlacement({\n      ...panel,\n      col,\n      row\n    });\n\n    // optimistic local\n    appDispatch({\n      type: ActionTypes.PATCH_PANEL,\n      payload: {\n        panel: updated\n      }\n    });\n\n    // server\n    // IMPORTANT: your server expects socket.emit(\"update_panel\", { panel })\n    // We canâ€™t import socket here cleanly unless you want to â€” easiest:\n    (_window$__moduliSocke = window.__moduliSocket) === null || _window$__moduliSocke === void 0 ? void 0 : (_window$__moduliSocke2 = _window$__moduliSocke.emit) === null || _window$__moduliSocke2 === void 0 ? void 0 : _window$__moduliSocke2.call(_window$__moduliSocke, \"update_panel\", {\n      panel: updated\n    });\n\n    // reset transform\n    const p = document.querySelector(`[data-panel-id='${panel.id}']`);\n    if (p) {\n      p.style.transition = \"transform 150ms ease\";\n      p.style.transform = \"translate(0,0)\";\n    }\n    panelDragLiveRef.current = {\n      id: null,\n      dx: 0,\n      dy: 0\n    };\n  };\n\n  // ---- grid resizing: commit once on stop\n  const resizePendingRef = useRef({\n    rowSizes: null,\n    colSizes: null\n  });\n  const finalizeResize = () => {\n    var _pending$rowSizes, _pending$colSizes, _window$__moduliSocke3, _window$__moduliSocke4;\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!gridId) return;\n    const nextRowSizes = (_pending$rowSizes = pending.rowSizes) !== null && _pending$rowSizes !== void 0 ? _pending$rowSizes : rowSizes;\n    const nextColSizes = (_pending$colSizes = pending.colSizes) !== null && _pending$colSizes !== void 0 ? _pending$colSizes : colSizes;\n    appDispatch({\n      type: ActionTypes.PATCH_GRID,\n      payload: {\n        grid: {\n          rowSizes: nextRowSizes,\n          colSizes: nextColSizes\n        }\n      }\n    });\n    (_window$__moduliSocke3 = window.__moduliSocket) === null || _window$__moduliSocke3 === void 0 ? void 0 : (_window$__moduliSocke4 = _window$__moduliSocke3.emit) === null || _window$__moduliSocke4 === void 0 ? void 0 : _window$__moduliSocke4.call(_window$__moduliSocke3, \"update_grid\", {\n      gridId,\n      rowSizes: nextRowSizes,\n      colSizes: nextColSizes\n    });\n    resizePendingRef.current = {\n      rowSizes: null,\n      colSizes: null\n    };\n  };\n  const getGridWidth = () => {\n    var _gridRef$current;\n    return ((_gridRef$current = gridRef.current) === null || _gridRef$current === void 0 ? void 0 : _gridRef$current.clientWidth) || 1;\n  };\n  const getGridHeight = () => {\n    var _gridRef$current2;\n    return ((_gridRef$current2 = gridRef.current) === null || _gridRef$current2 === void 0 ? void 0 : _gridRef$current2.clientHeight) || 1;\n  };\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridWidth * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridHeight * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n  const getClientX = e => e.touches ? e.touches[0].clientX : e.clientX;\n  const getClientY = e => e.touches ? e.touches[0].clientY : e.clientY;\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  // --- IMPORTANT: give Grid access to socket+dispatch without threading props everywhere\n  // Set these once (App should set them too, but this is safe)\n  useEffect(() => {\n    window.__moduliSocket = window.__moduliSocket || null;\n    window.__moduliDispatch = window.__moduliDispatch || null;\n  }, []);\n  return /*#__PURE__*/_jsxDEV(DndContext, {\n    sensors: sensors,\n    collisionDetection: panelOnlyCollision,\n    onDragStart: handleDragStart,\n    onDragMove: handleDragMove,\n    onDragEnd: handleDragEnd,\n    modifiers: [snapCenterToCursor],\n    autoScroll: {\n      threshold: {\n        x: 0,\n        y: 0.2\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        inset: 0,\n        background: \"#1D2125\",\n        overflow: \"hidden\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: toggleToolbar,\n        style: {\n          position: \"absolute\",\n          top: 10,\n          right: 10,\n          width: 42,\n          height: 42,\n          background: \"#2C313A\",\n          border: \"1px solid #444\",\n          borderRadius: 8,\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          color: \"white\",\n          cursor: \"pointer\",\n          zIndex: 4000\n        },\n        children: \"\\uD83D\\uDD27\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: gridRef,\n        style: {\n          position: \"absolute\",\n          inset: 0,\n          display: \"grid\",\n          gridTemplateColumns: colTemplate,\n          gridTemplateRows: rowTemplate,\n          width: \"100%\",\n          height: \"93vh\",\n          overflow: \"hidden\",\n          touchAction: \"none\",\n          overscrollBehaviorY: \"none\"\n        },\n        children: [[...Array(rows)].map((_, r) => [...Array(cols)].map((_, c) => {\n          const dark = (r + c) % 2 === 0;\n          return /*#__PURE__*/_jsxDEV(CellDroppable, {\n            r: r,\n            c: c,\n            dark: dark\n          }, `${r}-${c}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 22\n          }, this);\n        })), [...Array(cols - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          onMouseDown: e => startColResize(e, i),\n          onTouchStart: e => startColResize(e, i),\n          style: {\n            position: \"absolute\",\n            top: 0,\n            bottom: 0,\n            left: `${getColPosition(i)}%`,\n            width: 6,\n            marginLeft: -3,\n            cursor: \"col-resize\",\n            zIndex: 50,\n            background: \"transparent\"\n          }\n        }, `col-resize-${i}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 13\n        }, this)), [...Array(rows - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          onMouseDown: e => startRowResize(e, i),\n          onTouchStart: e => startRowResize(e, i),\n          style: {\n            position: \"absolute\",\n            left: 0,\n            right: 0,\n            top: `${getRowPosition(i)}%`,\n            height: 6,\n            marginTop: -3,\n            cursor: \"row-resize\",\n            zIndex: 50,\n            background: \"transparent\"\n          }\n        }, `row-resize-${i}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 13\n        }, this)), visiblePanels.map(p => /*#__PURE__*/_jsxDEV(Panel, {\n          panel: p,\n          gridRef: gridRef,\n          cols: cols,\n          rows: rows,\n          activeId: activeId,\n          gridActive: panelDragging,\n          onAddContainer: () => addContainer === null || addContainer === void 0 ? void 0 : addContainer({\n            panelId: p.id\n          })\n        }, p.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 451,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DragOverlay, {\n      dropAnimation: null,\n      zIndex: 100000,\n      children: activeId && getPanel(activeId) ? /*#__PURE__*/_jsxDEV(PanelClone, {\n        panel: getPanel(activeId)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 43\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 355,\n    columnNumber: 5\n  }, this);\n}\n_s2(Grid, \"8uX9Lc6rG4/4AAGAfbiLHunDerQ=\", false, function () {\n  return [useSensors, useSensor, useSensor];\n});\n_c2 = Grid;\nvar _c, _c2;\n$RefreshReg$(_c, \"CellDroppable\");\n$RefreshReg$(_c2, \"Grid\");","map":{"version":3,"names":["React","useContext","useEffect","useRef","useState","useMemo","DndContext","PointerSensor","TouchSensor","useSensor","useSensors","DragOverlay","useDndContext","useDroppable","pointerWithin","snapCenterToCursor","GridDataContext","GridActionsContext","ActionTypes","Panel","PanelClone","jsxDEV","_jsxDEV","CellDroppable","r","c","dark","_s","_active$data","_active$data$current","active","isPanelDrag","data","current","role","setNodeRef","isOver","id","row","col","highlight","ref","style","background","border","transition","pointerEvents","fileName","_jsxFileName","lineNumber","columnNumber","_c","panelOnlyCollision","args","_active$data2","_active$data2$current","hits","filter","h","_h$data","_h$data$droppableCont","_h$data$droppableCont2","_h$data$droppableCont3","droppableContainer","ensureSizes","arr","count","Array","isArray","length","fill","slice","Grid","_s2","_useContext","_grid$rows","_grid$cols","gridId","grid","panels","toggleToolbar","addContainer","dispatch","rows","cols","visiblePanels","p","gridRef","activeId","setActiveId","panelDragging","setPanelDragging","panelDragLiveRef","dx","dy","colSizes","setColSizes","rowSizes","setRowSizes","dataset","sizes","JSON","stringify","colTemplate","map","s","join","rowTemplate","sensors","activationConstraint","delay","tolerance","getPanel","find","getCellFromPointer","clientX","clientY","rect","getBoundingClientRect","relX","left","width","relY","top","height","totalCols","reduce","a","b","acc","i","totalRows","getColPosition","total","before","getRowPosition","handleDragStart","event","panelId","handleDragMove","document","querySelector","transform","delta","x","y","sanitizePanelPlacement","panel","Math","max","min","handleDragEnd","_active$data3","_window$__moduliSocke","_window$__moduliSocke2","pointerX","activatorEvent","pointerY","updated","appDispatch","type","PATCH_PANEL","payload","window","__moduliSocket","emit","call","resizePendingRef","finalizeResize","_pending$rowSizes","_pending$colSizes","_window$__moduliSocke3","_window$__moduliSocke4","pending","nextRowSizes","nextColSizes","PATCH_GRID","getGridWidth","_gridRef$current","clientWidth","getGridHeight","_gridRef$current2","clientHeight","resizeColumn","pixelDelta","gridWidth","next","frDelta","copy","resizeRow","gridHeight","getClientX","e","touches","getClientY","startColResize","preventDefault","startX","move","ev","currentX","stop","removeEventListener","addEventListener","startRowResize","startY","currentY","__moduliDispatch","collisionDetection","onDragStart","onDragMove","onDragEnd","modifiers","autoScroll","threshold","children","position","inset","overflow","onClick","right","borderRadius","display","alignItems","justifyContent","color","cursor","zIndex","gridTemplateColumns","gridTemplateRows","touchAction","overscrollBehaviorY","_","onMouseDown","onTouchStart","bottom","marginLeft","marginTop","gridActive","onAddContainer","dropAnimation","_c2","$RefreshReg$"],"sources":["/home/joshpoms/dndtest2/client/src/Grid.jsx"],"sourcesContent":["import React, { useContext, useEffect, useRef, useState, useMemo } from \"react\";\nimport {\n  DndContext,\n  PointerSensor,\n  TouchSensor,\n  useSensor,\n  useSensors,\n  DragOverlay,\n  useDndContext,\n  useDroppable,\n  pointerWithin,\n} from \"@dnd-kit/core\";\nimport { snapCenterToCursor } from \"@dnd-kit/modifiers\";\n\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\nimport { ActionTypes } from \"./state/actions\";\n\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\n\n// -----------------------------\n// Cell droppable (panels only)\n// -----------------------------\nfunction CellDroppable({ r, c, dark }) {\n  const { active } = useDndContext();\n  const isPanelDrag = active?.data?.current?.role === \"panel\";\n\n  const { setNodeRef, isOver } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: { role: \"grid:cell\", row: r, col: c },\n  });\n\n  const highlight = isPanelDrag && isOver;\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={{\n        background: highlight\n          ? \"rgba(50,150,255,0.45)\"\n          : dark\n          ? \"#22272B\"\n          : \"#2C333A\",\n        border: \"1px solid #3F444A\",\n        transition: \"background 80ms\",\n        pointerEvents: \"auto\",\n      }}\n    />\n  );\n}\n\n// -----------------------------\n// Collision: panels can only hit cells\n// -----------------------------\nfunction panelOnlyCollision(args) {\n  const { active } = args;\n  if (active?.data?.current?.role !== \"panel\") return [];\n  const hits = pointerWithin(args);\n  return hits.filter((h) => h?.data?.droppableContainer?.data?.current?.role === \"grid:cell\");\n}\n\nconst ensureSizes = (arr, count) => {\n  if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n  if (arr.length === count) return arr;\n  if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n  return arr.slice(0, count);\n};\n\nexport default function Grid() {\n  const { gridId, grid, panels } = useContext(GridDataContext);\n  const { toggleToolbar, addContainer } = useContext(GridActionsContext);\n  const dispatch = useContext(GridActionsContext)?.dispatch; // if you ever pass it; safe\n\n  // NOTE: you already have dispatch in reducer hooks, so we just import ActionTypes and use\n  // dispatch via React context? If you donâ€™t provide dispatch in GridActionsContext, weâ€™ll use window.dispatch fallback:\n  // Better: just use your reducer dispatch directly by adding it to GridActionsContext (recommended).\n  // For now, weâ€™ll grab it from a global fallback if missing:\n\n\n  const rows = grid?.rows ?? 1;\n  const cols = grid?.cols ?? 1;\n\n  const visiblePanels = (panels || []).filter((p) => p.gridId === gridId);\n\n  const gridRef = useRef(null);\n  const [activeId, setActiveId] = useState(null);\n  const [panelDragging, setPanelDragging] = useState(false);\n\n  const panelDragLiveRef = useRef({ id: null, dx: 0, dy: 0 });\n\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid?.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid?.rowSizes, rows));\n\n  useEffect(() => setColSizes(ensureSizes(grid?.colSizes, cols)), [grid?.colSizes, cols]);\n  useEffect(() => setRowSizes(ensureSizes(grid?.rowSizes, rows)), [grid?.rowSizes, rows]);\n\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({ colSizes, rowSizes });\n    }\n  }, [colSizes, rowSizes]);\n\n  const colTemplate = colSizes.map((s) => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map((s) => `${s}fr`).join(\" \");\n\n  const sensors = useSensors(\n    useSensor(TouchSensor, { activationConstraint: { delay: 500, tolerance: 8 } }),\n    useSensor(PointerSensor)\n  );\n\n  const getPanel = (id) => visiblePanels.find((p) => p.id === id);\n\n  // pointer â†’ cell (uses rowSizes/colSizes)\n  const getCellFromPointer = (clientX, clientY) => {\n    const rect = gridRef.current.getBoundingClientRect();\n    const relX = (clientX - rect.left) / rect.width;\n    const relY = (clientY - rect.top) / rect.height;\n\n    let col = 0;\n    let row = 0;\n\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    let acc = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      acc += colSizes[i];\n      if (relX < acc / totalCols) {\n        col = i;\n        break;\n      }\n    }\n\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n    acc = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      acc += rowSizes[i];\n      if (relY < acc / totalRows) {\n        row = i;\n        break;\n      }\n    }\n\n    return { row, col };\n  };\n\n  // percent positions for resizer bars\n  const getColPosition = (i) => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n  const getRowPosition = (i) => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n\n  // ---- drag start/move/end (panels only)\n  const handleDragStart = (event) => {\n    setActiveId(event.active.id);\n\n    const data = event.active.data.current;\n    if (data?.role === \"panel\") {\n      panelDragLiveRef.current = { id: data.panelId, dx: 0, dy: 0 };\n      setPanelDragging(true);\n    }\n  };\n\n  const handleDragMove = (event) => {\n    const data = event.active.data.current;\n    if (!data || data.role !== \"panel\") return;\n\n    const p = document.querySelector(`[data-panel-id='${data.panelId}']`);\n    if (p) {\n      p.style.transition = \"none\";\n      p.style.transform = `translate(${event.delta.x}px, ${event.delta.y}px)`;\n    }\n\n    panelDragLiveRef.current.dx = event.delta.x;\n    panelDragLiveRef.current.dy = event.delta.y;\n  };\n\n  const sanitizePanelPlacement = (panel) => ({\n    ...panel,\n    row: Math.max(0, Math.min(panel.row, rows - 1)),\n    col: Math.max(0, Math.min(panel.col, cols - 1)),\n    width: panel.width,\n    height: panel.height,\n  });\n\n  const handleDragEnd = (event) => {\n    const { active } = event;\n\n    setActiveId(null);\n    setPanelDragging(false);\n\n    const data = active?.data?.current;\n    if (!data || data.role !== \"panel\") return;\n\n    const panel = getPanel(active.id);\n    if (!panel) return;\n\n    const pointerX = event.activatorEvent.clientX + panelDragLiveRef.current.dx;\n    const pointerY = event.activatorEvent.clientY + panelDragLiveRef.current.dy;\n\n    const { col, row } = getCellFromPointer(pointerX, pointerY);\n\n    const updated = sanitizePanelPlacement({ ...panel, col, row });\n\n    // optimistic local\n    appDispatch({ type: ActionTypes.PATCH_PANEL, payload: { panel: updated } });\n\n    // server\n    // IMPORTANT: your server expects socket.emit(\"update_panel\", { panel })\n    // We canâ€™t import socket here cleanly unless you want to â€” easiest:\n    window.__moduliSocket?.emit?.(\"update_panel\", { panel: updated });\n\n    // reset transform\n    const p = document.querySelector(`[data-panel-id='${panel.id}']`);\n    if (p) {\n      p.style.transition = \"transform 150ms ease\";\n      p.style.transform = \"translate(0,0)\";\n    }\n\n    panelDragLiveRef.current = { id: null, dx: 0, dy: 0 };\n  };\n\n  // ---- grid resizing: commit once on stop\n  const resizePendingRef = useRef({ rowSizes: null, colSizes: null });\n\n  const finalizeResize = () => {\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!gridId) return;\n\n    const nextRowSizes = pending.rowSizes ?? rowSizes;\n    const nextColSizes = pending.colSizes ?? colSizes;\n\n    appDispatch({\n      type: ActionTypes.PATCH_GRID,\n      payload: { grid: { rowSizes: nextRowSizes, colSizes: nextColSizes } },\n    });\n\n    window.__moduliSocket?.emit?.(\"update_grid\", {\n      gridId,\n      rowSizes: nextRowSizes,\n      colSizes: nextColSizes,\n    });\n\n    resizePendingRef.current = { rowSizes: null, colSizes: null };\n  };\n\n  const getGridWidth = () => gridRef.current?.clientWidth || 1;\n  const getGridHeight = () => gridRef.current?.clientHeight || 1;\n\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridWidth) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridHeight) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n\n  const getClientX = (e) => (e.touches ? e.touches[0].clientX : e.clientX);\n  const getClientY = (e) => (e.touches ? e.touches[0].clientY : e.clientY);\n\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  // --- IMPORTANT: give Grid access to socket+dispatch without threading props everywhere\n  // Set these once (App should set them too, but this is safe)\n  useEffect(() => {\n    window.__moduliSocket = window.__moduliSocket || null;\n    window.__moduliDispatch = window.__moduliDispatch || null;\n  }, []);\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={panelOnlyCollision}\n      onDragStart={handleDragStart}\n      onDragMove={handleDragMove}\n      onDragEnd={handleDragEnd}\n      modifiers={[snapCenterToCursor]}\n      autoScroll={{ threshold: { x: 0, y: 0.2 } }}\n    >\n      <div style={{ position: \"absolute\", inset: 0, background: \"#1D2125\", overflow: \"hidden\" }}>\n        <div\n          onClick={toggleToolbar}\n          style={{\n            position: \"absolute\",\n            top: 10,\n            right: 10,\n            width: 42,\n            height: 42,\n            background: \"#2C313A\",\n            border: \"1px solid #444\",\n            borderRadius: 8,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            color: \"white\",\n            cursor: \"pointer\",\n            zIndex: 4000,\n          }}\n        >\n          ðŸ”§\n        </div>\n\n        <div\n          ref={gridRef}\n          style={{\n            position: \"absolute\",\n            inset: 0,\n            display: \"grid\",\n            gridTemplateColumns: colTemplate,\n            gridTemplateRows: rowTemplate,\n            width: \"100%\",\n            height: \"93vh\",\n            overflow: \"hidden\",\n            touchAction: \"none\",\n            overscrollBehaviorY: \"none\",\n          }}\n        >\n          {[...Array(rows)].map((_, r) =>\n            [...Array(cols)].map((_, c) => {\n              const dark = (r + c) % 2 === 0;\n              return <CellDroppable key={`${r}-${c}`} r={r} c={c} dark={dark} />;\n            })\n          )}\n\n          {/* Vertical resizers */}\n          {[...Array(cols - 1)].map((_, i) => (\n            <div\n              key={`col-resize-${i}`}\n              onMouseDown={(e) => startColResize(e, i)}\n              onTouchStart={(e) => startColResize(e, i)}\n              style={{\n                position: \"absolute\",\n                top: 0,\n                bottom: 0,\n                left: `${getColPosition(i)}%`,\n                width: 6,\n                marginLeft: -3,\n                cursor: \"col-resize\",\n                zIndex: 50,\n                background: \"transparent\",\n              }}\n            />\n          ))}\n\n          {/* Row resizers */}\n          {[...Array(rows - 1)].map((_, i) => (\n            <div\n              key={`row-resize-${i}`}\n              onMouseDown={(e) => startRowResize(e, i)}\n              onTouchStart={(e) => startRowResize(e, i)}\n              style={{\n                position: \"absolute\",\n                left: 0,\n                right: 0,\n                top: `${getRowPosition(i)}%`,\n                height: 6,\n                marginTop: -3,\n                cursor: \"row-resize\",\n                zIndex: 50,\n                background: \"transparent\",\n              }}\n            />\n          ))}\n\n          {/* Panels */}\n          {visiblePanels.map((p) => (\n            <Panel\n              key={p.id}\n              panel={p}\n              gridRef={gridRef}\n              cols={cols}\n              rows={rows}\n              activeId={activeId}\n              gridActive={panelDragging}\n              onAddContainer={() => addContainer?.({ panelId: p.id })}\n            />\n          ))}\n        </div>\n      </div>\n\n      <DragOverlay dropAnimation={null} zIndex={100000}>\n        {activeId && getPanel(activeId) ? <PanelClone panel={getPanel(activeId)} /> : null}\n      </DragOverlay>\n    </DndContext>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}