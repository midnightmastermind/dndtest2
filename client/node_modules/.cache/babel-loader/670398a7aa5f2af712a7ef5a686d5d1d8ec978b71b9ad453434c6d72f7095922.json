{"ast":null,"code":"// state/masterReducer.js\nimport { ActionTypes } from \"./actions\";\nexport function masterReducer(state, action) {\n  switch (action.type) {\n    case ActionTypes.ADD_CONTAINER:\n      {\n        const {\n          id,\n          label\n        } = action.payload;\n        if (!id) return state;\n\n        // ✅ prevent duplicate container (optimistic + server echo)\n        if (state.containers.some(c => c.id === id)) return state;\n        return {\n          ...state,\n          containers: [...state.containers, {\n            id,\n            label,\n            items: []\n          }]\n        };\n      }\n    case ActionTypes.ADD_INSTANCE_TO_CONTAINER:\n      {\n        const {\n          containerId,\n          instance\n        } = action.payload;\n        if (!containerId || !(instance !== null && instance !== void 0 && instance.id)) return state;\n\n        // ✅ prevent duplicate instance (optimistic + server echo)\n        const instanceExists = state.instances.some(i => i.id === instance.id);\n        const nextInstances = instanceExists ? state.instances : [...state.instances, instance];\n        return {\n          ...state,\n          instances: nextInstances,\n          containers: state.containers.map(c => {\n            if (c.id !== containerId) return c;\n\n            // ✅ prevent duplicate id in items\n            if (c.items.includes(instance.id)) return c;\n            return {\n              ...c,\n              items: [...c.items, instance.id]\n            };\n          })\n        };\n      }\n    case ActionTypes.SET_ACTIVE_ID:\n      {\n        return {\n          ...state,\n          activeId: action.payload.activeId\n        };\n      }\n    case ActionTypes.SET_ACTIVE_SIZE:\n      {\n        return {\n          ...state,\n          activeSize: action.payload.activeSize\n        };\n      }\n    case ActionTypes.SET_DEBUG_EVENT:\n      {\n        return {\n          ...state,\n          debugEvent: action.payload.debugEvent\n        };\n      }\n    case ActionTypes.SET_CONTAINERS:\n      {\n        return {\n          ...state,\n          containers: action.payload.containers\n        };\n      }\n    case ActionTypes.SOFT_TICK:\n      {\n        return {\n          ...state,\n          softTick: state.softTick + 1\n        };\n      }\n    case ActionTypes.SET_INSTANCES:\n      {\n        return {\n          ...state,\n          instances: action.payload.instances\n        };\n      }\n    case ActionTypes.PATCH_CONTAINER_ITEMS:\n      {\n        const {\n          containerId,\n          items\n        } = action.payload;\n        return {\n          ...state,\n          containers: state.containers.map(c => c.id === containerId ? {\n            ...c,\n            items\n          } : c)\n        };\n      }\n    case ActionTypes.PATCH_INSTANCE:\n      {\n        const {\n          instance\n        } = action.payload;\n        return {\n          ...state,\n          instances: state.instances.map(i => i.id === instance.id ? instance : i)\n        };\n      }\n    default:\n      return state;\n  }\n}","map":{"version":3,"names":["ActionTypes","masterReducer","state","action","type","ADD_CONTAINER","id","label","payload","containers","some","c","items","ADD_INSTANCE_TO_CONTAINER","containerId","instance","instanceExists","instances","i","nextInstances","map","includes","SET_ACTIVE_ID","activeId","SET_ACTIVE_SIZE","activeSize","SET_DEBUG_EVENT","debugEvent","SET_CONTAINERS","SOFT_TICK","softTick","SET_INSTANCES","PATCH_CONTAINER_ITEMS","PATCH_INSTANCE"],"sources":["/home/joshpoms/dndtest2/client/src/state/masterReducer.js"],"sourcesContent":["// state/masterReducer.js\nimport { ActionTypes } from \"./actions\";\n\nexport function masterReducer(state, action) {\n    switch (action.type) {\n        case ActionTypes.ADD_CONTAINER: {\n            const { id, label } = action.payload;\n            if (!id) return state;\n\n            // ✅ prevent duplicate container (optimistic + server echo)\n            if (state.containers.some((c) => c.id === id)) return state;\n\n            return {\n                ...state,\n                containers: [...state.containers, { id, label, items: [] }],\n            };\n        }\n\n        case ActionTypes.ADD_INSTANCE_TO_CONTAINER: {\n            const { containerId, instance } = action.payload;\n            if (!containerId || !instance?.id) return state;\n\n            // ✅ prevent duplicate instance (optimistic + server echo)\n            const instanceExists = state.instances.some((i) => i.id === instance.id);\n            const nextInstances = instanceExists ? state.instances : [...state.instances, instance];\n\n            return {\n                ...state,\n                instances: nextInstances,\n                containers: state.containers.map((c) => {\n                    if (c.id !== containerId) return c;\n\n                    // ✅ prevent duplicate id in items\n                    if (c.items.includes(instance.id)) return c;\n\n                    return { ...c, items: [...c.items, instance.id] };\n                }),\n            };\n        }\n\n        case ActionTypes.SET_ACTIVE_ID: {\n            return { ...state, activeId: action.payload.activeId };\n        }\n\n        case ActionTypes.SET_ACTIVE_SIZE: {\n            return { ...state, activeSize: action.payload.activeSize };\n        }\n\n        case ActionTypes.SET_DEBUG_EVENT: {\n            return { ...state, debugEvent: action.payload.debugEvent };\n        }\n\n        case ActionTypes.SET_CONTAINERS: {\n            return { ...state, containers: action.payload.containers };\n        }\n\n        case ActionTypes.SOFT_TICK: {\n            return { ...state, softTick: state.softTick + 1 };\n        }\n        case ActionTypes.SET_INSTANCES: {\n            return { ...state, instances: action.payload.instances };\n        }\n\n        case ActionTypes.PATCH_CONTAINER_ITEMS: {\n            const { containerId, items } = action.payload;\n            return {\n                ...state,\n                containers: state.containers.map((c) =>\n                    c.id === containerId ? { ...c, items } : c\n                ),\n            };\n        }\n\n        case ActionTypes.PATCH_INSTANCE: {\n            const { instance } = action.payload;\n            return {\n                ...state,\n                instances: state.instances.map((i) => (i.id === instance.id ? instance : i)),\n            };\n        }\n\n        default:\n            return state;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}