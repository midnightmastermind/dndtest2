{"ast":null,"code":"var _s = $RefreshSig$();\n// dnd/useDndReorderCoordinator.js\nimport { useCallback, useMemo, useRef } from \"react\";\nimport { createContainerAction, createInstanceInContainerAction, setActiveIdAction, setActiveSizeAction, setContainersAction, setDebugEventAction, softTickAction } from \"../state/actions\";\n\n// ---------- utilities ----------\nfunction uid() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 10);\n}\nfunction arrayMove(arr, from, to) {\n  const copy = [...arr];\n  const [item] = copy.splice(from, 1);\n  copy.splice(to, 0, item);\n  return copy;\n}\nfunction deepCloneContainers(containers) {\n  return containers.map(c => ({\n    ...c,\n    items: [...c.items]\n  }));\n}\n\n// ✅ Safe event snapshot for debug UI (no circular refs)\nfunction pickEvent(event, type) {\n  var _a$data, _o$data, _activeData$role, _activeData$container, _overData$role, _overData$containerId;\n  const a = event === null || event === void 0 ? void 0 : event.active;\n  const o = event === null || event === void 0 ? void 0 : event.over;\n  const activeData = (a === null || a === void 0 ? void 0 : (_a$data = a.data) === null || _a$data === void 0 ? void 0 : _a$data.current) || null;\n  const overData = (o === null || o === void 0 ? void 0 : (_o$data = o.data) === null || _o$data === void 0 ? void 0 : _o$data.current) || null;\n  return {\n    type,\n    ts: Date.now(),\n    active: a ? {\n      id: a.id,\n      role: (_activeData$role = activeData === null || activeData === void 0 ? void 0 : activeData.role) !== null && _activeData$role !== void 0 ? _activeData$role : null,\n      containerId: (_activeData$container = activeData === null || activeData === void 0 ? void 0 : activeData.containerId) !== null && _activeData$container !== void 0 ? _activeData$container : null,\n      data: activeData\n    } : null,\n    over: o ? {\n      id: o.id,\n      role: (_overData$role = overData === null || overData === void 0 ? void 0 : overData.role) !== null && _overData$role !== void 0 ? _overData$role : null,\n      containerId: (_overData$containerId = overData === null || overData === void 0 ? void 0 : overData.containerId) !== null && _overData$containerId !== void 0 ? _overData$containerId : null,\n      data: overData\n    } : null\n  };\n}\nfunction getOverContainerId(over) {\n  var _over$data, _over$data$current;\n  if (!over) return null;\n\n  // preferred: explicit data\n  const cid = (_over$data = over.data) === null || _over$data === void 0 ? void 0 : (_over$data$current = _over$data.current) === null || _over$data$current === void 0 ? void 0 : _over$data$current.containerId;\n  if (cid) return cid;\n\n  // fallback: parse droppable id patterns (list:/top:/bottom:)\n  if (typeof over.id === \"string\") {\n    if (over.id.startsWith(\"list:\")) return over.id.slice(\"list:\".length);\n    if (over.id.startsWith(\"top:\")) return over.id.slice(\"top:\".length);\n    if (over.id.startsWith(\"bottom:\")) return over.id.slice(\"bottom:\".length);\n  }\n  return null;\n}\nfunction findContainerByInstanceId(instanceId, list) {\n  return list.find(c => c.items.includes(instanceId));\n}\nfunction itemsEqual(a = [], b = []) {\n  if (a === b) return true;\n  if (!a || !b) return false;\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n  return true;\n}\n\n// ---------- hook ----------\nexport function useDndReorderCoordinator({\n  state,\n  dispatch,\n  socket\n}) {\n  _s();\n  // soft-sort draft ref (kept out of reducer on purpose)\n  const containersDraftRef = useRef(null);\n  const lastOverRef = useRef({\n    activeId: null,\n    overId: null,\n    overRole: null,\n    overContainerId: null\n  });\n  const addContainer = useCallback(() => {\n    const id = uid();\n    const label = `List ${state.containers.length + 1}`;\n\n    // optimistic UI\n    dispatch(createContainerAction({\n      id,\n      label\n    }));\n\n    // persist\n    socket === null || socket === void 0 ? void 0 : socket.emit(\"create_container\", {\n      container: {\n        id,\n        label\n      }\n    });\n  }, [dispatch, socket, state.containers.length]);\n  const createInstanceInContainer = useCallback(containerId => {\n    const id = uid();\n    const label = `Item ${state.instances.length + 1}`;\n\n    // optimistic UI\n    dispatch(createInstanceInContainerAction({\n      containerId,\n      instance: {\n        id,\n        label\n      }\n    }));\n\n    // persist\n    socket === null || socket === void 0 ? void 0 : socket.emit(\"create_instance_in_container\", {\n      containerId,\n      instance: {\n        id,\n        label\n      }\n    });\n  }, [dispatch, socket, state.instances.length]);\n  const getWorkingContainers = useCallback(() => {\n    var _containersDraftRef$c;\n    return (_containersDraftRef$c = containersDraftRef.current) !== null && _containersDraftRef$c !== void 0 ? _containersDraftRef$c : state.containers;\n  }, [state.containers]);\n  const handleDragStart = useCallback(event => {\n    var _event$active$rect, _event$active$rect$cu;\n    dispatch(setDebugEventAction(pickEvent(event, \"start\")));\n    dispatch(setActiveIdAction(event.active.id));\n    const rect = (_event$active$rect = event.active.rect) === null || _event$active$rect === void 0 ? void 0 : (_event$active$rect$cu = _event$active$rect.current) === null || _event$active$rect$cu === void 0 ? void 0 : _event$active$rect$cu.initial;\n    if (rect) dispatch(setActiveSizeAction({\n      width: rect.width,\n      height: rect.height\n    }));\n    containersDraftRef.current = deepCloneContainers(state.containers);\n    lastOverRef.current = {\n      activeId: event.active.id,\n      overId: null,\n      overRole: null,\n      overContainerId: null\n    };\n    dispatch(softTickAction());\n  }, [dispatch, state.containers]);\n  const handleDragCancel = useCallback(() => {\n    dispatch(setDebugEventAction({\n      type: \"cancel\",\n      ts: Date.now()\n    }));\n    dispatch(setActiveIdAction(null));\n    dispatch(setActiveSizeAction(null));\n    containersDraftRef.current = null;\n    dispatch(softTickAction());\n  }, [dispatch]);\n  const handleDragOver = useCallback(event => {\n    var _over$data$current$ro, _over$data$current2, _over$data$current$co, _over$data$current3, _active$data$current;\n    console.log(\"dragover:start\");\n    const {\n      active,\n      over\n    } = event;\n    if (!over) return;\n    const nextOverRole = (_over$data$current$ro = (_over$data$current2 = over.data.current) === null || _over$data$current2 === void 0 ? void 0 : _over$data$current2.role) !== null && _over$data$current$ro !== void 0 ? _over$data$current$ro : null;\n    const nextOverContainerId = (_over$data$current$co = (_over$data$current3 = over.data.current) === null || _over$data$current3 === void 0 ? void 0 : _over$data$current3.containerId) !== null && _over$data$current$co !== void 0 ? _over$data$current$co : typeof over.id === \"string\" ? over.id : null;\n    const last = lastOverRef.current;\n    const sameOver = last.activeId === active.id && last.overId === over.id && last.overRole === nextOverRole && last.overContainerId === nextOverContainerId;\n    if (!sameOver) {\n      lastOverRef.current = {\n        activeId: active.id,\n        overId: over.id,\n        overRole: nextOverRole,\n        overContainerId: nextOverContainerId\n      };\n      dispatch(setDebugEventAction(pickEvent(event, \"over\")));\n    }\n    const draft = containersDraftRef.current;\n    if (!draft) return;\n    const activeRole = (_active$data$current = active.data.current) === null || _active$data$current === void 0 ? void 0 : _active$data$current.role;\n    const overRole = nextOverRole;\n    if (activeRole === \"container\") return;\n    if (activeRole !== \"instance\") return;\n    const instanceId = active.id;\n    const fromContainer = findContainerByInstanceId(instanceId, draft);\n    if (!fromContainer) return;\n    const toContainerId = getOverContainerId(over);\n    if (!toContainerId) return;\n    const toContainer = draft.find(c => c.id === toContainerId);\n    if (!toContainer) return;\n    const fromId = fromContainer.id;\n    const toId = toContainer.id;\n    const fromIndex = fromContainer.items.indexOf(instanceId);\n    if (fromIndex === -1) return;\n    const isOverInstance = overRole === \"instance\";\n    const overInstanceId = isOverInstance ? over.id : null;\n    let toIndex;\n    if (!overInstanceId) {\n      toIndex = toContainer.items.length;\n    } else {\n      const idx = toContainer.items.indexOf(overInstanceId);\n      toIndex = idx >= 0 ? idx : toContainer.items.length;\n      const activeRect = active.rect.current.translated;\n      const overRect = over.rect;\n      const isBelow = activeRect && overRect ? activeRect.top > overRect.top + overRect.height / 2 : false;\n      toIndex = toIndex + (isBelow ? 1 : 0);\n    }\n    if (fromId === toId && !overInstanceId) return;\n    if (overInstanceId === instanceId) return;\n    if (fromId === toId) {\n      if (toIndex === fromIndex) return;\n      const nextItems = arrayMove(fromContainer.items, fromIndex, toIndex);\n      containersDraftRef.current = draft.map(c => c.id === fromId ? {\n        ...c,\n        items: nextItems\n      } : c);\n      dispatch(softTickAction());\n      console.log(\"dragover:end\");\n      return;\n    }\n    const nextFromItems = fromContainer.items.filter(id => id !== instanceId);\n    const clamped = Math.max(0, Math.min(toContainer.items.length, toIndex));\n    const nextToItems = [...toContainer.items];\n    nextToItems.splice(clamped, 0, instanceId);\n    containersDraftRef.current = draft.map(c => {\n      if (c.id === fromId) return {\n        ...c,\n        items: nextFromItems\n      };\n      if (c.id === toId) return {\n        ...c,\n        items: nextToItems\n      };\n      return c;\n    });\n    dispatch(softTickAction());\n    console.log(\"dragover:end\");\n  }, [dispatch]);\n  const handleDragEnd = useCallback(event => {\n    dispatch(setDebugEventAction(pickEvent(event, \"end\")));\n    const {\n      over\n    } = event;\n    dispatch(setActiveIdAction(null));\n    dispatch(setActiveSizeAction(null));\n    if (!over) {\n      containersDraftRef.current = null;\n      dispatch(softTickAction());\n      return;\n    }\n    const draft = containersDraftRef.current;\n\n    // commit locally + persist\n    if (draft) {\n      dispatch(setContainersAction(draft));\n\n      // emit ONLY containers that changed\n      const prev = state.containers;\n      for (const nextC of draft) {\n        var _prevC$items;\n        const prevC = prev.find(c => c.id === nextC.id);\n        const prevItems = (_prevC$items = prevC === null || prevC === void 0 ? void 0 : prevC.items) !== null && _prevC$items !== void 0 ? _prevC$items : [];\n        if (!itemsEqual(prevItems, nextC.items)) {\n          socket === null || socket === void 0 ? void 0 : socket.emit(\"update_container_items\", {\n            containerId: nextC.id,\n            items: nextC.items\n          });\n        }\n      }\n      containersDraftRef.current = null;\n      dispatch(softTickAction());\n    }\n  }, [dispatch, socket, state.containers]);\n  return useMemo(() => ({\n    addContainer,\n    createInstanceInContainer,\n    handleDragStart,\n    handleDragOver,\n    handleDragEnd,\n    handleDragCancel,\n    containersDraftRef,\n    getWorkingContainers\n  }), [addContainer, createInstanceInContainer, handleDragStart, handleDragOver, handleDragEnd, handleDragCancel, getWorkingContainers]);\n}\n_s(useDndReorderCoordinator, \"Ktlp4Nb5de+wF/Il03/4tDUbaNQ=\");","map":{"version":3,"names":["useCallback","useMemo","useRef","createContainerAction","createInstanceInContainerAction","setActiveIdAction","setActiveSizeAction","setContainersAction","setDebugEventAction","softTickAction","uid","Date","now","toString","Math","random","slice","arrayMove","arr","from","to","copy","item","splice","deepCloneContainers","containers","map","c","items","pickEvent","event","type","_a$data","_o$data","_activeData$role","_activeData$container","_overData$role","_overData$containerId","a","active","o","over","activeData","data","current","overData","ts","id","role","containerId","getOverContainerId","_over$data","_over$data$current","cid","startsWith","length","findContainerByInstanceId","instanceId","list","find","includes","itemsEqual","b","i","useDndReorderCoordinator","state","dispatch","socket","_s","containersDraftRef","lastOverRef","activeId","overId","overRole","overContainerId","addContainer","label","emit","container","createInstanceInContainer","instances","instance","getWorkingContainers","_containersDraftRef$c","handleDragStart","_event$active$rect","_event$active$rect$cu","rect","initial","width","height","handleDragCancel","handleDragOver","_over$data$current$ro","_over$data$current2","_over$data$current$co","_over$data$current3","_active$data$current","console","log","nextOverRole","nextOverContainerId","last","sameOver","draft","activeRole","fromContainer","toContainerId","toContainer","fromId","toId","fromIndex","indexOf","isOverInstance","overInstanceId","toIndex","idx","activeRect","translated","overRect","isBelow","top","nextItems","nextFromItems","filter","clamped","max","min","nextToItems","handleDragEnd","prev","nextC","_prevC$items","prevC","prevItems"],"sources":["/home/joshpoms/dndtest2/client/src/helpers/useDndReorderCoordinator.js"],"sourcesContent":["// dnd/useDndReorderCoordinator.js\nimport { useCallback, useMemo, useRef } from \"react\";\nimport {\n  createContainerAction,\n  createInstanceInContainerAction,\n  setActiveIdAction,\n  setActiveSizeAction,\n  setContainersAction,\n  setDebugEventAction,\n  softTickAction,\n} from \"../state/actions\";\n\n// ---------- utilities ----------\nfunction uid() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 10);\n}\n\nfunction arrayMove(arr, from, to) {\n  const copy = [...arr];\n  const [item] = copy.splice(from, 1);\n  copy.splice(to, 0, item);\n  return copy;\n}\n\nfunction deepCloneContainers(containers) {\n  return containers.map((c) => ({ ...c, items: [...c.items] }));\n}\n\n// ✅ Safe event snapshot for debug UI (no circular refs)\nfunction pickEvent(event, type) {\n  const a = event?.active;\n  const o = event?.over;\n\n  const activeData = a?.data?.current || null;\n  const overData = o?.data?.current || null;\n\n  return {\n    type,\n    ts: Date.now(),\n    active: a\n      ? {\n          id: a.id,\n          role: activeData?.role ?? null,\n          containerId: activeData?.containerId ?? null,\n          data: activeData,\n        }\n      : null,\n    over: o\n      ? {\n          id: o.id,\n          role: overData?.role ?? null,\n          containerId: overData?.containerId ?? null,\n          data: overData,\n        }\n      : null,\n  };\n}\n\nfunction getOverContainerId(over) {\n  if (!over) return null;\n\n  // preferred: explicit data\n  const cid = over.data?.current?.containerId;\n  if (cid) return cid;\n\n  // fallback: parse droppable id patterns (list:/top:/bottom:)\n  if (typeof over.id === \"string\") {\n    if (over.id.startsWith(\"list:\")) return over.id.slice(\"list:\".length);\n    if (over.id.startsWith(\"top:\")) return over.id.slice(\"top:\".length);\n    if (over.id.startsWith(\"bottom:\")) return over.id.slice(\"bottom:\".length);\n  }\n\n  return null;\n}\n\nfunction findContainerByInstanceId(instanceId, list) {\n  return list.find((c) => c.items.includes(instanceId));\n}\nfunction itemsEqual(a = [], b = []) {\n  if (a === b) return true;\n  if (!a || !b) return false;\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n  return true;\n}\n\n// ---------- hook ----------\nexport function useDndReorderCoordinator({ state, dispatch, socket }) {\n  // soft-sort draft ref (kept out of reducer on purpose)\n  const containersDraftRef = useRef(null);\n\n  const lastOverRef = useRef({\n    activeId: null,\n    overId: null,\n    overRole: null,\n    overContainerId: null,\n  });\n\n  const addContainer = useCallback(() => {\n    const id = uid();\n    const label = `List ${state.containers.length + 1}`;\n\n    // optimistic UI\n    dispatch(createContainerAction({ id, label }));\n\n    // persist\n    socket?.emit(\"create_container\", { container: { id, label } });\n  }, [dispatch, socket, state.containers.length]);\n\n  const createInstanceInContainer = useCallback(\n    (containerId) => {\n      const id = uid();\n      const label = `Item ${state.instances.length + 1}`;\n\n      // optimistic UI\n      dispatch(\n        createInstanceInContainerAction({\n          containerId,\n          instance: { id, label },\n        })\n      );\n\n      // persist\n      socket?.emit(\"create_instance_in_container\", {\n        containerId,\n        instance: { id, label },\n      });\n    },\n    [dispatch, socket, state.instances.length]\n  );\n\n  const getWorkingContainers = useCallback(() => {\n    return containersDraftRef.current ?? state.containers;\n  }, [state.containers]);\n\n  const handleDragStart = useCallback(\n    (event) => {\n      dispatch(setDebugEventAction(pickEvent(event, \"start\")));\n      dispatch(setActiveIdAction(event.active.id));\n\n      const rect = event.active.rect?.current?.initial;\n      if (rect) dispatch(setActiveSizeAction({ width: rect.width, height: rect.height }));\n\n      containersDraftRef.current = deepCloneContainers(state.containers);\n\n      lastOverRef.current = {\n        activeId: event.active.id,\n        overId: null,\n        overRole: null,\n        overContainerId: null,\n      };\n\n      dispatch(softTickAction());\n    },\n    [dispatch, state.containers]\n  );\n\n  const handleDragCancel = useCallback(() => {\n    dispatch(setDebugEventAction({ type: \"cancel\", ts: Date.now() }));\n    dispatch(setActiveIdAction(null));\n    dispatch(setActiveSizeAction(null));\n\n    containersDraftRef.current = null;\n    dispatch(softTickAction());\n  }, [dispatch]);\n\n  const handleDragOver = useCallback(\n    (event) => {\n      console.log(\"dragover:start\");\n\n      const { active, over } = event;\n      if (!over) return;\n\n      const nextOverRole = over.data.current?.role ?? null;\n      const nextOverContainerId =\n        over.data.current?.containerId ?? (typeof over.id === \"string\" ? over.id : null);\n\n      const last = lastOverRef.current;\n      const sameOver =\n        last.activeId === active.id &&\n        last.overId === over.id &&\n        last.overRole === nextOverRole &&\n        last.overContainerId === nextOverContainerId;\n\n      if (!sameOver) {\n        lastOverRef.current = {\n          activeId: active.id,\n          overId: over.id,\n          overRole: nextOverRole,\n          overContainerId: nextOverContainerId,\n        };\n        dispatch(setDebugEventAction(pickEvent(event, \"over\")));\n      }\n\n      const draft = containersDraftRef.current;\n      if (!draft) return;\n\n      const activeRole = active.data.current?.role;\n      const overRole = nextOverRole;\n\n      if (activeRole === \"container\") return;\n      if (activeRole !== \"instance\") return;\n\n      const instanceId = active.id;\n\n      const fromContainer = findContainerByInstanceId(instanceId, draft);\n      if (!fromContainer) return;\n\n      const toContainerId = getOverContainerId(over);\n      if (!toContainerId) return;\n\n      const toContainer = draft.find((c) => c.id === toContainerId);\n      if (!toContainer) return;\n\n      const fromId = fromContainer.id;\n      const toId = toContainer.id;\n\n      const fromIndex = fromContainer.items.indexOf(instanceId);\n      if (fromIndex === -1) return;\n\n      const isOverInstance = overRole === \"instance\";\n      const overInstanceId = isOverInstance ? over.id : null;\n\n      let toIndex;\n      if (!overInstanceId) {\n        toIndex = toContainer.items.length;\n      } else {\n        const idx = toContainer.items.indexOf(overInstanceId);\n        toIndex = idx >= 0 ? idx : toContainer.items.length;\n\n        const activeRect = active.rect.current.translated;\n        const overRect = over.rect;\n        const isBelow =\n          activeRect && overRect\n            ? activeRect.top > overRect.top + overRect.height / 2\n            : false;\n\n        toIndex = toIndex + (isBelow ? 1 : 0);\n      }\n\n      if (fromId === toId && !overInstanceId) return;\n      if (overInstanceId === instanceId) return;\n\n      if (fromId === toId) {\n        if (toIndex === fromIndex) return;\n\n        const nextItems = arrayMove(fromContainer.items, fromIndex, toIndex);\n\n        containersDraftRef.current = draft.map((c) =>\n          c.id === fromId ? { ...c, items: nextItems } : c\n        );\n\n        dispatch(softTickAction());\n        console.log(\"dragover:end\");\n        return;\n      }\n\n      const nextFromItems = fromContainer.items.filter((id) => id !== instanceId);\n\n      const clamped = Math.max(0, Math.min(toContainer.items.length, toIndex));\n      const nextToItems = [...toContainer.items];\n      nextToItems.splice(clamped, 0, instanceId);\n\n      containersDraftRef.current = draft.map((c) => {\n        if (c.id === fromId) return { ...c, items: nextFromItems };\n        if (c.id === toId) return { ...c, items: nextToItems };\n        return c;\n      });\n\n      dispatch(softTickAction());\n      console.log(\"dragover:end\");\n    },\n    [dispatch]\n  );\n\n  const handleDragEnd = useCallback(\n    (event) => {\n      dispatch(setDebugEventAction(pickEvent(event, \"end\")));\n\n      const { over } = event;\n\n      dispatch(setActiveIdAction(null));\n      dispatch(setActiveSizeAction(null));\n\n      if (!over) {\n        containersDraftRef.current = null;\n        dispatch(softTickAction());\n        return;\n      }\n\n      const draft = containersDraftRef.current;\n\n      // commit locally + persist\n      if (draft) {\n        dispatch(setContainersAction(draft));\n\n        // emit ONLY containers that changed\n        const prev = state.containers;\n        for (const nextC of draft) {\n          const prevC = prev.find((c) => c.id === nextC.id);\n          const prevItems = prevC?.items ?? [];\n          if (!itemsEqual(prevItems, nextC.items)) {\n            socket?.emit(\"update_container_items\", {\n              containerId: nextC.id,\n              items: nextC.items,\n            });\n          }\n        }\n\n        containersDraftRef.current = null;\n        dispatch(softTickAction());\n      }\n    },\n    [dispatch, socket, state.containers]\n  );\n\n  return useMemo(\n    () => ({\n      addContainer,\n      createInstanceInContainer,\n      handleDragStart,\n      handleDragOver,\n      handleDragEnd,\n      handleDragCancel,\n      containersDraftRef,\n      getWorkingContainers,\n    }),\n    [\n      addContainer,\n      createInstanceInContainer,\n      handleDragStart,\n      handleDragOver,\n      handleDragEnd,\n      handleDragCancel,\n      getWorkingContainers,\n    ]\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}