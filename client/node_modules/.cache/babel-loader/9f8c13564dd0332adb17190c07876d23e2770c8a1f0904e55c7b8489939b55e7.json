{"ast":null,"code":"// state/bindSocketToStore.js\nimport { ActionTypes } from \"./actions\";\nexport function bindSocketToStore(socket, dispatch) {\n  // HYDRATE EVERYTHING\n  socket.on(\"full_state\", ({\n    containers = [],\n    instances = []\n  }) => {\n    dispatch({\n      type: ActionTypes.SET_CONTAINERS,\n      payload: {\n        containers\n      }\n    });\n    dispatch({\n      type: ActionTypes.SET_INSTANCES,\n      payload: {\n        instances\n      }\n    });\n  });\n\n  // CREATE CONTAINER\n  socket.on(\"container_created\", ({\n    container\n  }) => {\n    if (!(container !== null && container !== void 0 && container.id)) return;\n    dispatch({\n      type: ActionTypes.ADD_CONTAINER,\n      payload: {\n        id: container.id,\n        label: container.label\n      }\n    });\n  });\n\n  // CREATE INSTANCE + ADD TO CONTAINER\n  socket.on(\"instance_created_in_container\", ({\n    containerId,\n    instance\n  }) => {\n    if (!containerId || !(instance !== null && instance !== void 0 && instance.id)) return;\n    dispatch({\n      type: ActionTypes.ADD_INSTANCE_TO_CONTAINER,\n      payload: {\n        containerId,\n        instance\n      }\n    });\n  });\n\n  // DROP COMMIT (container items updated)\n  socket.on(\"container_items_updated\", ({\n    containerId,\n    items\n  }) => {\n    if (!containerId || !Array.isArray(items)) return;\n    dispatch({\n      type: ActionTypes.PATCH_CONTAINER_ITEMS,\n      payload: {\n        containerId,\n        items\n      }\n    });\n  });\n\n  // INSTANCE PATCH (label edits, etc.)\n  socket.on(\"instance_updated\", ({\n    instance\n  }) => {\n    if (!(instance !== null && instance !== void 0 && instance.id)) return;\n    dispatch({\n      type: ActionTypes.PATCH_INSTANCE,\n      payload: {\n        instance\n      }\n    });\n  });\n  socket.on(\"server_error\", msg => {\n    console.warn(\"[socket] server_error:\", msg);\n  });\n\n  // Return an unbind cleanup (important in dev/hmr)\n  return () => {\n    socket.off(\"full_state\");\n    socket.off(\"container_created\");\n    socket.off(\"instance_created_in_container\");\n    socket.off(\"container_items_updated\");\n    socket.off(\"instance_updated\");\n    socket.off(\"server_error\");\n  };\n}","map":{"version":3,"names":["ActionTypes","bindSocketToStore","socket","dispatch","on","containers","instances","type","SET_CONTAINERS","payload","SET_INSTANCES","container","id","ADD_CONTAINER","label","containerId","instance","ADD_INSTANCE_TO_CONTAINER","items","Array","isArray","PATCH_CONTAINER_ITEMS","PATCH_INSTANCE","msg","console","warn","off"],"sources":["/home/joshpoms/dndtest2/client/src/state/bindSocketToStore.js"],"sourcesContent":["// state/bindSocketToStore.js\nimport { ActionTypes } from \"./actions\";\n\nexport function bindSocketToStore(socket, dispatch) {\n  // HYDRATE EVERYTHING\n  socket.on(\"full_state\", ({ containers = [], instances = [] }) => {\n    dispatch({ type: ActionTypes.SET_CONTAINERS, payload: { containers } });\n    dispatch({ type: ActionTypes.SET_INSTANCES, payload: { instances } });\n  });\n\n  // CREATE CONTAINER\n  socket.on(\"container_created\", ({ container }) => {\n    if (!container?.id) return;\n    dispatch({\n      type: ActionTypes.ADD_CONTAINER,\n      payload: { id: container.id, label: container.label },\n    });\n  });\n\n  // CREATE INSTANCE + ADD TO CONTAINER\n  socket.on(\"instance_created_in_container\", ({ containerId, instance }) => {\n    if (!containerId || !instance?.id) return;\n    dispatch({\n      type: ActionTypes.ADD_INSTANCE_TO_CONTAINER,\n      payload: { containerId, instance },\n    });\n  });\n\n  // DROP COMMIT (container items updated)\n  socket.on(\"container_items_updated\", ({ containerId, items }) => {\n    if (!containerId || !Array.isArray(items)) return;\n    dispatch({\n      type: ActionTypes.PATCH_CONTAINER_ITEMS,\n      payload: { containerId, items },\n    });\n  });\n\n  // INSTANCE PATCH (label edits, etc.)\n  socket.on(\"instance_updated\", ({ instance }) => {\n    if (!instance?.id) return;\n    dispatch({\n      type: ActionTypes.PATCH_INSTANCE,\n      payload: { instance },\n    });\n  });\n\n  socket.on(\"server_error\", (msg) => {\n    console.warn(\"[socket] server_error:\", msg);\n  });\n\n  // Return an unbind cleanup (important in dev/hmr)\n  return () => {\n    socket.off(\"full_state\");\n    socket.off(\"container_created\");\n    socket.off(\"instance_created_in_container\");\n    socket.off(\"container_items_updated\");\n    socket.off(\"instance_updated\");\n    socket.off(\"server_error\");\n  };\n}\n"],"mappings":"AAAA;AACA,SAASA,WAAW,QAAQ,WAAW;AAEvC,OAAO,SAASC,iBAAiBA,CAACC,MAAM,EAAEC,QAAQ,EAAE;EAClD;EACAD,MAAM,CAACE,EAAE,CAAC,YAAY,EAAE,CAAC;IAAEC,UAAU,GAAG,EAAE;IAAEC,SAAS,GAAG;EAAG,CAAC,KAAK;IAC/DH,QAAQ,CAAC;MAAEI,IAAI,EAAEP,WAAW,CAACQ,cAAc;MAAEC,OAAO,EAAE;QAAEJ;MAAW;IAAE,CAAC,CAAC;IACvEF,QAAQ,CAAC;MAAEI,IAAI,EAAEP,WAAW,CAACU,aAAa;MAAED,OAAO,EAAE;QAAEH;MAAU;IAAE,CAAC,CAAC;EACvE,CAAC,CAAC;;EAEF;EACAJ,MAAM,CAACE,EAAE,CAAC,mBAAmB,EAAE,CAAC;IAAEO;EAAU,CAAC,KAAK;IAChD,IAAI,EAACA,SAAS,aAATA,SAAS,eAATA,SAAS,CAAEC,EAAE,GAAE;IACpBT,QAAQ,CAAC;MACPI,IAAI,EAAEP,WAAW,CAACa,aAAa;MAC/BJ,OAAO,EAAE;QAAEG,EAAE,EAAED,SAAS,CAACC,EAAE;QAAEE,KAAK,EAAEH,SAAS,CAACG;MAAM;IACtD,CAAC,CAAC;EACJ,CAAC,CAAC;;EAEF;EACAZ,MAAM,CAACE,EAAE,CAAC,+BAA+B,EAAE,CAAC;IAAEW,WAAW;IAAEC;EAAS,CAAC,KAAK;IACxE,IAAI,CAACD,WAAW,IAAI,EAACC,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEJ,EAAE,GAAE;IACnCT,QAAQ,CAAC;MACPI,IAAI,EAAEP,WAAW,CAACiB,yBAAyB;MAC3CR,OAAO,EAAE;QAAEM,WAAW;QAAEC;MAAS;IACnC,CAAC,CAAC;EACJ,CAAC,CAAC;;EAEF;EACAd,MAAM,CAACE,EAAE,CAAC,yBAAyB,EAAE,CAAC;IAAEW,WAAW;IAAEG;EAAM,CAAC,KAAK;IAC/D,IAAI,CAACH,WAAW,IAAI,CAACI,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,EAAE;IAC3Cf,QAAQ,CAAC;MACPI,IAAI,EAAEP,WAAW,CAACqB,qBAAqB;MACvCZ,OAAO,EAAE;QAAEM,WAAW;QAAEG;MAAM;IAChC,CAAC,CAAC;EACJ,CAAC,CAAC;;EAEF;EACAhB,MAAM,CAACE,EAAE,CAAC,kBAAkB,EAAE,CAAC;IAAEY;EAAS,CAAC,KAAK;IAC9C,IAAI,EAACA,QAAQ,aAARA,QAAQ,eAARA,QAAQ,CAAEJ,EAAE,GAAE;IACnBT,QAAQ,CAAC;MACPI,IAAI,EAAEP,WAAW,CAACsB,cAAc;MAChCb,OAAO,EAAE;QAAEO;MAAS;IACtB,CAAC,CAAC;EACJ,CAAC,CAAC;EAEFd,MAAM,CAACE,EAAE,CAAC,cAAc,EAAGmB,GAAG,IAAK;IACjCC,OAAO,CAACC,IAAI,CAAC,wBAAwB,EAAEF,GAAG,CAAC;EAC7C,CAAC,CAAC;;EAEF;EACA,OAAO,MAAM;IACXrB,MAAM,CAACwB,GAAG,CAAC,YAAY,CAAC;IACxBxB,MAAM,CAACwB,GAAG,CAAC,mBAAmB,CAAC;IAC/BxB,MAAM,CAACwB,GAAG,CAAC,+BAA+B,CAAC;IAC3CxB,MAAM,CAACwB,GAAG,CAAC,yBAAyB,CAAC;IACrCxB,MAAM,CAACwB,GAAG,CAAC,kBAAkB,CAAC;IAC9BxB,MAAM,CAACwB,GAAG,CAAC,cAAc,CAAC;EAC5B,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}