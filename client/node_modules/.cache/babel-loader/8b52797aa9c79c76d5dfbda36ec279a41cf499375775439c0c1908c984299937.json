{"ast":null,"code":"var _jsxFileName = \"/data/data/com.termux/files/home/dndkittest2/client/src/Grid.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// GridInner.jsx\nimport React, { useContext, useMemo, useRef, useState, useEffect } from \"react\";\nimport { useDroppable, DndContext, PointerSensor, useSensor, useSensors, TouchSensor, rectIntersection, DragOverlay, pointerWithin, closestCenter } from \"@dnd-kit/core\";\nimport { MeasuringStrategy } from \"@dnd-kit/core\";\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\nimport MoreVerticalIcon from \"@atlaskit/icon/glyph/more-vertical\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEBUG_GRID_HIGHLIGHT = false;\n/* -------------------------------------------\n   ✅ Overlay clone for CONTAINER drags\n------------------------------------------- */\nfunction ContainerClone({\n  container\n}) {\n  var _container$label;\n  if (!container) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-shell\",\n    style: {\n      pointerEvents: \"none\",\n      opacity: 0.95\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          paddingLeft: 6\n        },\n        children: /*#__PURE__*/_jsxDEV(MoreVerticalIcon, {\n          size: \"small\",\n          primaryColor: \"#9AA0A6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontWeight: 600,\n          padding: \"0px 10px\"\n        },\n        children: (_container$label = container.label) !== null && _container$label !== void 0 ? _container$label : \"Container\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container-list\",\n      style: {\n        minHeight: 60\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          opacity: 0.6,\n          fontStyle: \"italic\",\n          padding: 8\n        },\n        children: \"Dragging\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 30,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------------------------------------------------------------\n   DROPPABLE GRID CELL\n   Highlight driven by parent \"highlightCellId\"\n------------------------------------------------------------ */\n_c = ContainerClone;\nfunction CellDroppable({\n  r,\n  c,\n  dark,\n  highlight\n}) {\n  _s();\n  const {\n    setNodeRef\n  } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: {\n      role: \"grid:cell\",\n      row: r,\n      col: c\n    }\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    \"data-id\": `cell-${r}-${c}`,\n    ref: setNodeRef,\n    style: {\n      // ✅ FORCE exact placement\n      gridRow: r + 1,\n      gridColumn: c + 1,\n      // ✅ prevent weird stretching/overflow\n      minWidth: 0,\n      minHeight: 0,\n      background: highlight ? \"rgba(50,150,255,0.45)\" : dark ? \"#22272B\" : \"#2C333A\",\n      border: \"1px solid #3F444A\",\n      transition: \"background 80ms\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------------------------------------------------------------\n   Grid canvas\n------------------------------------------------------------ */\n_s(CellDroppable, \"cRxoCnej0Qm2GWGzi2a2LoWImLI=\", false, function () {\n  return [useDroppable];\n});\n_c2 = CellDroppable;\nfunction GridCanvas({\n  gridRef,\n  rows,\n  cols,\n  colTemplate,\n  rowTemplate,\n  visiblePanels,\n  activeId,\n  panelDragging,\n  components,\n  dispatch,\n  startColResize,\n  startRowResize,\n  getColPosition,\n  getRowPosition,\n  highlightCellId\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: gridRef,\n    style: {\n      position: \"absolute\",\n      inset: 0,\n      display: \"grid\",\n      gridTemplateColumns: colTemplate,\n      gridTemplateRows: rowTemplate,\n      width: \"100%\",\n      height: \"85vh\",\n      overflow: \"hidden\",\n      touchAction: \"none\",\n      overscrollBehaviorY: \"none\"\n    },\n    children: [[...Array(rows)].map((_, r) => [...Array(cols)].map((_, c) => {\n      const dark = (r + c) % 2 === 0;\n      const cellId = `cell-${r}-${c}`;\n      return /*#__PURE__*/_jsxDEV(CellDroppable, {\n        r: r,\n        c: c,\n        dark: dark,\n        highlight: cellId === highlightCellId\n      }, `${r}-${c}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 13\n      }, this);\n    })), [...Array(cols - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      onMouseDown: e => startColResize(e, i),\n      onTouchStart: e => startColResize(e, i),\n      style: {\n        position: \"absolute\",\n        top: 0,\n        bottom: 0,\n        left: `${getColPosition(i)}%`,\n        width: 6,\n        marginLeft: -3,\n        cursor: \"col-resize\",\n        zIndex: 50,\n        background: \"transparent\"\n      }\n    }, `col-resize-${i}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }, this)), [...Array(rows - 1)].map((_, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n      onMouseDown: e => startRowResize(e, i),\n      onTouchStart: e => startRowResize(e, i),\n      style: {\n        position: \"absolute\",\n        left: 0,\n        right: 0,\n        top: `${getRowPosition(i)}%`,\n        height: 6,\n        marginTop: -3,\n        cursor: \"row-resize\",\n        zIndex: 50,\n        background: \"transparent\"\n      }\n    }, `row-resize-${i}`, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 9\n    }, this)), visiblePanels.map(p => /*#__PURE__*/_jsxDEV(Panel, {\n      panel: p,\n      dispatch: dispatch,\n      gridRef: gridRef,\n      cols: cols,\n      rows: rows,\n      activeId: activeId,\n      components: components,\n      gridActive: panelDragging\n    }, p.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 9\n    }, this))]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n}\n_c3 = GridCanvas;\nfunction GridInner({\n  components\n}) {\n  _s2();\n  var _grid$rows, _grid$cols, _state$activeSize, _state$activeSize2;\n  const {\n    state\n  } = useContext(GridDataContext);\n  const {\n    handleDragStart: handleDragStartProp,\n    handleDragOver: handleDragOverProp,\n    handleDragEnd: handleDragEndProp,\n    handleDragCancel: handleDragCancelProp,\n    useRenderCount,\n    dispatch,\n    updatePanel,\n    updateGrid,\n    socket\n  } = useContext(GridActionsContext);\n  const sensors = useSensors(useSensor(TouchSensor, {\n    activationConstraint: {\n      delay: 20,\n      // long-press before drag starts\n      tolerance: 2 // allow small finger wiggle without starting drag\n    }\n  }), useSensor(PointerSensor, {\n    activationConstraint: {\n      distance: 6\n    } // mouse/pen/desktop\n  }));\n  useRenderCount(\"Grid\");\n  const grid = state.grid;\n  const gridId = grid === null || grid === void 0 ? void 0 : grid._id;\n  const rows = (_grid$rows = grid === null || grid === void 0 ? void 0 : grid.rows) !== null && _grid$rows !== void 0 ? _grid$rows : 1;\n  const cols = (_grid$cols = grid === null || grid === void 0 ? void 0 : grid.cols) !== null && _grid$cols !== void 0 ? _grid$cols : 1;\n  const visiblePanels = state.panels.filter(p => p.gridId === gridId);\n  const gridRef = useRef(null);\n  const [activeId, setActiveId] = useState(null); // ✅ ADD THIS\n\n  const [activeRole, setActiveRole] = useState(null);\n  const [panelDragging, setPanelDragging] = useState(false);\n\n  // ✅ highlight target cell based on ONE source of truth\n  const [panelOverCellId, setPanelOverCellId] = useState(null);\n\n  // ✅ REAL cursor/touch pointer (single truth)\n  const livePointerRef = useRef({\n    x: null,\n    y: null\n  });\n\n  // ✅ attach global move listeners only while dragging a panel\n  useEffect(() => {\n    if (!panelDragging) return;\n    const onMove = e => {\n      var _e$touches;\n      if ((_e$touches = e.touches) !== null && _e$touches !== void 0 && _e$touches[0]) {\n        livePointerRef.current = {\n          x: e.touches[0].clientX,\n          y: e.touches[0].clientY\n        };\n      } else {\n        livePointerRef.current = {\n          x: e.clientX,\n          y: e.clientY\n        };\n      }\n    };\n    window.addEventListener(\"mousemove\", onMove, {\n      passive: true\n    });\n    window.addEventListener(\"touchmove\", onMove, {\n      passive: true\n    });\n    return () => {\n      window.removeEventListener(\"mousemove\", onMove);\n      window.removeEventListener(\"touchmove\", onMove);\n    };\n  }, [panelDragging]);\n\n  // ------------------------\n  // sizes\n  // ------------------------\n  const ensureSizes = (arr, count) => {\n    if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n    if (arr.length === count) return arr;\n    if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n    return arr.slice(0, count);\n  };\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid.rowSizes, rows));\n  function sameArray(a = [], b = []) {\n    if (a === b) return true;\n    if (a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n    return true;\n  }\n  useEffect(() => {\n    const next = ensureSizes(grid === null || grid === void 0 ? void 0 : grid.colSizes, cols);\n    setColSizes(prev => sameArray(prev, next) ? prev : next);\n  }, [cols, grid === null || grid === void 0 ? void 0 : grid._id]);\n  useEffect(() => {\n    const next = ensureSizes(grid === null || grid === void 0 ? void 0 : grid.rowSizes, rows);\n    setRowSizes(prev => sameArray(prev, next) ? prev : next);\n  }, [rows, grid === null || grid === void 0 ? void 0 : grid._id]);\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({\n        colSizes,\n        rowSizes\n      });\n    }\n  }, [colSizes, rowSizes]);\n  const colTemplate = colSizes.map(s => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map(s => `${s}fr`).join(\" \");\n  const getPanel = id => visiblePanels.find(p => p.id === id);\n  const clamp = (n, min, max) => Math.max(min, Math.min(n, max));\n  const getCellFromPointer = (clientX, clientY) => {\n    const gridEl = gridRef.current;\n    if (!gridEl) return null;\n    const rect = gridEl.getBoundingClientRect();\n    const inside = clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\n    if (!inside) {\n      if (DEBUG_GRID_HIGHLIGHT) {\n        console.log(\"[GRID] pointer outside grid\", {\n          clientX,\n          clientY,\n          rect\n        });\n      }\n      return null;\n    }\n    const x = clamp(clientX - rect.left, 0, rect.width - 1);\n    const y = clamp(clientY - rect.top, 0, rect.height - 1);\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n    let col = colSizes.length - 1;\n    let accX = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      accX += colSizes[i] / totalCols * rect.width;\n      if (x < accX) {\n        col = i;\n        break;\n      }\n    }\n    let row = rowSizes.length - 1;\n    let accY = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      accY += rowSizes[i] / totalRows * rect.height;\n      if (y < accY) {\n        row = i;\n        break;\n      }\n    }\n    if (DEBUG_GRID_HIGHLIGHT) {\n      console.log(\"[GRID CELL CALC]\", {\n        clientX,\n        clientY,\n        gridLeft: rect.left,\n        gridTop: rect.top,\n        localX: x,\n        localY: y,\n        colSizes,\n        rowSizes,\n        row,\n        col\n      });\n    }\n    return {\n      row,\n      col\n    };\n  };\n  function sanitizePanelPlacement(panel, rows, cols) {\n    return {\n      ...panel,\n      row: Math.max(0, Math.min(panel.row, rows - 1)),\n      col: Math.max(0, Math.min(panel.col, cols - 1)),\n      width: panel.width,\n      height: panel.height\n    };\n  }\n  const getStartClientX = event => {\n    var _event$activatorEvent, _event$activatorEvent2, _event$activatorEvent3, _event$activatorEvent4, _event$activatorEvent5;\n    return (_event$activatorEvent = event === null || event === void 0 ? void 0 : (_event$activatorEvent2 = event.activatorEvent) === null || _event$activatorEvent2 === void 0 ? void 0 : _event$activatorEvent2.clientX) !== null && _event$activatorEvent !== void 0 ? _event$activatorEvent : event === null || event === void 0 ? void 0 : (_event$activatorEvent3 = event.activatorEvent) === null || _event$activatorEvent3 === void 0 ? void 0 : (_event$activatorEvent4 = _event$activatorEvent3.touches) === null || _event$activatorEvent4 === void 0 ? void 0 : (_event$activatorEvent5 = _event$activatorEvent4[0]) === null || _event$activatorEvent5 === void 0 ? void 0 : _event$activatorEvent5.clientX;\n  };\n  const getStartClientY = event => {\n    var _event$activatorEvent6, _event$activatorEvent7, _event$activatorEvent8, _event$activatorEvent9, _event$activatorEvent0;\n    return (_event$activatorEvent6 = event === null || event === void 0 ? void 0 : (_event$activatorEvent7 = event.activatorEvent) === null || _event$activatorEvent7 === void 0 ? void 0 : _event$activatorEvent7.clientY) !== null && _event$activatorEvent6 !== void 0 ? _event$activatorEvent6 : event === null || event === void 0 ? void 0 : (_event$activatorEvent8 = event.activatorEvent) === null || _event$activatorEvent8 === void 0 ? void 0 : (_event$activatorEvent9 = _event$activatorEvent8.touches) === null || _event$activatorEvent9 === void 0 ? void 0 : (_event$activatorEvent0 = _event$activatorEvent9[0]) === null || _event$activatorEvent0 === void 0 ? void 0 : _event$activatorEvent0.clientY;\n  };\n\n  // ✅ helper: expand a rect by padding px\n  function padRect(rect, pad) {\n    if (!rect) return rect;\n    return {\n      ...rect,\n      top: rect.top - pad,\n      bottom: rect.bottom + pad,\n      left: rect.left - pad,\n      right: rect.right + pad,\n      width: rect.width + pad * 2,\n      height: rect.height + pad * 2\n    };\n  }\n\n  // ✅ collisionDetection uses highlight cell (same truth as UI)\n  // + pads droppable rects for container/instance drags to reduce \"over\" flicker\n  const collisionDetection = useMemo(() => {\n    return args => {\n      var _args$active, _args$active$data, _args$active$data$cur;\n      const role = (_args$active = args.active) === null || _args$active === void 0 ? void 0 : (_args$active$data = _args$active.data) === null || _args$active$data === void 0 ? void 0 : (_args$active$data$cur = _args$active$data.current) === null || _args$active$data$cur === void 0 ? void 0 : _args$active$data$cur.role;\n\n      // panels keep custom logic\n      if (role === \"panel\") {\n        return panelOverCellId ? [{\n          id: panelOverCellId\n        }] : [];\n      }\n\n      // ✅ for container + instance drags: pointer is king\n      const hits = pointerWithin(args);\n      return hits.length ? hits : closestCenter(args);\n    };\n  }, [panelOverCellId]);\n  const handleDragStart = event => {\n    var _event$active$data$cu, _event$active, _event$active$data, _event$active$data$cu2;\n    setActiveId(event.active.id);\n    const role = (_event$active$data$cu = (_event$active = event.active) === null || _event$active === void 0 ? void 0 : (_event$active$data = _event$active.data) === null || _event$active$data === void 0 ? void 0 : (_event$active$data$cu2 = _event$active$data.current) === null || _event$active$data$cu2 === void 0 ? void 0 : _event$active$data$cu2.role) !== null && _event$active$data$cu !== void 0 ? _event$active$data$cu : null;\n    setActiveRole(role);\n    const data = event.active.data.current;\n    if ((data === null || data === void 0 ? void 0 : data.role) === \"panel\") {\n      setPanelDragging(true);\n      const startX = getStartClientX(event);\n      const startY = getStartClientY(event);\n\n      // seed live pointer so first move tick isn't null\n      livePointerRef.current = {\n        x: startX !== null && startX !== void 0 ? startX : null,\n        y: startY !== null && startY !== void 0 ? startY : null\n      };\n\n      // highlight pickup cell immediately (REAL pointer)\n      if (typeof startX === \"number\" && typeof startY === \"number\") {\n        const rc = getCellFromPointer(startX, startY);\n        setPanelOverCellId(rc ? `cell-${rc.row}-${rc.col}` : null);\n      } else {\n        setPanelOverCellId(null);\n      }\n      return;\n    }\n    handleDragStartProp === null || handleDragStartProp === void 0 ? void 0 : handleDragStartProp(event);\n  };\n  const handleDragMove = event => {\n    var _event$active2, _event$active2$data;\n    const data = (_event$active2 = event.active) === null || _event$active2 === void 0 ? void 0 : (_event$active2$data = _event$active2.data) === null || _event$active2$data === void 0 ? void 0 : _event$active2$data.current;\n    if (!data || data.role !== \"panel\") return;\n    const live = livePointerRef.current;\n    if (typeof (live === null || live === void 0 ? void 0 : live.x) !== \"number\" || typeof (live === null || live === void 0 ? void 0 : live.y) !== \"number\") return;\n    const rc = getCellFromPointer(live.x, live.y);\n    setPanelOverCellId(rc ? `cell-${rc.row}-${rc.col}` : null);\n  };\n  const handleDragOver = event => {\n    var _event$active3, _event$active3$data, _event$active3$data$c;\n    const role = (_event$active3 = event.active) === null || _event$active3 === void 0 ? void 0 : (_event$active3$data = _event$active3.data) === null || _event$active3$data === void 0 ? void 0 : (_event$active3$data$c = _event$active3$data.current) === null || _event$active3$data$c === void 0 ? void 0 : _event$active3$data$c.role;\n    if (role === \"panel\") return;\n    handleDragOverProp === null || handleDragOverProp === void 0 ? void 0 : handleDragOverProp(event);\n  };\n  const handleDragEnd = event => {\n    var _active$data;\n    const {\n      active\n    } = event;\n    const data = active === null || active === void 0 ? void 0 : (_active$data = active.data) === null || _active$data === void 0 ? void 0 : _active$data.current;\n    setActiveId(null);\n    setActiveRole(null);\n    if (!data) return;\n    if (data.role !== \"panel\") {\n      handleDragEndProp === null || handleDragEndProp === void 0 ? void 0 : handleDragEndProp(event);\n      return;\n    }\n    const panel = getPanel(active.id);\n    if (!panel) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      setPanelOverCellId(null);\n      return;\n    }\n\n    // ✅ finalize using REAL pointer\n    const live = livePointerRef.current;\n    const rc = typeof (live === null || live === void 0 ? void 0 : live.x) === \"number\" && typeof (live === null || live === void 0 ? void 0 : live.y) === \"number\" ? getCellFromPointer(live.x, live.y) : null;\n    if (!rc) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      setPanelOverCellId(null);\n      return;\n    }\n    const updated = sanitizePanelPlacement({\n      ...panel,\n      row: rc.row,\n      col: rc.col\n    }, rows, cols);\n    dispatch(updatePanel(updated));\n    socket.emit(\"update_panel\", {\n      panel: updated,\n      gridId\n    });\n\n    // cleanup\n    livePointerRef.current = {\n      x: null,\n      y: null\n    };\n    setPanelOverCellId(null);\n    requestAnimationFrame(() => setPanelDragging(false));\n  };\n  const handleDragCancel = event => {\n    var _event$active4, _event$active4$data, _event$active4$data$c;\n    setActiveId(null);\n    setActiveRole(null);\n    livePointerRef.current = {\n      x: null,\n      y: null\n    };\n    setPanelOverCellId(null);\n    requestAnimationFrame(() => setPanelDragging(false));\n    const role = (_event$active4 = event.active) === null || _event$active4 === void 0 ? void 0 : (_event$active4$data = _event$active4.data) === null || _event$active4$data === void 0 ? void 0 : (_event$active4$data$c = _event$active4$data.current) === null || _event$active4$data$c === void 0 ? void 0 : _event$active4$data$c.role;\n    if (role !== \"panel\") handleDragCancelProp === null || handleDragCancelProp === void 0 ? void 0 : handleDragCancelProp(event);\n  };\n\n  // ---- Grid resizing (unchanged except one bugfix) ----\n  const resizePendingRef = useRef({\n    rowSizes: null,\n    colSizes: null\n  });\n  const finalizeResize = () => {\n    var _state$grid, _pending$rowSizes, _pending$colSizes, _pending$rowSizes2, _pending$colSizes2;\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!((_state$grid = state.grid) !== null && _state$grid !== void 0 && _state$grid._id)) return;\n    dispatch(updateGrid({\n      _id: state.grid._id,\n      rows: state.grid.rows,\n      cols: state.grid.cols,\n      rowSizes: (_pending$rowSizes = pending.rowSizes) !== null && _pending$rowSizes !== void 0 ? _pending$rowSizes : rowSizes,\n      colSizes: (_pending$colSizes = pending.colSizes) !== null && _pending$colSizes !== void 0 ? _pending$colSizes : colSizes\n    }));\n    socket.emit(\"update_grid\", {\n      gridId: state.grid._id,\n      grid: {\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: (_pending$rowSizes2 = pending.rowSizes) !== null && _pending$rowSizes2 !== void 0 ? _pending$rowSizes2 : rowSizes,\n        colSizes: (_pending$colSizes2 = pending.colSizes) !== null && _pending$colSizes2 !== void 0 ? _pending$colSizes2 : colSizes\n      }\n    });\n    resizePendingRef.current = {\n      rowSizes: null,\n      colSizes: null\n    };\n  };\n  const getGridWidth = () => {\n    var _gridRef$current;\n    return ((_gridRef$current = gridRef.current) === null || _gridRef$current === void 0 ? void 0 : _gridRef$current.clientWidth) || 1;\n  };\n  const getGridHeight = () => {\n    var _gridRef$current2;\n    return ((_gridRef$current2 = gridRef.current) === null || _gridRef$current2 === void 0 ? void 0 : _gridRef$current2.clientHeight) || 1;\n  };\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridWidth * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes(sizes => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = pixelDelta / gridHeight * total;\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n  const getClientX = e => e.touches ? e.touches[0].clientX : e.clientX;\n  const getClientY = e => e.touches ? e.touches[0].clientY : e.clientY;\n  const getColPosition = i => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n  const getRowPosition = i => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return before / total * 100;\n  };\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n    const move = ev => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop); // ✅ FIXED\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  const activeContainer = useMemo(() => {\n    if (activeRole !== \"container\" || !activeId) return null;\n    return ((state === null || state === void 0 ? void 0 : state.containers) || []).find(c => c.id === activeId) || null;\n  }, [activeRole, activeId, state === null || state === void 0 ? void 0 : state.containers]);\n  if (!(grid !== null && grid !== void 0 && grid._id)) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Loading grid\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 682,\n    columnNumber: 26\n  }, this);\n  return /*#__PURE__*/_jsxDEV(DndContext, {\n    sensors: sensors,\n    collisionDetection: collisionDetection,\n    measuring: {\n      droppable: {\n        strategy: MeasuringStrategy.Always\n      }\n    },\n    autoScroll: {\n      enabled: true,\n      threshold: {\n        x: 0.15,\n        y: 0.15\n      },\n      acceleration: 30\n    },\n    onDragStart: handleDragStart,\n    onDragMove: handleDragMove,\n    onDragEnd: handleDragEnd,\n    onDragOver: handleDragOver,\n    onDragCancel: handleDragCancel,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        inset: 0,\n        background: \"#1D2125\",\n        overflow: \"hidden\",\n        top: \"45px\"\n      },\n      children: /*#__PURE__*/_jsxDEV(GridCanvas, {\n        gridRef: gridRef,\n        rows: rows,\n        cols: cols,\n        colTemplate: colTemplate,\n        rowTemplate: rowTemplate,\n        visiblePanels: visiblePanels,\n        activeId: activeId,\n        panelDragging: panelDragging,\n        components: components,\n        dispatch: dispatch,\n        startColResize: startColResize,\n        startRowResize: startRowResize,\n        getColPosition: getColPosition,\n        getRowPosition: getRowPosition,\n        highlightCellId: panelOverCellId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 716,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 707,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DragOverlay, {\n      dropAnimation: null,\n      zIndex: 100000,\n      adjustScale: false,\n      children: [activeId && activeRole === \"panel\" && getPanel(activeId) ? /*#__PURE__*/_jsxDEV(PanelClone, {\n        panel: getPanel(activeId)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 737,\n        columnNumber: 11\n      }, this) : null, activeId && activeRole === \"container\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: state === null || state === void 0 ? void 0 : (_state$activeSize = state.activeSize) === null || _state$activeSize === void 0 ? void 0 : _state$activeSize.width,\n          height: state === null || state === void 0 ? void 0 : (_state$activeSize2 = state.activeSize) === null || _state$activeSize2 === void 0 ? void 0 : _state$activeSize2.height\n        },\n        children: /*#__PURE__*/_jsxDEV(ContainerClone, {\n          container: activeContainer\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 742,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 741,\n        columnNumber: 11\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 735,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 686,\n    columnNumber: 5\n  }, this);\n}\n_s2(GridInner, \"XhN+GannaKtaO7sle2euruMb/UY=\", false, function () {\n  return [useSensors, useSensor, useSensor, useRenderCount];\n});\n_c4 = GridInner;\nexport default _c5 = /*#__PURE__*/React.memo(GridInner);\nvar _c, _c2, _c3, _c4, _c5;\n$RefreshReg$(_c, \"ContainerClone\");\n$RefreshReg$(_c2, \"CellDroppable\");\n$RefreshReg$(_c3, \"GridCanvas\");\n$RefreshReg$(_c4, \"GridInner\");\n$RefreshReg$(_c5, \"%default%\");","map":{"version":3,"names":["React","useContext","useMemo","useRef","useState","useEffect","useDroppable","DndContext","PointerSensor","useSensor","useSensors","TouchSensor","rectIntersection","DragOverlay","pointerWithin","closestCenter","MeasuringStrategy","Panel","PanelClone","GridDataContext","GridActionsContext","MoreVerticalIcon","jsxDEV","_jsxDEV","DEBUG_GRID_HIGHLIGHT","ContainerClone","container","_container$label","className","style","pointerEvents","opacity","children","paddingLeft","size","primaryColor","fileName","_jsxFileName","lineNumber","columnNumber","fontWeight","padding","label","minHeight","fontSize","fontStyle","_c","CellDroppable","r","c","dark","highlight","_s","setNodeRef","id","data","role","row","col","ref","gridRow","gridColumn","minWidth","background","border","transition","_c2","GridCanvas","gridRef","rows","cols","colTemplate","rowTemplate","visiblePanels","activeId","panelDragging","components","dispatch","startColResize","startRowResize","getColPosition","getRowPosition","highlightCellId","position","inset","display","gridTemplateColumns","gridTemplateRows","width","height","overflow","touchAction","overscrollBehaviorY","Array","map","_","cellId","i","onMouseDown","e","onTouchStart","top","bottom","left","marginLeft","cursor","zIndex","right","marginTop","p","panel","gridActive","_c3","GridInner","_s2","_grid$rows","_grid$cols","_state$activeSize","_state$activeSize2","state","handleDragStart","handleDragStartProp","handleDragOver","handleDragOverProp","handleDragEnd","handleDragEndProp","handleDragCancel","handleDragCancelProp","useRenderCount","updatePanel","updateGrid","socket","sensors","activationConstraint","delay","tolerance","distance","grid","gridId","_id","panels","filter","setActiveId","activeRole","setActiveRole","setPanelDragging","panelOverCellId","setPanelOverCellId","livePointerRef","x","y","onMove","_e$touches","touches","current","clientX","clientY","window","addEventListener","passive","removeEventListener","ensureSizes","arr","count","isArray","length","fill","slice","colSizes","setColSizes","rowSizes","setRowSizes","sameArray","a","b","next","prev","dataset","sizes","JSON","stringify","s","join","getPanel","find","clamp","n","min","max","Math","getCellFromPointer","gridEl","rect","getBoundingClientRect","inside","console","log","totalCols","reduce","totalRows","accX","accY","gridLeft","gridTop","localX","localY","sanitizePanelPlacement","getStartClientX","event","_event$activatorEvent","_event$activatorEvent2","_event$activatorEvent3","_event$activatorEvent4","_event$activatorEvent5","activatorEvent","getStartClientY","_event$activatorEvent6","_event$activatorEvent7","_event$activatorEvent8","_event$activatorEvent9","_event$activatorEvent0","padRect","pad","collisionDetection","args","_args$active","_args$active$data","_args$active$data$cur","active","hits","_event$active$data$cu","_event$active","_event$active$data","_event$active$data$cu2","startX","startY","rc","handleDragMove","_event$active2","_event$active2$data","live","_event$active3","_event$active3$data","_event$active3$data$c","_active$data","requestAnimationFrame","updated","emit","_event$active4","_event$active4$data","_event$active4$data$c","resizePendingRef","finalizeResize","_state$grid","_pending$rowSizes","_pending$colSizes","_pending$rowSizes2","_pending$colSizes2","pending","getGridWidth","_gridRef$current","clientWidth","getGridHeight","_gridRef$current2","clientHeight","resizeColumn","pixelDelta","gridWidth","total","frDelta","copy","resizeRow","gridHeight","getClientX","getClientY","before","preventDefault","move","ev","currentX","delta","stop","currentY","activeContainer","containers","measuring","droppable","strategy","Always","autoScroll","enabled","threshold","acceleration","onDragStart","onDragMove","onDragEnd","onDragOver","onDragCancel","dropAnimation","adjustScale","activeSize","_c4","_c5","memo","$RefreshReg$"],"sources":["/data/data/com.termux/files/home/dndkittest2/client/src/Grid.jsx"],"sourcesContent":["// GridInner.jsx\nimport React, { useContext, useMemo, useRef, useState, useEffect } from \"react\";\nimport {\n  useDroppable,\n  DndContext,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  TouchSensor,\n  rectIntersection,\n  DragOverlay,\n  pointerWithin,\n  closestCenter\n} from \"@dnd-kit/core\";\nimport { MeasuringStrategy } from \"@dnd-kit/core\";\nimport Panel from \"./Panel\";\nimport PanelClone from \"./PanelClone\";\nimport { GridDataContext } from \"./GridDataContext\";\nimport { GridActionsContext } from \"./GridActionsContext\";\nimport MoreVerticalIcon from \"@atlaskit/icon/glyph/more-vertical\";\n\nconst DEBUG_GRID_HIGHLIGHT = false;\n/* -------------------------------------------\n   ✅ Overlay clone for CONTAINER drags\n------------------------------------------- */\nfunction ContainerClone({ container }) {\n  if (!container) return null;\n\n  return (\n    <div\n      className=\"container-shell\"\n      style={{ pointerEvents: \"none\", opacity: 0.95 }}\n    >\n      <div className=\"container-header\">\n        <div style={{ paddingLeft: 6 }}>\n          <MoreVerticalIcon size=\"small\" primaryColor=\"#9AA0A6\" />\n        </div>\n\n        <div style={{ fontWeight: 600, padding: \"0px 10px\" }}>\n          {container.label ?? \"Container\"}\n        </div>\n      </div>\n\n      <div className=\"container-list\" style={{ minHeight: 60 }}>\n        <div\n          style={{\n            fontSize: 12,\n            opacity: 0.6,\n            fontStyle: \"italic\",\n            padding: 8,\n          }}\n        >\n          Dragging…\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/* ------------------------------------------------------------\n   DROPPABLE GRID CELL\n   Highlight driven by parent \"highlightCellId\"\n------------------------------------------------------------ */\nfunction CellDroppable({ r, c, dark, highlight }) {\n  const { setNodeRef } = useDroppable({\n    id: `cell-${r}-${c}`,\n    data: { role: \"grid:cell\", row: r, col: c },\n  });\n\n  return (\n    <div\n      data-id={`cell-${r}-${c}`}\n      ref={setNodeRef}\n      style={{\n        // ✅ FORCE exact placement\n        gridRow: r + 1,\n        gridColumn: c + 1,\n\n        // ✅ prevent weird stretching/overflow\n        minWidth: 0,\n        minHeight: 0,\n\n        background: highlight\n          ? \"rgba(50,150,255,0.45)\"\n          : dark\n            ? \"#22272B\"\n            : \"#2C333A\",\n        border: \"1px solid #3F444A\",\n        transition: \"background 80ms\",\n      }}\n    />\n  );\n}\n\n/* ------------------------------------------------------------\n   Grid canvas\n------------------------------------------------------------ */\nfunction GridCanvas({\n  gridRef,\n  rows,\n  cols,\n  colTemplate,\n  rowTemplate,\n  visiblePanels,\n  activeId,\n  panelDragging,\n  components,\n  dispatch,\n  startColResize,\n  startRowResize,\n  getColPosition,\n  getRowPosition,\n  highlightCellId,\n}) {\n  return (\n    <div\n      ref={gridRef}\n      style={{\n        position: \"absolute\",\n        inset: 0,\n        display: \"grid\",\n        gridTemplateColumns: colTemplate,\n        gridTemplateRows: rowTemplate,\n        width: \"100%\",\n        height: \"85vh\",\n        overflow: \"hidden\",\n        touchAction: \"none\",\n        overscrollBehaviorY: \"none\",\n      }}\n    >\n      {[...Array(rows)].map((_, r) =>\n        [...Array(cols)].map((_, c) => {\n          const dark = (r + c) % 2 === 0;\n          const cellId = `cell-${r}-${c}`;\n\n          return (\n            <CellDroppable\n              key={`${r}-${c}`}\n              r={r}\n              c={c}\n              dark={dark}\n              highlight={cellId === highlightCellId}\n            />\n          );\n        })\n      )}\n\n      {/* Vertical resizers */}\n      {[...Array(cols - 1)].map((_, i) => (\n        <div\n          key={`col-resize-${i}`}\n          onMouseDown={(e) => startColResize(e, i)}\n          onTouchStart={(e) => startColResize(e, i)}\n          style={{\n            position: \"absolute\",\n            top: 0,\n            bottom: 0,\n            left: `${getColPosition(i)}%`,\n            width: 6,\n            marginLeft: -3,\n            cursor: \"col-resize\",\n            zIndex: 50,\n            background: \"transparent\",\n          }}\n        />\n      ))}\n\n      {/* Row resizers */}\n      {[...Array(rows - 1)].map((_, i) => (\n        <div\n          key={`row-resize-${i}`}\n          onMouseDown={(e) => startRowResize(e, i)}\n          onTouchStart={(e) => startRowResize(e, i)}\n          style={{\n            position: \"absolute\",\n            left: 0,\n            right: 0,\n            top: `${getRowPosition(i)}%`,\n            height: 6,\n            marginTop: -3,\n            cursor: \"row-resize\",\n            zIndex: 50,\n            background: \"transparent\",\n          }}\n        />\n      ))}\n\n      {/* Panels */}\n      {visiblePanels.map((p) => (\n        <Panel\n          key={p.id}\n          panel={p}\n          dispatch={dispatch}\n          gridRef={gridRef}\n          cols={cols}\n          rows={rows}\n          activeId={activeId}\n          components={components}\n          gridActive={panelDragging}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction GridInner({ components }) {\n  const { state } = useContext(GridDataContext);\n\n  const {\n    handleDragStart: handleDragStartProp,\n    handleDragOver: handleDragOverProp,\n    handleDragEnd: handleDragEndProp,\n    handleDragCancel: handleDragCancelProp,\n    useRenderCount,\n    dispatch,\n    updatePanel,\n    updateGrid,\n    socket,\n  } = useContext(GridActionsContext);\n\n  const sensors = useSensors(\n  useSensor(TouchSensor, {\n    activationConstraint: {\n      delay: 20,     // long-press before drag starts\n      tolerance: 2,   // allow small finger wiggle without starting drag\n    },\n  }),\n  useSensor(PointerSensor, {\n    activationConstraint: { distance: 6 }, // mouse/pen/desktop\n  })\n);\n\n  useRenderCount(\"Grid\");\n\n  const grid = state.grid;\n  const gridId = grid?._id;\n  const rows = grid?.rows ?? 1;\n  const cols = grid?.cols ?? 1;\n\n  const visiblePanels = state.panels.filter((p) => p.gridId === gridId);\nconst gridRef = useRef(null);\n\nconst [activeId, setActiveId] = useState(null); // ✅ ADD THIS\n\nconst [activeRole, setActiveRole] = useState(null);\nconst [panelDragging, setPanelDragging] = useState(false);\n\n\n  // ✅ highlight target cell based on ONE source of truth\n  const [panelOverCellId, setPanelOverCellId] = useState(null);\n\n  // ✅ REAL cursor/touch pointer (single truth)\n  const livePointerRef = useRef({ x: null, y: null });\n\n  // ✅ attach global move listeners only while dragging a panel\n  useEffect(() => {\n    if (!panelDragging) return;\n\n    const onMove = (e) => {\n      if (e.touches?.[0]) {\n        livePointerRef.current = {\n          x: e.touches[0].clientX,\n          y: e.touches[0].clientY,\n        };\n      } else {\n        livePointerRef.current = { x: e.clientX, y: e.clientY };\n      }\n    };\n\n    window.addEventListener(\"mousemove\", onMove, { passive: true });\n    window.addEventListener(\"touchmove\", onMove, { passive: true });\n\n    return () => {\n      window.removeEventListener(\"mousemove\", onMove);\n      window.removeEventListener(\"touchmove\", onMove);\n    };\n  }, [panelDragging]);\n\n  // ------------------------\n  // sizes\n  // ------------------------\n  const ensureSizes = (arr, count) => {\n    if (!Array.isArray(arr) || arr.length === 0) return Array(count).fill(1);\n    if (arr.length === count) return arr;\n    if (arr.length < count) return [...arr, ...Array(count - arr.length).fill(1)];\n    return arr.slice(0, count);\n  };\n\n  const [colSizes, setColSizes] = useState(() => ensureSizes(grid.colSizes, cols));\n  const [rowSizes, setRowSizes] = useState(() => ensureSizes(grid.rowSizes, rows));\n\n  function sameArray(a = [], b = []) {\n  if (a === b) return true;\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n  return true;\n}\n\nuseEffect(() => {\n  const next = ensureSizes(grid?.colSizes, cols);\n  setColSizes(prev => (sameArray(prev, next) ? prev : next));\n}, [cols, grid?._id]);\n\nuseEffect(() => {\n  const next = ensureSizes(grid?.rowSizes, rows);\n  setRowSizes(prev => (sameArray(prev, next) ? prev : next));\n}, [rows, grid?._id]);\n\n  useEffect(() => {\n    if (gridRef.current) {\n      gridRef.current.dataset.sizes = JSON.stringify({ colSizes, rowSizes });\n    }\n  }, [colSizes, rowSizes]);\n\n  const colTemplate = colSizes.map((s) => `${s}fr`).join(\" \");\n  const rowTemplate = rowSizes.map((s) => `${s}fr`).join(\" \");\n\n  const getPanel = (id) => visiblePanels.find((p) => p.id === id);\n\n  const clamp = (n, min, max) => Math.max(min, Math.min(n, max));\n\n  const getCellFromPointer = (clientX, clientY) => {\n    const gridEl = gridRef.current;\n    if (!gridEl) return null;\n\n    const rect = gridEl.getBoundingClientRect();\n\n    const inside =\n      clientX >= rect.left &&\n      clientX <= rect.right &&\n      clientY >= rect.top &&\n      clientY <= rect.bottom;\n\n    if (!inside) {\n      if (DEBUG_GRID_HIGHLIGHT) {\n        console.log(\"[GRID] pointer outside grid\", { clientX, clientY, rect });\n      }\n      return null;\n    }\n\n    const x = clamp(clientX - rect.left, 0, rect.width - 1);\n    const y = clamp(clientY - rect.top, 0, rect.height - 1);\n\n    const totalCols = colSizes.reduce((a, b) => a + b, 0);\n    const totalRows = rowSizes.reduce((a, b) => a + b, 0);\n\n    let col = colSizes.length - 1;\n    let accX = 0;\n    for (let i = 0; i < colSizes.length; i++) {\n      accX += (colSizes[i] / totalCols) * rect.width;\n      if (x < accX) {\n        col = i;\n        break;\n      }\n    }\n\n    let row = rowSizes.length - 1;\n    let accY = 0;\n    for (let i = 0; i < rowSizes.length; i++) {\n      accY += (rowSizes[i] / totalRows) * rect.height;\n      if (y < accY) {\n        row = i;\n        break;\n      }\n    }\n\n    if (DEBUG_GRID_HIGHLIGHT) {\n      console.log(\"[GRID CELL CALC]\", {\n        clientX,\n        clientY,\n        gridLeft: rect.left,\n        gridTop: rect.top,\n        localX: x,\n        localY: y,\n        colSizes,\n        rowSizes,\n        row,\n        col,\n      });\n    }\n\n    return { row, col };\n  };\nfunction sanitizePanelPlacement(panel, rows, cols) {\n  return {\n    ...panel,\n    row: Math.max(0, Math.min(panel.row, rows - 1)),\n    col: Math.max(0, Math.min(panel.col, cols - 1)),\n    width: panel.width,\n    height: panel.height,\n  };\n}\n  const getStartClientX = (event) =>\n    event?.activatorEvent?.clientX ?? event?.activatorEvent?.touches?.[0]?.clientX;\n\n  const getStartClientY = (event) =>\n    event?.activatorEvent?.clientY ?? event?.activatorEvent?.touches?.[0]?.clientY;\n\n// ✅ helper: expand a rect by padding px\nfunction padRect(rect, pad) {\n  if (!rect) return rect;\n  return {\n    ...rect,\n    top: rect.top - pad,\n    bottom: rect.bottom + pad,\n    left: rect.left - pad,\n    right: rect.right + pad,\n    width: rect.width + pad * 2,\n    height: rect.height + pad * 2,\n  };\n}\n\n// ✅ collisionDetection uses highlight cell (same truth as UI)\n// + pads droppable rects for container/instance drags to reduce \"over\" flicker\nconst collisionDetection = useMemo(() => {\n  return (args) => {\n    const role = args.active?.data?.current?.role;\n\n    // panels keep custom logic\n    if (role === \"panel\") {\n      return panelOverCellId ? [{ id: panelOverCellId }] : [];\n    }\n\n    // ✅ for container + instance drags: pointer is king\n    const hits = pointerWithin(args);\n    return hits.length ? hits : closestCenter(args);\n  };\n}, [panelOverCellId]);\n\n  const handleDragStart = (event) => {\n    setActiveId(event.active.id);\n    const role = event.active?.data?.current?.role ?? null;\n    setActiveRole(role);\n\n    const data = event.active.data.current;\n\n    if (data?.role === \"panel\") {\n      setPanelDragging(true);\n\n      const startX = getStartClientX(event);\n      const startY = getStartClientY(event);\n\n      // seed live pointer so first move tick isn't null\n      livePointerRef.current = { x: startX ?? null, y: startY ?? null };\n\n      // highlight pickup cell immediately (REAL pointer)\n      if (typeof startX === \"number\" && typeof startY === \"number\") {\n        const rc = getCellFromPointer(startX, startY);\n        setPanelOverCellId(rc ? `cell-${rc.row}-${rc.col}` : null);\n      } else {\n        setPanelOverCellId(null);\n      }\n\n      return;\n    }\n\n    handleDragStartProp?.(event);\n  };\n\n  const handleDragMove = (event) => {\n    const data = event.active?.data?.current;\n    if (!data || data.role !== \"panel\") return;\n\n    const live = livePointerRef.current;\n    if (typeof live?.x !== \"number\" || typeof live?.y !== \"number\") return;\n\n    const rc = getCellFromPointer(live.x, live.y);\n    setPanelOverCellId(rc ? `cell-${rc.row}-${rc.col}` : null);\n  };\n\n  const handleDragOver = (event) => {\n    const role = event.active?.data?.current?.role;\n    if (role === \"panel\") return;\n    handleDragOverProp?.(event);\n  };\n\n  const handleDragEnd = (event) => {\n    const { active } = event;\n    const data = active?.data?.current;\n\n    setActiveId(null);\n    setActiveRole(null);\n\n    if (!data) return;\n\n    if (data.role !== \"panel\") {\n      handleDragEndProp?.(event);\n      return;\n    }\n\n    const panel = getPanel(active.id);\n    if (!panel) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      setPanelOverCellId(null);\n      return;\n    }\n\n    // ✅ finalize using REAL pointer\n    const live = livePointerRef.current;\n    const rc =\n      typeof live?.x === \"number\" && typeof live?.y === \"number\"\n        ? getCellFromPointer(live.x, live.y)\n        : null;\n\n    if (!rc) {\n      requestAnimationFrame(() => setPanelDragging(false));\n      setPanelOverCellId(null);\n      return;\n    }\n\n    const updated = sanitizePanelPlacement(\n      { ...panel, row: rc.row, col: rc.col },\n      rows,\n      cols\n    );\n\n    dispatch(updatePanel(updated));\n    socket.emit(\"update_panel\", { panel: updated, gridId });\n\n    // cleanup\n    livePointerRef.current = { x: null, y: null };\n    setPanelOverCellId(null);\n\n    requestAnimationFrame(() => setPanelDragging(false));\n  };\n\n  const handleDragCancel = (event) => {\n    setActiveId(null);\n    setActiveRole(null);\n\n    livePointerRef.current = { x: null, y: null };\n\n    setPanelOverCellId(null);\n    requestAnimationFrame(() => setPanelDragging(false));\n\n    const role = event.active?.data?.current?.role;\n    if (role !== \"panel\") handleDragCancelProp?.(event);\n  };\n\n  // ---- Grid resizing (unchanged except one bugfix) ----\n  const resizePendingRef = useRef({ rowSizes: null, colSizes: null });\n\n  const finalizeResize = () => {\n    const pending = resizePendingRef.current;\n    if (!pending.rowSizes && !pending.colSizes) return;\n    if (!state.grid?._id) return;\n\n    dispatch(\n      updateGrid({\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: pending.rowSizes ?? rowSizes,\n        colSizes: pending.colSizes ?? colSizes,\n      })\n    );\n\n    socket.emit(\"update_grid\", {\n      gridId: state.grid._id,\n      grid: {\n        _id: state.grid._id,\n        rows: state.grid.rows,\n        cols: state.grid.cols,\n        rowSizes: pending.rowSizes ?? rowSizes,\n        colSizes: pending.colSizes ?? colSizes,\n      },\n    });\n\n    resizePendingRef.current = { rowSizes: null, colSizes: null };\n  };\n\n  const getGridWidth = () => gridRef.current?.clientWidth || 1;\n  const getGridHeight = () => gridRef.current?.clientHeight || 1;\n\n  const resizeColumn = (i, pixelDelta) => {\n    const gridWidth = getGridWidth();\n    setColSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridWidth) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.colSizes = copy;\n      return copy;\n    });\n  };\n\n  const resizeRow = (i, pixelDelta) => {\n    const gridHeight = getGridHeight();\n    setRowSizes((sizes) => {\n      const next = i + 1;\n      if (next >= sizes.length) return sizes;\n\n      const total = sizes.reduce((a, b) => a + b, 0);\n      const frDelta = (pixelDelta / gridHeight) * total;\n\n      const copy = [...sizes];\n      copy[i] = Math.max(0.3, copy[i] + frDelta);\n      copy[next] = Math.max(0.3, copy[next] - frDelta);\n\n      resizePendingRef.current.rowSizes = copy;\n      return copy;\n    });\n  };\n\n  const getClientX = (e) => (e.touches ? e.touches[0].clientX : e.clientX);\n  const getClientY = (e) => (e.touches ? e.touches[0].clientY : e.clientY);\n\n  const getColPosition = (i) => {\n    const total = colSizes.reduce((a, b) => a + b, 0);\n    const before = colSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n\n  const getRowPosition = (i) => {\n    const total = rowSizes.reduce((a, b) => a + b, 0);\n    const before = rowSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n    return (before / total) * 100;\n  };\n\n  const startColResize = (e, i) => {\n    e.preventDefault();\n    let startX = getClientX(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentX = getClientX(ev);\n      const delta = currentX - startX;\n      startX = currentX;\n      resizeColumn(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop);\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n\n  const startRowResize = (e, i) => {\n    e.preventDefault();\n    let startY = getClientY(e);\n\n    const move = (ev) => {\n      ev.preventDefault();\n      const currentY = getClientY(ev);\n      const delta = currentY - startY;\n      startY = currentY;\n      resizeRow(i, delta);\n    };\n\n    const stop = () => {\n      window.removeEventListener(\"mousemove\", move);\n      window.removeEventListener(\"mouseup\", stop);\n      window.removeEventListener(\"touchmove\", move);\n      window.removeEventListener(\"touchend\", stop);\n      finalizeResize();\n    };\n\n    window.addEventListener(\"mousemove\", move);\n    window.addEventListener(\"mouseup\", stop); // ✅ FIXED\n    window.addEventListener(\"touchmove\", move);\n    window.addEventListener(\"touchend\", stop);\n  };\n  const activeContainer = useMemo(() => {\n    if (activeRole !== \"container\" || !activeId) return null;\n    return (state?.containers || []).find((c) => c.id === activeId) || null;\n  }, [activeRole, activeId, state?.containers]);\n\n  if (!grid?._id) return <div>Loading grid…</div>;\n\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={collisionDetection}\n      measuring={{\n    droppable: {\n      strategy: MeasuringStrategy.Always,\n    },}}\n      autoScroll={{\n    enabled: true,\n    threshold: {\n      x: 0.15,\n      y: 0.15,\n    },\n    acceleration: 30,\n  }}\n      onDragStart={handleDragStart}\n      onDragMove={handleDragMove}\n      onDragEnd={handleDragEnd}\n      onDragOver={handleDragOver}\n      onDragCancel={handleDragCancel}\n    >\n      <div\n        style={{\n          position: \"absolute\",\n          inset: 0,\n          background: \"#1D2125\",\n          overflow: \"hidden\",\n          top: \"45px\",\n        }}\n      >\n        <GridCanvas\n          gridRef={gridRef}\n          rows={rows}\n          cols={cols}\n          colTemplate={colTemplate}\n          rowTemplate={rowTemplate}\n          visiblePanels={visiblePanels}\n          activeId={activeId}\n          panelDragging={panelDragging}\n          components={components}\n          dispatch={dispatch}\n          startColResize={startColResize}\n          startRowResize={startRowResize}\n          getColPosition={getColPosition}\n          getRowPosition={getRowPosition}\n          highlightCellId={panelOverCellId}\n        />\n      </div>\n\n      <DragOverlay dropAnimation={null} zIndex={100000} adjustScale={false}>\n        {activeId && activeRole === \"panel\" && getPanel(activeId) ? (\n          <PanelClone panel={getPanel(activeId)} />\n        ) : null}\n\n        {activeId && activeRole === \"container\" ? (\n          <div style={{ width: state?.activeSize?.width, height: state?.activeSize?.height }}>\n            <ContainerClone container={activeContainer} />\n          </div>\n        ) : null}\n      </DragOverlay>\n    </DndContext>\n  );\n}\n\nexport default React.memo(GridInner);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}