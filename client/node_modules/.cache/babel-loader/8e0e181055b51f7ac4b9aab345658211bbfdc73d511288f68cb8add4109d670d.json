{"ast":null,"code":"// state/bindSocketToStore.js\nimport { ActionTypes } from \"./actions\";\nexport function bindSocketToStore(socket, dispatch) {\n  // ----------------------------\n  // FULL STATE HYDRATE\n  // ----------------------------\n  socket.on(\"full_state\", (payload = {}) => {\n    console.log(\"[socket] full_state received:\", payload);\n\n    // Persist gridId like old app (if provided)\n    if (payload.gridId) {\n      localStorage.setItem(\"daytrack-gridId\", payload.gridId);\n      dispatch({\n        type: ActionTypes.SET_GRID_ID,\n        payload: payload.gridId\n      });\n    }\n    dispatch({\n      type: ActionTypes.FULL_STATE,\n      payload\n    });\n  });\n\n  // ----------------------------\n  // Containers/Instances (new app events)\n  // ----------------------------\n  socket.on(\"container_created\", ({\n    container\n  }) => {\n    if (!(container !== null && container !== void 0 && container.id)) return;\n    dispatch({\n      type: ActionTypes.ADD_CONTAINER,\n      payload: {\n        id: container.id,\n        label: container.label\n      }\n    });\n  });\n  socket.on(\"instance_created_in_container\", ({\n    containerId,\n    instance\n  }) => {\n    if (!containerId || !(instance !== null && instance !== void 0 && instance.id)) return;\n    dispatch({\n      type: ActionTypes.ADD_INSTANCE_TO_CONTAINER,\n      payload: {\n        containerId,\n        instance\n      }\n    });\n  });\n  socket.on(\"container_items_updated\", ({\n    containerId,\n    items\n  }) => {\n    if (!containerId || !Array.isArray(items)) return;\n    dispatch({\n      type: ActionTypes.PATCH_CONTAINER_ITEMS,\n      payload: {\n        containerId,\n        items\n      }\n    });\n  });\n  socket.on(\"instance_updated\", ({\n    instance\n  }) => {\n    if (!(instance !== null && instance !== void 0 && instance.id)) return;\n    dispatch({\n      type: ActionTypes.PATCH_INSTANCE,\n      payload: {\n        instance\n      }\n    });\n  });\n\n  // ----------------------------\n  // Panels/Grid events (old server style)\n  // ----------------------------\n  socket.on(\"panel_updated\", panel => {\n    if (!(panel !== null && panel !== void 0 && panel.id)) return;\n    dispatch({\n      type: ActionTypes.PATCH_PANEL,\n      payload: {\n        panel\n      }\n    });\n  });\n  socket.on(\"grid_updated\", gridPatch => {\n    dispatch({\n      type: ActionTypes.PATCH_GRID,\n      payload: {\n        grid: gridPatch\n      }\n    });\n  });\n\n  // ----------------------------\n  // AUTH (old behavior)\n  // ----------------------------\n  socket.on(\"auth_success\", ({\n    token,\n    userId\n  }) => {\n    console.log(\"[socket] auth_success\", {\n      userId\n    });\n    localStorage.setItem(\"daytrack-token\", token);\n    localStorage.setItem(\"daytrack-userId\", userId);\n    localStorage.removeItem(\"daytrack-gridId\");\n\n    // easiest: reload so socket.js re-auths cleanly\n    window.location.reload();\n  });\n  socket.on(\"auth_error\", msg => {\n    console.log(\"[socket] auth_error:\", msg);\n    localStorage.removeItem(\"daytrack-token\");\n    localStorage.removeItem(\"daytrack-userId\");\n    localStorage.removeItem(\"daytrack-gridId\");\n  });\n  socket.on(\"connect_error\", err => {\n    console.log(\"[socket] connect_error:\", err === null || err === void 0 ? void 0 : err.message);\n    if ((err === null || err === void 0 ? void 0 : err.message) === \"INVALID_TOKEN\" || (err === null || err === void 0 ? void 0 : err.message) === \"USER_NOT_FOUND\") {\n      localStorage.removeItem(\"daytrack-token\");\n      localStorage.removeItem(\"daytrack-userId\");\n      localStorage.removeItem(\"daytrack-gridId\");\n      window.location.reload();\n    }\n  });\n  socket.on(\"server_error\", msg => {\n    console.warn(\"[socket] server_error:\", msg);\n  });\n\n  // cleanup (important with HMR)\n  return () => {\n    socket.off(\"full_state\");\n    socket.off(\"container_created\");\n    socket.off(\"instance_created_in_container\");\n    socket.off(\"container_items_updated\");\n    socket.off(\"instance_updated\");\n    socket.off(\"panel_updated\");\n    socket.off(\"grid_updated\");\n    socket.off(\"auth_success\");\n    socket.off(\"auth_error\");\n    socket.off(\"connect_error\");\n    socket.off(\"server_error\");\n  };\n}","map":{"version":3,"names":["ActionTypes","bindSocketToStore","socket","dispatch","on","payload","console","log","gridId","localStorage","setItem","type","SET_GRID_ID","FULL_STATE","container","id","ADD_CONTAINER","label","containerId","instance","ADD_INSTANCE_TO_CONTAINER","items","Array","isArray","PATCH_CONTAINER_ITEMS","PATCH_INSTANCE","panel","PATCH_PANEL","gridPatch","PATCH_GRID","grid","token","userId","removeItem","window","location","reload","msg","err","message","warn","off"],"sources":["/home/joshpoms/dndtest2/client/src/state/bindSocketToStore.js"],"sourcesContent":["// state/bindSocketToStore.js\nimport { ActionTypes } from \"./actions\";\n\nexport function bindSocketToStore(socket, dispatch) {\n  // ----------------------------\n  // FULL STATE HYDRATE\n  // ----------------------------\n  socket.on(\"full_state\", (payload = {}) => {\n    console.log(\"[socket] full_state received:\", payload);\n\n    // Persist gridId like old app (if provided)\n    if (payload.gridId) {\n      localStorage.setItem(\"daytrack-gridId\", payload.gridId);\n      dispatch({ type: ActionTypes.SET_GRID_ID, payload: payload.gridId });\n    }\n\n    dispatch({ type: ActionTypes.FULL_STATE, payload });\n  });\n\n  // ----------------------------\n  // Containers/Instances (new app events)\n  // ----------------------------\n  socket.on(\"container_created\", ({ container }) => {\n    if (!container?.id) return;\n    dispatch({\n      type: ActionTypes.ADD_CONTAINER,\n      payload: { id: container.id, label: container.label },\n    });\n  });\n\n  socket.on(\"instance_created_in_container\", ({ containerId, instance }) => {\n    if (!containerId || !instance?.id) return;\n    dispatch({\n      type: ActionTypes.ADD_INSTANCE_TO_CONTAINER,\n      payload: { containerId, instance },\n    });\n  });\n\n  socket.on(\"container_items_updated\", ({ containerId, items }) => {\n    if (!containerId || !Array.isArray(items)) return;\n    dispatch({\n      type: ActionTypes.PATCH_CONTAINER_ITEMS,\n      payload: { containerId, items },\n    });\n  });\n\n  socket.on(\"instance_updated\", ({ instance }) => {\n    if (!instance?.id) return;\n    dispatch({\n      type: ActionTypes.PATCH_INSTANCE,\n      payload: { instance },\n    });\n  });\n\n  // ----------------------------\n  // Panels/Grid events (old server style)\n  // ----------------------------\n  socket.on(\"panel_updated\", (panel) => {\n    if (!panel?.id) return;\n    dispatch({ type: ActionTypes.PATCH_PANEL, payload: { panel } });\n  });\n\n  socket.on(\"grid_updated\", (gridPatch) => {\n    dispatch({ type: ActionTypes.PATCH_GRID, payload: { grid: gridPatch } });\n  });\n\n  // ----------------------------\n  // AUTH (old behavior)\n  // ----------------------------\n  socket.on(\"auth_success\", ({ token, userId }) => {\n    console.log(\"[socket] auth_success\", { userId });\n\n    localStorage.setItem(\"daytrack-token\", token);\n    localStorage.setItem(\"daytrack-userId\", userId);\n    localStorage.removeItem(\"daytrack-gridId\");\n\n    // easiest: reload so socket.js re-auths cleanly\n    window.location.reload();\n  });\n\n  socket.on(\"auth_error\", (msg) => {\n    console.log(\"[socket] auth_error:\", msg);\n    localStorage.removeItem(\"daytrack-token\");\n    localStorage.removeItem(\"daytrack-userId\");\n    localStorage.removeItem(\"daytrack-gridId\");\n  });\n\n  socket.on(\"connect_error\", (err) => {\n    console.log(\"[socket] connect_error:\", err?.message);\n\n    if (err?.message === \"INVALID_TOKEN\" || err?.message === \"USER_NOT_FOUND\") {\n      localStorage.removeItem(\"daytrack-token\");\n      localStorage.removeItem(\"daytrack-userId\");\n      localStorage.removeItem(\"daytrack-gridId\");\n      window.location.reload();\n    }\n  });\n\n  socket.on(\"server_error\", (msg) => {\n    console.warn(\"[socket] server_error:\", msg);\n  });\n\n  // cleanup (important with HMR)\n  return () => {\n    socket.off(\"full_state\");\n    socket.off(\"container_created\");\n    socket.off(\"instance_created_in_container\");\n    socket.off(\"container_items_updated\");\n    socket.off(\"instance_updated\");\n    socket.off(\"panel_updated\");\n    socket.off(\"grid_updated\");\n    socket.off(\"auth_success\");\n    socket.off(\"auth_error\");\n    socket.off(\"connect_error\");\n    socket.off(\"server_error\");\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}